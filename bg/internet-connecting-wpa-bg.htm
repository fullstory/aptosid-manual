<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>sidux Manuals - Internet/Network WiFi WPA-Supplicant</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<!-- Last translation revision bluewater 30/04/2008 1600 UTC-->
<div id="menu"> <!-- menu starts here bg lang maintainer manul-->
<!--sidux-manual Operating System Manual menu-version-01.91.2009.07.13 -->
<!-- menu last updated by bluewater 2009.07.13 0500 hrs UTC -->
	<div id="menu-header">
<a href="http://sidux.com/"><img src="../lib/logos/manual-sidux-logo.png" title="Главна страница на sidux.com, форуми и вики" alt="sidux.com лого" /></a>
	</div>
	<ul id="top-list">
		<li><a href="manual-search-bg.htm#search-on"> <img src="../lib/logos/manual-search-22x22.png" title="Търсене в ръководството" alt="Търсене" />Търсене</a> </li>
		<li><a href="http://manual.sidux.com/meta-manual">Community Software Picks</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-100x64.png" title="Избор на друг език - choose another language" alt="превключване на езика" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-bg.htm">Ръководство за sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-bg.htm#welcome-gen">Добре дошли!</a></li>
				<li><a href="welcome-bg.htm#how-to">Как да използваме ръководството</a></li>
				<li><a href="welcome-bg.htm#table-contents">Съдържание</a></li>
				<li><a href="help-bg.htm#help-gen">Къде да получим помощ</a></li>
				<li><a href="help-bg.htm#paste">IRC !paste</a></li>
				<li><a href="credits-bg.htm#cred-team">Благодарности</a></li>
				<li><a href="wel-quickstart-bg.htm#welcome-quick">Кратко ръководство за sidux</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-dl-burning-bg.htm">ISO Content, Releases, Download Mirrors and Burning</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-bg.htm#cd-content">ISO Content and system requirements</a></li>
				<li><a href="sys-admin-release-bg.htm#rolling">Забележки (Release Notes)</a></li>
				<li><a href="cd-dl-burning-bg.htm#download-sidux">Сървъри на sidux, сваляне на образа и създаване на инсталационно CD</a></li>
				<li><a href="cd-dl-burning-bg.htm#md5">Контролна сума md5</a></li>
				<li><a href="cd-dl-burning-bg.htm#burn-nero">Създаване на инсталационно CD в Windows</a></li>
				<li><a href="cd-dl-burning-bg.htm#burn-linux">Създаване на инсталационно CD в Linux</a></li>
				<li><a href="cd-dl-burning-bg.htm#xdelta">xdelta обновления</a></li>
				<li><a href="cd-no-gui-burn-bg.htm#burning-bg-gui">Скрипт burniso за създаване на инсталационно CD</a></li>
				<li><a href="cd-no-gui-burn-bg.htm#burning-no-gui">Създаване на инсталационно CD в терминален режим</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="live-mode-bg.htm">Режим LiveCD</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="live-mode-bg.htm#rootpw">root парола в LiveCD режим</a></li>
				<li><a href="live-mode-bg.htm#live-cd-installsoft">Инсталиране на софтуер в LiveCD режим</a></li>
				<li><a href="live-mode-bg.htm#ntfs-3g">Достъп към NTFS-форматирани раздели: ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="term-konsole-bg.htm">Терминал (Конзола)</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="term-konsole-bg.htm#sux">Командата sux</a></li>
				<li><a href="term-konsole-bg.htm#term-kon">Терминал (Конзола)</a></li>
				<li><a href="term-konsole-bg.htm#cli-help">Помощ в терминален режим</a></li>
				<li><a href="term-konsole-bg.htm#term-cmds">Команди в терминален режим</a></li>
				<li><a href="term-konsole-bg.htm#shell-scripts">Скриптове</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="cheatcodes-bg.htm">Опции при стартиране</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="cheatcodes-bg.htm#cheatcodes">Специфични за sidux LiveCD опции при стартиране на системата</a></li>
				<li><a href="cheatcodes-bg.htm#cheatcodes-linux">Общи за Linux опции при стартиране на системата</a></li>
				<li><a href="cheatcodes-vga-bg.htm#vga">VGA опции при стартиране</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="part-gparted-bg.htm">Разделяне на диска</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="part-gparted-bg.htm#partition">Разделяне на хард-диска с помощта на GParted</a></li>
				<li><a href="part-gparted-bg.htm#ntfs">Промяна на размерите на NTFS-раздели с GParted</a></li>
				<li><a href="part-uuid-bg.htm#uuid">Раздели: идентификатори и псевдоними, файл fstab</a></li>
				<li><a href="part-cfdisk-bg.htm#disknames">Конвенция за имената на дисковете в Linux</a></li>
				<li><a href="part-cfdisk-bg.htm#partition">Разделяне на хард-диска с помощта на cfdisk</a></li>
				<li><a href="part-cfdisk-bg.htm#formating">Форматиране на разделите с помощта на cfdisk след разделяне</a></li>
				<li><a href="part-size-examp-bg.htm#part-example">Примери за разделяне на хард-диска</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="hd-install-bg.htm">Инсталиране на sidux</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="hd-install-bg.htm#Inst-prep">Подготовка</a></li>
				<li><a href="hd-install-bg.htm#Installation">Инсталиране върху хард-диска</a></li>
				<li><a href="hd-install-bg.htm#first-hd-boot">Първо стартиране на системата</a></li>
				<li><a href="hd-install-opts-bg.htm#fromiso">Стартиране от iso-образ</a></li>
				<li><a href="hd-install-opts-bg.htm#fromiso-persist">Методи fromiso и persist</a></li>
				<li><a href="hd-install-opts-bg.htm#usb-hd">Инсталиране върху USB-диск (флаш)</a></li>
				<li><a href="hd-install-opts-bg.htm#vtbox">Инсталиране на sidux във VirtualBox среда</a></li>
				<li><a href="hd-install-opts-bg.htm#qemu">Инсталиране на sidux в QEMU среда</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-bg.htm">Видеокарти, монитори, и други драйвери</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hw-dev-hw-dri-bg.htm#hd-ntfs3g">Достъп към NTFS-форматирани раздели: ntfs-3g</a></li>
				<li><a href="hw-dev-mon-bg.htm#mon-res">Разделителна способност на екрана и монитори</a></li>
				<li><a href="hw-dev-mon-bg.htm#xrandr">Двумониторен режим и xrandr</a></li>
				<li><a href="hw-dev-mon-bg.htm#mon-binary">Двумониторен режим (несвободни драйвери)</a></li>
				<li><a href="hw-dev-hw-dri-bg.htm#non-free-3d">Несвободни бинарни драйвери за Nvidia  видеокарти</a></li>
				<li><a href="hw-dev-hw-dri-bg.htm#non-free-3d-2">non-free drivers for ATI, Radeon and others</a></li>
				<li><a href="hw-dev-hw-dri-bg.htm#non-free-firmware">Hardware needing non-free firmware drivers</a></li>
				<li><a href="hw-dev-hw-dri-bg.htm#non-free">Adding non-free to Sources List</a></li>
				<li><a href="hw-dev-hw-dri-bg.htm#native-nv-ati">FOSS xorg drivers for nVidia, ATI, Radeon, Intel</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="wm-kde-bg.htm">Прозоречни мениджъри</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="wm-xfce-bg.htm#xfce-notes">Полезни съвети за Xfce</a></li>
				<li><a href="wm-kde-bg.htm#install-add">Полезни съвети за KDE</a></li>
				<li><a href="wm-kde-bg.htm#desk-freeze">KDE "зависва"</a></li>
				<li><a href="wm-kde-bg.htm#kde-login">Проблеми с логване в KDE</a></li>
				<li><a href="wm-kde-bg.htm#ch-th">Сменяне на темите</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="lamp-apache-bg.htm">Програмен комплекс LAMP в sidux</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="lamp-apache-bg.htm#serv-apache">Какво е LAMP</a></li>
				<li><a href="lamp-apache-bg.htm#serv-ftp">FTP клиенти</a></li>
				<li><a href="lamp-apache-bg.htm#serv-sec">Защитени протоколи</a></li>
				<li><a href="lamp-apache-bg.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-bg.htm#serv-mysql">MySQL настройка</a></li>
				<li><a href="lamp-ppp-bg.htm#serv-php">PHP и Apache</a></li>
				<li><a href="ntp-server-bg.htm#ntp-server">Синхронизация на времето</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="internet-connecting-bg.htm">Интернет и Мрежи</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="tor-privoxy-bg.htm#tor">Анонимизиращ маршрутизатор Tor</a></li>
				<li><a href="tor-privoxy-bg.htm#privoxy">Прокси Privoxy</a></li>
				<li><a href="internet-connecting-bg.htm#firewalls">Защитна стена (firewall)</a></li>
				<li><a href="samba-bg.htm#configure">Интеграция в Windows мрежа</a></li>
				<li><a href="samba-bg.htm#setup">Мрежов сървър Samba - настройки</a></li>
				<li><a href="ssh-bg.htm#ssh-fs">Монтиране през мрежата чрез SSH</a></li>
				<li><a href="ssh-bg.htm#ssh-x">Десктоп програми през мрежата чрез SSH</a></li>
				<li><a href="ssh-bg.htm#ssh-f">SSH и Konqueror</a></li>
				<li><a href="ssh-bg.htm#ssh-w">SSH десктоп-пренасочване към Windows-PC</a></li>
				<li><a href="ssh-bg.htm#ssh">SSH и безопасност</a></li>
				<li><a href="internet-connecting-bg.htm#dial-mod">56k модеми</a></li>
				<li><a href="internet-connecting-wpagui-bg.htm#wpa-roaming-gui">Безжични мрежи (WiFi) - Роуминг</a></li>
				<li><a href="internet-connecting-wpa-bg.htm#wpa-basic">Безжични мрежи (WiFi) - Основни инструкции</a></li>
				<li><a href="internet-connecting-wpa-bg.htm#wpa">Безжични мрежи (WiFi) - wpasupplicant</a></li>
				<li><a href="internet-connecting-bg.htm#netcardconfig">Включване към интернет - Ceni</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="sys-admin-apt-bg.htm">Инсталиране на програми и обновяване на системата</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="sys-admin-apt-bg.htm#apt-cook">APT, хранилища и указатели към хранилищата</a></li>
				<li><a href="sys-admin-apt-bg.htm#apt-install">Инсталиране на нови пакети</a></li>
				<li><a href="sys-admin-apt-bg.htm#apt-delete">Премахване на пакети</a></li>
				<li><a href="sys-admin-apt-bg.htm#apt-downgrade">Забрана за обновяване на пакети, понижаване на версия</a></li>
				<li><a href="sys-admin-apt-bg.htm#apt-cache">Търсене в пакетите с apt-cache</a></li>
				<li><a href="sys-admin-apt-bg.htm#gui-pacsea">GUI Package searching</a></li>
				<li><a href="siduxcc-bg.htm#hermes">sidux-hermes</a></li>
				<li><a href="sys-admin-upgrade-bg.htm#live-cd-upgrade">Обновяване от Live-CD</a></li>
				<li><a href="sys-admin-kern-upg-bg.htm#kern-upgrade">Обновяване на ядрото</a></li>
				<li><a href="sys-admin-apt-bg.htm#apt-upgrade">Обновяване на инсталирана система - dist-upgrade</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-gen-bg.htm">Системно  администриране</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="hd-install-bg.htm#adduser">Adding a new user</a></li>
				<li><a href="home-bg.htm#home-bu">Преместване на /home</a></li>
				<li><a href="siduxcc-bg.htm#siduxcc">Мениджър на настройките на sidux</a></li>
				<li><a href="sys-admin-rdiff-bg.htm#rdiff">Резервни копия - rdiff</a></li>
				<li><a href="sys-admin-rsync-bg.htm#rsync">Резервни копия - rsync</a></li>
				<li><a href="vir-rkits-bg.htm#virus-rkits">Скeнери за вируси и вредоносен софтуер</a></li>
				<li><a href="sys-admin-gen-bg.htm#start-services">Демони (фонови програми) - включване и изключване</a></li>
				<li><a href="sys-admin-gen-bg.htm#pw-lost">Забравена root парола</a></li>
				<li><a href="sys-admin-gen-bg.htm#fonts">Шрифтове</a></li>
				<li><a href="sys-admin-gen-bg.htm#cups">CUPS (принтери)</a></li>
				<li><a href="sys-admin-gen-bg.htm#init">sidux нива на работа - init</a></li>
				<li><a href="sys-admin-grub-bootman2-bg.htm#mbr-grub-boot">Възстановяване на стартиращия сектор MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-bg.htm#dual-boot">Две и повече операционни системи</a></li>
				<li><a href="bios-freedos-bg.htm#bois-prep">Обновяване на BIOS-а през FreeDOS</a></li>
				<li><a href="sys-admin-grub-bootman2-bg.htm#boot-grub-floppy">Създаване на стартиращ флопи-диск</a></li>
				<li><a href="sys-admin-grub-bootman2-bg.htm#remove-grub">Премахване на grub от MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-bg.htm#what-is-grub">Стартиращ мениджър grub</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="wpa-basic">
		<h2 id="top-header" >Basic Guide To Get Wireless Working - WiFi</h2>

							<p class="highlight-3">Due to the complexity of law, sidux will only provide dfsg-free software, <a href="hw-dev-hw-dri-bg.htm#non-free">please check this link for additional information on non-free sources for firmware</a></p>

							<p>To get wlan WiFi working, you need a wired connection for just a few minutes to download the appropriate firmware.</p>

							<p>If a wired connection is not possible you will have to put the firmware on a removable device (pendrive e.g.) and install it as root from there using:</p>
<pre>
#dpkg -i &lt;firmware.deb&gt;
</pre>

							<p>To find the appropriate firmware without knowing the make or brand of your wireless chip, you can use the command:</p>
<pre>
#fw-detect
</pre>
							<p>This will give you the following information:</p>
<pre>
#apt-get update
#apt-get install &lt;name of firmware&gt;
#modprobe -r &lt;modulename&gt;
#modprobe &lt;modulename&gt;
</pre>
							<p>Use the apt-get install line that fw-detect command gave you. After that is done, you need to issue some commands in konsole before configuring the device.</p>

							<p>You have to load the module now in order to be able to configure your device.</p>

							<p>As root in konsole do:</p>
<pre>
modprobe -r &lt;modulename&gt;

modprobe &lt;modulename&gt;
</pre>
							<p>As &lt;modulename&gt; uses the info that fw-detect gave you before. A helpful function of Konsole can be used here: bash completion: <br />
							If you just write the first few letters of &lt;modulename&gt; and then hit the TAB key, it completes the module name (e.g. modprobe ipw TAB key) That also prevents misspelling.</p>

							<p>Both modprobe commands dont give any output if successful, so if the normal prompt returns, the module got loaded fine.</p>

							<p>You can check this with:</p>
<pre>
#lsmod | grep &lt;module&gt;
</pre>

							
							<p>Now start Ceni from K-Menu - Internet or run it from konsole as root with <a href="internet-connecting-bg.htm#netcardconfig">Getting Online - Ceni</a>. Your wireless WiFi device should be shown now and is ready to be configured.</p>

							<p>To set up a Wlan WiFi GUI see <a href="internet-connecting-wpagui-bg.htm#wpa-roaming-gui">WiFi - roaming WPA-GUI</a></p>
	</div>	
	<div class="divider" id="wpa">
		<h2>Modes of Operation in wpasupplicant for Debian</h2>

							<p class="highlight-3">Due to the complexity of law, sidux will only provide dfsg-free software, <a href="hw-dev-hw-dri-bg.htm#non-free">please check this link for additional information on non-free sources for firmware</a></p>

							<p>The Debian wpasupplicant package provides two (2) convenient modes of operation that are closely integrated to the core networking infrastructure; ifupdown.</p>

			<h4>Whats Covered</h4>

					<h6>1.  Specifying the wpa_supplicant driver backend</h6>
          						<p>* Table of supported drivers<br />
         						* Common Driver Recommendations </p>

					<h6>2. Mode #1: Managed Mode</h6>
          						<p>* Examples<br />
          						* Table of Common Options<br />
          						* Important Notes About Managed Mode<br />
          						* How It Works </p>

					<h6>3. Mode #2: Roaming Mode</h6>
          						<p>* wpa_supplicant.conf<br />
          						* /etc/network/interfaces<br />
          						* Controlling the Roaming Daemon with wpa_action<br />
          						* Fine Tuning the Roaming Setup<br />
          						* The Logfile<br />
          						* Using External Mapping Scripts (e.g. guessnet)<br />
          						* /etc/network/interfaces with external mapping</p>

					<h6>4. Troubleshooting</h6>
          						<p>* Hidden ssids</p>

					<h6>5. Security Considerations</h6>
          						<p>* Configuration File Permissions</p> 

		<h2>1. Specifying the wpa_supplicant driver backend</h2>

							<p>The wext driver backend will be used for all interfaces that do not explicitly set 'wpa-driver' to the driver type required for that device. Users of linux  2.4 kernels, or 2.6 kernels less than 2.6.14 will be required to specify a wpa-driver type.</p>

	</div>	
				<h3>Supported drivers</h3>
	<div>
		<table>
			<tbody>
				<tr>
					<th>Driver</th>
					<th>Description</th>
				</tr>
				<tr>
					<td>wext</td>
					<td>Linux wireless extensions (generic)</td>
				</tr>
			</tbody>
		</table>
	</div>
	<div class="spacer05"></div>
		<h3>Common Driver Recommendations</h3>

							<p>The Intel Pro Wireless adapters (ipw2100, ipw2200 and ipw3945) all use the 'wext' backend, unless your kernel is older than 2.6.14</p>

							<p>Madwifi supports both the 'wext' and 'madwifi' driver backends. 'wext' is preferred, however 'madwifi' may work better in some circumstances.</p>

							<p>Ndiswrapper NO LONGER SUPPORTS the 'ndiswrapper' driver backend as of version 1.16. Therefore, 'wext' must be used unless you use an antiquated ndiswrapper release.</p>

							<p>Set the driver type in the interfaces(5) stanza for your device with the 'wpa-driver' option. For example:</p>

<pre>
iface eth0 inet dhcp
	wpa-driver wext
	. . . . . more options
</pre>

			<h2>2. Mode #1: Managed Mode</h2>

							<p>This mode provides the ability to establish a connection via wpa_supplicant to one known network. It is similar to how the wireless-tools package works. Each element required to establish the connection via wpa_supplicant is prefixed with 'wpa-' and followed by the value that will be used for that element.</p>

		<h6>Examples of a Mode #1 wpa.conf file - Example 1.</h6>
<pre>
Example of a Mode #1 wpa.conf file - Example 1.
NOTE: the 'wpa-psk' value is only valid if:

   1. It is a plaintext (ascii) string between 8 and 63 characters in length
   2. It is a hexadecimal string of 64 characters 

# Connect to access point of ssid 'NETBEER' with an encryption type of 
# WPA-PSK/WPA2-PSK. It assumes the driver will use the 'wext' driver backend 
# of wpa_supplicant because no wpa-driver option has been specified. 
# The passphrase is given as a ASCII (plaintext) string. DHCP is used to 
# obtain a network address.
#
iface wlan0 inet dhcp

        wpa-ssid NETBEER
        # plaintext passphrase
        wpa-psk PlainTextSecret

# Connect to access point of ssid 'homezone' with an encryption type of 
# WPA-PSK/WPA2-PSK, using the 'wext' driver backend of wpa_supplicant. 
# The psk is given as an encoded hexadecimal string. DHCP is used to obtain 
# a network address.
#
iface wlan0 inet dhcp
wpa-driver wext
wpa-ssid homezone
# hexadecimal psk is encoded from a plaintext passphrase
wpa-psk 000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f

# Connect to access point of ssid 'HotSpot1' and bssid of '00:1a:2b:3c:4d:5e' 
# with an encryption type of WPA-PSK/WPA2-PSK, using the the 'madwifi' driver 
# backend of wpa_supplicant. The passphrase is given as a plaintext string. 
# A static network address assignment is used. 
#
iface ath0 inet static

        wpa-driver madwifi
        wpa-ssid HotSpot1
        wpa-bssid 00:1a:2b:3c:4d:5e
        # plaintext passphrase
        wpa-psk madhotspot
        wpa-key-mgmt WPA-PSK
        wpa-pairwise TKIP CCMP
        wpa-group TKIP CCMP
        wpa-proto WPA RSN
        # static ip settings
        address 192.168.0.100
        netmask 255.255.255.0
        network 192.168.0.0
        broadcast 192.168.0.255
        gateway 192.168.0.1

# User supplied wpa_supplicant.conf is used for eth1. All network information 
# is contained within the user supplied wpa_supplicant.conf. No wpa-driver type 
# is specified, so wext is used. DHCP is used to obtain a network address. 
#
iface eth1 inet dhcp

wpa-conf /path/to/wpa_supplicant.conf
</pre>
	
	<div class="divider" id="wpa1">
		<h2>Table of Common Options</h2>

							<p>A brief summary of common 'wpa-' options that may be used in the /etc/network/interfaces stanza for a wireless device. See the 'Important Notes About Managed Mode' section for information about valid and invalid 'wpa-' values.</p>

							<p class="highlight-2">NOTE: ALL values are CASE SeNsItVe</p>

<pre>
Element		Example Value		Description
=======         =============           ===========
wpa-ssid        plaintextstring         sets the ssid of your network
wpa-bssid       00:1a:2b:3c:4d:5e       the bssid of your AP
wpa-psk         0123456789......        your preshared wpa key. Use
                                        wpa_passphrase(8) to generate your psk
                                        from a passphrase and ssid pair
wpa-key-mgmt    NONE, WPA-PSK, WPA-EAP, list of accepted authenticated key
                IEEE8021X               management protocols
wpa-group       CCMP, TKIP, WEP104,     list of accepted group ciphers for WPA
                WEP40
wpa-pairwise    CCMP, TKIP, NONE        list of accepted pairwise ciphers for
                                        WPA
wpa-auth-alg    OPEN, SHARED, LEAP      list of allowed IEEE 802.11
                                        authentication algorithms
wpa-proto       WPA, RSN                list of accepted protocols
wpa-identity    myplaintextname         administrator provided username
                                        (EAP authentication)
wpa-password    myplaintextpassword     your password (EAP authentication)
wpa-scan-ssid   0 or 1                  toggles scanning of ssid with specific
                                        Probe Request frames
wpa-ap-scan     0 or 1 or 2             adjusts the scanning logic of
                                        wpa_supplicant
</pre>
							<p>The complete functionality of wpa_cli(8) should be implemented. Anything missing is considered a bug and should be reported as such. Patches are always welcome.</p>


			<h2>Important Notes About Managed Mode</h2>

							<p>Almost all 'wpa-' options require there is at least a ssid specified. Only a handful of options have a global effect. These are: 'wpa-ap-scan' and 'wpa-preauthenticate'.</p>

							<p>Any 'wpa-' option given for a device in the interfaces(5) file is sufficient to trigger the wpa_supplicant daemon into action.</p>

							<p>The wpasupplicant ifupdown script makes assumptions about the 'type' of input that is valid for each option. For example, it assumes that some input is plaintext and wraps quotation marks around the input before passing it on to wpa_cli, which then adds the input to the network block being formed via the wpa_supplicant ctrl_interface socket.</p>

							<p>Running ifup manually with the  '--verbose' option will reveal all of the commands used to form the network block via wpa_cli. If the value you used for any wpa-* option in /etc/network/interfaces is surrounded by double quotes, than it has been assumed to be of "plaintext" or "ascii" type input.</p>

							<p>Some input is assumed to be a hexadecimal string (eg. wpa-wep-key*). The value 'type' of the wpa-psk option however, is determined via a simple check for more than one non hexadecimal character.</p>

			<h2>How It Works</h2>

							<p>As mentioned earlier, each wpa_supplicant specific element is prefixed with 'wpa-'. Each element correlates to a property of wpa_supplicant described in the wpa_supplicant.conf(5), wpa_supplicant(8) and wpa_cli(8) manpages.</p>

							<p>The supplicant is launched without any pre-configuration whatsoever, and wpa_cli forms a network configuration from the input provided by the 'wpa-*' lines. Initially, wpa_supplicant/wpa_cli does not directly set the properties of the device (like setting an essid with iwconfig, for example), rather it informs the device of what access point is suitable to associate with. Once the device has scanned the area, and found that the suitable access point is available for use, these properties are set.</p>

							<p>The script that does all the work is located at:</p>

<pre>
/etc/wpa_supplicant/ifupdown.sh
/etc/wpa_supplicant/functions.sh
</pre>

							<p>ifupdown.sh is executed by run-parts, which in turn is invoked by ifupdown during the 'pre-up', 'pre-down' and 'post-down' phases.</p>


							<p>In the 'pre-up' phase, a wpa_supplicant daemon is launched followed by a series of wpa_cli commands that set up a network configuration according to what 'wpa-' options were used in /etc/network/interfaces for the physical device.</p>

							<p>If wpa-roam is used, a wpa_cli daemon is lauched in the 'post-up' phase.</p>

							<p>In the 'pre-down' phase, the wpa_cli daemon is killed if it exists.</p>

							<p>In the 'post-down' phase, the wpa_supplicant daemon is killed.</p>

			<h2>3. Mode #2: Roaming Mode</h2>

							<p>A self contained, simplistic roaming mechanism is provided by this package. It is in the form of a wpa_cli action script, /sbin/wpa_action, and it assumes control of ifupdown once activated. The wpa_action(8) manpage describes its technical details in great depth.</p>

							<p>To activate a roaming interface, adapt the following example interfaces(5) stanza:</p>

<pre>
iface eth1 inet manual
	wpa-driver wext
        wpa-roam /path/to/wpa_supplicant.conf
</pre>

							<p>Two daemons are spawned from the above example; wpa_supplicant and wpa_cli. It is required to provide a wpa_supplicant.conf. A good starting point is provided by an example configuration file:</p>

<pre>
 # copy the template to /etc/wpa_supplicant/
        cp /usr/share/doc/wpasupplicant/examples/wpa-roam.conf \
                /etc/wpa_supplicant/wpa_supplicant.conf
        # allow only root to read and write to file
        chmod 0600 /etc/wpa_supplicant/wpa_supplicant.conf

NOTE: it is critical that the used wpa_supplicant.conf defines the location of
      the 'ctrl_interface' so that a communication socket is created for the 
      wpa_cli (wpa-roam daemon) to attach. The mentioned example configuration,
      /usr/share/doc/wpasupplicant/examples/wpa-roam.conf, has been set to a
      sane default.

</pre>


							<p>It is required to edit this configuration file, and add the network blocks for all known networks. If you do not understand what this means, start reading the wpa_supplicant.conf(5) manpage now.</p>

							<p>For each network, you may specify a special option 'id_str'. It should be set to a simple text string. This text string forms the basis for network profiling; it correlates to a logical interface defined in the interfaces(5) file. When no 'id_str' is given for a network, wpa_action assumes it will use the 'default' logical interface as fallback. The fallback interface can be chosen via the 'wpa-default-iface' option.</p>

							<p>So what does all this mean? Lets illustrate it with a small example taken from the wpa_action(8) manpage.</p>

		<h6>wpa_supplicant.conf example</h6>			
<pre>
wpa_supplicant.conf example:
network={
        ssid="foo"
        key_mgmt=NONE
        # this id_str will notify /sbin/wpa_action to 'ifup uni'
        id_str="uni"
}

network={
        ssid="bar"
        psk=123456789...
        # this id_str will notify /sbin/wpa_action to 'ifup home_static'
        id_str="home_static"
}

network={
        ssid=""
        key_mgmt=NONE
        # no 'id_str' parameter is given, /sbin/wpa_action will 'ifup default'
}
</pre>

	</div>
	<div class="divider" id="wpa2">
		<h6>/etc/network/interfaces example</h6>
<pre>
/etc/network/interfaces example:
# the roaming interface MUST use the manual inet method
# 'allow-hotplug' or 'auto' ensures the daemon starts automatically
allow-hotplug eth1
iface eth1 inet manual

        wpa-driver wext
        wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf

 
# no id_str, 'default' is used as the fallback mapping target
iface default inet dhcp


# id_str="uni"
iface uni inet dhcp

# id_str="home_static"
iface home_static inet static

        address 192.168.0.20
        netmask 255.255.255.0
        network 192.168.0.0

        broadcast 192.168.0.255
        gateway 192.168.0.1
</pre>

							<p>A logical interface is brought up via ifup, and taken down via ifdown, as wpa_supplicant associates and de-associates with the network associated to it by the 'id_str' option used in the wpa_supplicant.conf configuration file.</p>

							<p>A log of /sbin/wpa_action's actions is created at /var/log/wpa_action.log, please attach the log when reporting problems.</p>

			<h2>Interacting with wpa_supplicant with wpa_cli and wpa_gui</h2>

							<p>The wpa_supplicant process can be interacted with by members of the "netdev" group if the example roaming configuration was used as is (or by whatever group or gid specified by the GROUP= crtl_interface parameter).</p>
<pre>
# the default ctrl_interface option used in the example file
	# /usr/share/doc/wpasupplicant/examples/wpa-roam.conf
        ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev

To interact with the supplicant, the wpa_cli (command line) and wpa_gui (QT)
have been provided. With these you may connect, disconnect, add/delete new
network blocks, provide required interactive security information and so on.
</pre>
	
			<h2>Controlling the Roaming Daemon with wpa_action</h2>

							<p>Once the roaming daemon is started, it assumes control of ifupdown. That is; wpa_cli calls ifup when wpa_supplicant has successfully associated with an access point, and calls ifdown when the connection is lost or terminated. While the roaming daemon is active, ifupdown should not be controlled directly by manually issued commands, rather /sbin/wpa_action is supplied to stop and reload the roaming daemon. For example, to stop the romaing daemon on the device 'eth1':</p>

<pre>
wpa_action eth1 stop
</pre>


							<p>When it is required to update the roaming daemon with  a new networks details, it can be done without stopping it. Edit the wpa_supplicant.conf file that is being used by the daemon with the new networks details, add optional network settings to /etc/network/interfaces that are specific to the new network (linked by the 'id_str') and then 'reload' the daemon like so:</p>

<pre>
wpa_action eth1 reload
</pre>

							<p>For the complete technical details of what wpa_action can do, read the wpa_action(8) manpage.</p>

	</div>
	<div class="divider" id="wpa3">
		<h2>Fine Tuning the Roaming Setup</h2>

							<p>You may face situations where multiple known access points are in close proximity. You can choose which one is preferred manually, with wpa_cli or wpa_gui, or you can give each network its own priority. This is provided by the 'priority' option of wpa_supplicant.conf.</p>

	</div>
	<div class="divider" id="wpa4">
		<h2>The Logfile</h2>

							<p>All activity of the roaming dameon is logged to /var/log/wpa_action.log. The following information is logged:</p>

							<p>*time and date<br />
							*interface name and action event<br />
							*values of enviromental variables (WPA_ID, WPA_ID_STR, WPA_CTRL_DIR)<br />
							*ifupdown command executed<br />
							*wpa_cli status (based on WPA-PSK, network may display different info)<br />
							*bssid<br />
							*ssid<br />
							*id<br />
							*id_str<br />
							*pairwise_cipher<br />
							*group_cipher<br />
							*key_mgmt<br />
							*wpa_state<br />
							*ip_address</p>
	
	
	</div>
	<div class="divider" id="wpa5">	
		<h2>Using External Mapping Scripts (e.g. guessnet)</h2>

							<p>In addition to the internal mapping of logical interfaces via 'id_str', wpa_action can call external mapping scripts. A mapping script should return the name of the logical interface which should be brought up. Any mapping script that works from ifupdowns mapping mechanism (see man interfaces) should also work when called from wpa_action.</p>

							<p>To call a mapping script add a line 'wpa-mapping-script name-of-the-script' to  the interfaces stanza of the physical roaming device. (You may have to specify the absolute path to the mapping script.)</p>


							<p>The contents of lines starting with wpa-map are passed to stdin of the mapping  script. Since ifupdown allows only one wpa-map line you can append any number to wpa-map for additional lines. For example:</p>

<pre>
iface wlan0 inet manual
        wpa-driver wext
        wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
        wpa-mapping-script guessnet-ifupdown
        wpa-map0 home
        wpa-map1 work
        wpa-map2 school
        # ... additional wpa-mapX lines as required
</pre>
							<p>By default the mapping script will only be used when no 'id_str' is available for the current network. If you want to completely disable 'id_str' matching and use only an external mapping script, use the 'wpa-mapping-script-priority 1' option to override default behaviour.</p>

							<p>If the mapping script returns an empty string wpa_action will fallback to using the 'default' interface, unless an alternative is defined by the 'wpa-roam-default-iface' option.</p>

							<p>Below is an advanced example, using guessnet-ifupdown as the external mapping script.</p>

					<h6>/etc/network/interfaces with external mapping example</h6>
<pre>
/etc/network/interfaces with external mapping example:
allow-hotplug wlan0
iface wlan0 inet manual

        wpa-driver wext
        wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
        wpa-roam-default-iface default-wparoam
        wpa-mapping-script guessnet-ifupdown
        wpa-map default: default-guessnet
        wpa-map0 home_static
        wpa-map1 work_static


# school can only be chosen via 'id_str' matching
iface school inet dhcp

        # resolvconf
        dns-nameservers 11.22.33.44 55.66.77.88

iface home_static inet static

        address 192.168.0.20
        netmask 255.255.255.0

        network 192.168.0.0
        broadcast 192.168.0.255
        gateway 192.168.0.1
        test peer address 192.168.0.1 mac 00:01:02:03:04:05


iface work_static inet static

        address 192.168.3.200
        netmask 255.255.255.0
        network 192.168.3.0
        broadcast 192.168.3.255

        gateway 192.168.3.1
        test peer address 192.168.3.1 mac 00:01:02:03:04:05

iface default-guessnet inet dhcp

iface default-wparoam inet dhcp
</pre>

							<p>In this example wpa_action will use guessnet for the selection of a suitable logical interface only when no 'id_str' option has been provided for the current network in the provided wpa_supplicant.conf.</p>

							<p>The 'wpa-map' lines provide guessnet with the logical interfaces that are to be tested as well as the default interface to be used when all tests fail. The 'test' lines of each logical interface are used by guessnet to determine if we are actually connected to that network. For instance, guessnet will choose the logical interface 'home_static' if there's a device with an IP address of 192.168.0.1 and MAC of 00:01:02:03:04:05 on the current network. If all tests fail, the 'default-guessnet' interface will be configured.</p>


							<p>Please, read the guessnet(8) manpage for more information.</p>

			<h2>4. Troubleshooting</h2>

							<p>In order to debug connection, association and authentication problems, we suggest starting `wpa_cli -i &lt;interface&gt;` in a different shell, before starting the interface. Use the command 'level 0' first, to get all debug messages. Then use `ifup --verbose &lt;interface&gt;` to get verbose debug messages from the script starting wpasupplicant.</p>
	</div>
	<div class="divider" id="wpa6">
		<h2>Hidden ssids</h2>

							<p>For reference, see #358137. In order to be able to associate to hidden ssids, please try to set the option 'ap_scan=1' in the global section, and  'scan_ssid=1' in your network block section of your wpa_supplicant.conf file. If you are using the managed mode, you can do so by these stanzas:</p>

<pre>
iface eth1 inet dhcp
wpa-conf managed
wpa-ap-scan 1
wpa-scan-ssid 1
# additional options for your setup
</pre>

							<p>According to #368770, association can take a very long time to associate to WEP  secured networks. In some cases, setting the parameter 'ap_scan=2' in the config file, (or using a 'wpa-ap-scan 2' stanza, which is equivalent) can greatly help to speed up association.</p>

 							<p>Please note that setting ap_scan to the value of 2 also requires that all networks have a precisely defined security policy for for key_mgmt, pairwise, group and proto network policy variables.</p>

	</div>	
	<div class="divider" id="wpa7">
		<h2>5. Security Considerations</h2>
				<h5>Configuration of File Permissions</h5>
							<p>It is important to keep PSK's and other sensitive information concerning your network settings private, therefore ensure that important configuration files containing such data are only readable by their owner. For example:</p>

<pre>
chmod 0600 /etc/network/interfaces
# substitute the path of your wpa_supplicant.conf file
chmod 0600 /etc/wpa_supplicant/wpa_supplicant.conf
</pre>
							<p>By default, /etc/network/interfaces is world readable, and thus unsuitable for containing secret keys and passwords.</p>

	</div>
			<div id="rev">Page last revised 08/07/2009 0230 UTC</div>

</div>
</body>
</html>
