<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>sidux Manuals - rdiff-de</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<div id="menu"> <!-- menu starts here de lang maintainer hubi Zophod-->
<!--Welcome to the  sidux-manual Operating System version 01.33-2007-08-22 -->
<!-- menu last updated by bluewater 22/08/2007 1600rs AEST 22/08/2007 0600hrs UTC -->
<img src="../lib/logos/sidux-logo.png" alt="logo" id="menu-header" />
	<ul id="top-list">
		<li><a href="http://sidux.com/">Zu sidux.com</a></li>
		<li><a href="http://manual.sidux.com/meta-manual">sidux Meta-Manual</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-50.png" title="Wählen Sie eine andere Sprache" alt="lang-switch" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-de.htm">Zum sidux-Handbuch</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-de.htm#welcome-gen">Willkommen</a></li>
				<li><a href="welcome-de.htm#how-to">Tipps zum Handbuch</a></li>
				<li><a href="welcome-de.htm#table-contents">Index</a></li>
				<li><a href="help-de.htm#help-gen">Wo es Hilfe gibt</a></li>
				<li><a href="help-de.htm#paste">IRC !paste</a></li>
				<li><a href="credits-de.htm#cred-team">Danksagungen</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-de.htm">CD-Inhalt</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-de.htm#cd-content">Inhalt der Live-CD</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="cd-dl-burning-de.htm">CD Herunterladen &amp; Brennen</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="cd-dl-burning-de.htm#download-sidux">CD herunterladen</a></li>
				<li><a href="cd-dl-burning-de.htm#md5">md5-Prüfsummen</a></li>
				<li><a href="cd-dl-burning-de.htm#burn-nero">Brennen in Windows</a></li>
				<li><a href="cd-dl-burning-de.htm#burn-linux">Brennen in Linux</a></li>
				<li><a href="cd-dl-burning-de.htm#xdelta">xdelta-Patches</a></li>
				<li><a href="cd-no-gui-burn-de.htm#burning-no-gui">Brennen ohne GUI</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-de.htm">Live-CD-Modus</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-de.htm#rootpw">Das Rootpasswort der sidux-Live-CD</a></li>
				<li><a href="live-mode-de.htm#live-cd-installsoft">Installieren von Software während einer Live-CD Sitzung</a></li>
				<li><a href="live-mode-de.htm#ntfs-3g">Schreiben auf NTFS-Partitionen mit ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="term-konsole-de.htm">Das Terminal / Die Konsole</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="term-konsole-de.htm#term-kon"> Terminal/Konsole</a></li>
				<li><a href="term-konsole-de.htm#cli-help">Kommadozeilenhilfe</a></li>
				<li><a href="term-konsole-de.htm#term-cmds">Linux Konsolenbefehle</a></li>
				<li><a href="term-konsole-de.htm#shell-scripts">Installation von Shellskripten</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cheatcodes-de.htm">Boot-Cheatcodes</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cheatcodes-de.htm#cheatcodes">Cheatcodes</a></li>
				<li><a href="cheatcodes-vga-de.htm#vga">VGA-Codes</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="part-gparted-de.htm">Partitionieren der Festplatte</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="part-gparted-de.htm#partition">mit GParted</a></li>
				<li><a href="part-gparted-de.htm#ntfs">NTFS-Partitionen mit GParted ändern</a></li>
				<li><a href="part-uuid-de.htm#uuid">UUID, Partitionsbezeichnung und fstab</a></li>
				<li><a href="part-cfdisk-de.htm#partition">Partitionieren mit cfdisk</a></li>
				<li><a href="part-cfdisk-de.htm#formating">Formatieren mit cfdisk</a></li>
				<li><a href="part-size-examp-de.htm#part-example">Beispiele für Partitionsgrößen</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-de.htm">Installationsoptionen</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-de.htm#Inst-prep">Vorbereiten der Installation</a></li>
				<li><a href="hd-install-de.htm#Installation">Installation auf die Festplatte</a></li>
				<li><a href="hd-install-de.htm#first-hd-boot">Erstes Booten von der Festplatte</a></li>
				<li><a href="hd-install-opts-de.htm#fromiso">Booten 'fromiso'</a></li>
				<li><a href="hd-install-opts-de.htm#usb-hd">Installation auf eine USB-Festplatte</a></li>
				<li><a href="hd-install-opts-de.htm#qemu">Installation über qemu</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-de.htm">Grafikkarten, Hardware, Geräte und Treiber</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="hw-dev-hw-dri-de.htm#hd-ntfs3g">Schreiben auf NTFS-Partitionen mit ntfs-3g</a></li>
				<li><a href="hw-dev-hw-dri-de.htm#mon-res">Bildschirmauflösung und Monitoreinstellungen</a></li>
				<li><a href="hw-dev-hw-dri-de.htm#non-free-3d">Binäre, nicht freie Treiber für Nvidia und ATI</a></li>
				<li><a href="hw-dev-hw-dri-de.htm#native-nv-ati">Freie xorg-Treiber für nVidia, ATI, Radeon, Intel</a></li>
				<li><a href="hw-dev-hw-dri-de.htm#non-free">Hardware mit proprietären Anforderungen</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="wm-kde-de.htm">Fenstermanager</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="wm-kde-de.htm#desk-freeze">Falls der KDE-Desktop einfriert</a></li>
				<li><a href="wm-kde-de.htm#kde-login">Kein Login in KDE möglich</a></li>
				<li><a href="wm-kde-de.htm#ch-th">Themes ändern</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="lamp-apache-de.htm">sidux LAMP-Stack</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="lamp-apache-de.htm#serv-apache">sidux LAMP-Paket</a></li>
				<li><a href="lamp-apache-de.htm#serv-ftp">FTP-Clients</a></li>
				<li><a href="lamp-apache-de.htm#serv-sec">Sichere Protokolle</a></li>
				<li><a href="lamp-apache-de.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-de.htm#serv-mysql">MySQL-Setup</a></li>
				<li><a href="lamp-ppp-de.htm#serv-php">PHP in Apache</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="internet-connecting-de.htm">Internet und Netzwerk</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="ntp-server-de.htm#ntp-server">Zeitserver-Setup</a></li>
				<li><a href="tor-privoxy-de.htm#tor">Tor</a></li>
				<li><a href="tor-privoxy-de.htm#privoxy">Privoxy</a></li>
				<li><a href="internet-connecting-de.htm#firewalls">Firewalls</a></li>
				<li><a href="samba-de.htm#configure">SAMBA: Windows-Freigaben nutzen</a></li>
				<li><a href="samba-de.htm#setup">Einen Samba-Server aufsetzen</a></li>
				<li><a href="ssh-de.htm#ssh-fs">SSH:Einbindung eines entfernten Computers</a></li>
				<li><a href="ssh-de.htm#ssh-x">X-Window-Programme via SSH verwenden</a></li>
				<li><a href="ssh-de.htm#ssh-f">SSH: GUI mit Konqueror</a></li>
				<li><a href="ssh-de.htm#ssh-w">SSH: X-Forwarding von Windows</a></li>
				<li><a href="ssh-de.htm#ssh">SSH: Sicherheit</a></li>
				<li><a href="internet-connecting-de.htm#dial-mod">56k-Modems</a></li>
				<li><a href="internet-connecting-ndis-de.htm#ndiswrapper-basic">Ndiswrapper aktivieren</a></li>
				<li><a href="internet-connecting-ndis-de.htm#ndiswrapper-advanced">Ndiswrapper aktivieren (ausführlicher)</a></li>
				<li><a href="internet-connecting-wpa-de.htm#wpa">WIFI - WLAN</a></li>
				<li><a href="internet-connecting-de.htm#internetsharing">Geteilte Internetverbindungen</a></li>
				<li><a href="internet-connecting-de.htm#netcardconfig">Internet &amp; Netzwerk</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-apt-de.htm">Paketverwaltung</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="sys-admin-apt-de.htm#apt-cook">APT-Kochbuch, sources.list</a></li>
				<li><a href="sys-admin-meta-de.htm#meta-pack">Meta-Pakete installieren</a></li>
				<li><a href="sys-admin-meta-de.htm#meta-proxy">Meta installieren und Proxies</a></li>
				<li><a href="sys-admin-apt-de.htm#apt-install">Neue Pakete installieren</a></li>
				<li><a href="sys-admin-apt-de.htm#apt-delete">Pakete löschen</a></li>
				<li><a href="sys-admin-apt-de.htm#apt-downgrade">Downgraden bzw. "Hold" eines Pakets</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="sys-admin-apt-de.htm">Systemadministration</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="sm-siduxcc-de.htm#sm">smxi Befehls-Syntax</a></li>
				<li><a href="sm-siduxcc-de.htm#siduxcc">siduxcc</a></li>
				<li><a href="sys-admin-apt-de.htm#apt-upgrade">Upgrade eines installierten Systems</a></li>
				<li><a href="sys-admin-upgrade-de.htm#live-cd-upgrade">Upgrade durch die Live-CD</a></li>
				<li><a href="sys-admin-kern-upg-de.htm#kern-upgrade">Upgrade des Kernels</a></li>
				<li><a href="sys-admin-rdiff-de.htm#rdiff">Backup mit rdiff</a></li>
				<li><a href="sys-admin-rsync-de.htm#rsync">Backup mit rsync</a></li>
				<li><a href="vir-rkits-de.htm#virus-rkits">Virus- und Rootkitscanner</a></li>
				<li><a href="sys-admin-gen-de.htm#start-services">Einen Dienst in sidux starten</a></li>
				<li><a href="sys-admin-gen-de.htm#pw-lost">Rootpasswort vergessen</a></li>
				<li><a href="sys-admin-gen-de.htm#fonts">Schriftarten</a></li>
				<li><a href="sys-admin-gen-de.htm#cups">CUPS</a></li>
				<li><a href="sys-admin-gen-de.htm#init">sidux-Runlevels - init</a></li>
				<li><a href="sys-admin-grub-bootman2-de.htm#mbr-grub-boot">MBR-Bootsektor überschrieben</a></li>
				<li><a href="sys-admin-grub-bootman2-de.htm#dual-boot">Dual- und Multibooting</a></li>
				<li><a href="sys-admin-grub-bootman2-de.htm#boot-grub-floppy">Eine Boot-Floppy erstellen</a></li>
				<li><a href="sys-admin-grub-bootman2-de.htm#remove-grub">Grub aus MBR entfernen</a></li>
				<li><a href="sys-admin-grub-bootman2-de.htm#what-is-grub">Grub: der Bootmanager</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="rdiff">
			<h2 id="top-header">Systemsicherung mit rdiff-backup</h2>
				<p>rdiff-backup ist eine Applikation zur Dateisicherung, welche unter verschiedenen *nix-Systemen eingesetzt werden kann.<br />
				Unter sidux hat man die Wahl, wie verschiedene Prozesse eingeleitet werden, selbstbestimmt ("klassisch") oder mit Hilfe eines Scriptes.</p>

				<h3><a href="http://techpatterns.com/forums/about831.html">Hier die Script-Version von h2</a></h3>
	<div class="spacer02"></div>
			<h5>Ab hier wird das klassische, selbstbestimmte Verfahren beschrieben.</h5>

			<h5>rdiff-backup</h5>
				<p>* besonders geeignet zur Wiederherstellung des Systems nach einem missglückten dist-upgrade, bei Problemen nach einem kernel-upgrade u. a., oder einfach zur Wiederherstellung älterer Fassungen einzelner Dateien.<br /></p>
				<p>* wie bei rsync wird nur gesichert, was verändert wurde (sehr schneller Sicherungsvorgang!)<br /></p>
				<p>* verschiedene Sicherungsebenen werden angelegt - "Sicherungsgeschichte" (das bedeutet, es kann auch eine Datei wiederhergestellt werden, welche drei Wochen zuvor am Arbeitssystem bereits gelöscht wurde!)<br /></p>
				<p>* ein Backup kann im Netzwerk über eine sichere Verbindung durchgeführt werden (Verwendung von ssh).<br /></p>
				<p>* ein Backup von eingehängten (gemounteten) Partitionen kann angelegt werden (dies ermöglicht ein einfaches automatisches und tägliches Backup, ohne manuell eine Partition aushängen zu müssen).<br /></p>
				<p>* nach einem Festplattentod können sämtliche Daten auf einer neuen Festplatte wieder hergestellt werden<br /></p>
				<p>* skaliertes Backup großer Netzwerke (problemlos in Linux-Netzwerken, Windows-Netzwerke sind komplexer zu handhaben), benutzt auch in kommerziellen Umgebungen<br /></p>
				<p>* es ist eine Kommandozeilenapplikation, womit es besonders geeignet ist, automatisierte Backups einzurichten (z. B. über ein Bash-Script, welches über cron aufgerufen wird)<br /></p>
				<p>* kann mit Angaben zu Dateibesitzer und Dateiberechtigungen umgehen wie auch mit symbolischen Verknüpfungen (und noch viel mehr), sodass nach einer Rückspielung von Daten ein exaktes Abbild des ursprünglichen Zustands wiederhergestellt wird.</p>

			<h5>Was benötigt wird</h5>
				<p>rdiff-backup legt eine nichtkomprimierte Kopie der Dateien, welche gesichert werden, an, und es wird eine Backup-"Geschichte", ein inkrementelles Backup angelegt. Somit muss der Speicherplatz des Backups größer sein als die Größe der Dateien, welche gesichert werden. Wenn z. B. 100 GB gesichert werden sollen, sollte ein Speicherplatz von etwa 120 GB vorhanden sein, am besten auf einer eigenen Festplatte. Der benötigte Speicherplatz kann natürlich variieren.</p>

			<h5>Einrichtung</h5>
				<p>Gehen wir von folgenden Spezifikationen des PCs aus:<br /></p>
				<p>* eine Festplatte mit 100 GB (hda), hda1 ist die Rootpartition, hda5 ist die Partition für Musik und andere Dateien, hda6 ist die Swap-Partition.<br /></p>
				<p>* eine extra Festplatte (hdb) mit 200 GB, welche nicht im Produktivsystem aktiv ist und die nach hdb1 eingebunden wird. Diese Festplatte wird für Sicherheitsbackups verwendet.<br /></p>
				<p>* Die IP-Addresse ist 192.168.0.1</p>

				<p>Als erstes wird rdiff-backup installiert:</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<p>Obwohl nun bereits Backups von jeglichem Ordner angelegt werden können, wollen wir zeigen, wie ganze Partitionen gesichert werden können: gesichert werden sollen hda1 und hda5 (nicht hda6). Als erstes legen wir Ordner an, wohin das Backup gespielt werden soll:</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/root
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Die IP-Adresse wird angegeben für den Fall, dass von einem anderen Computer ebenfalls Backups auf dieser Festplatte gespeichert werden sollen (siehe unten).</p>

			<h5>Das Backup</h5>

				<p>rdiff-backup verwendet folgende Syntax: <span class="highlight-3">rdiff-backup Quellverzeichnis Zielverzeichnis</span>. Beachte: es werden immer Verzeichnisnamen, nicht Dateinamen angegeben!</p>

				<p>Um ein Backup von hda5 anzulegen, wird folgender Befehl eingegeben:</p>
<pre>
# rdiff-backup /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Um ein Backup der Root-Partition anzulegen, wird folgender Befehl eingegeben::</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
</pre>
				<p>Fehlermeldungen mit "AF_UNIX path too long" können ignoriert werden. Der Backupvorgang kann beim ersten Mal längere Zeit beanspruchen, da die gesamte Partition gesichert wird. Beachte auch, dass /tmp nicht gesichert wird, da dieses Verzeichnis ständigen Veränderungen unterworfen ist. Ebensowenig werden /proc und /sys gesichert, da diese Verzeichnisse keine reellen Dateien beinhalten. Auch werden eingebundene Datenträger nicht gesichert, da in diesem Falle hdb1 ebenfalls gesichert würde, was in einer unendlichen Schleife, einem unendlichen Loop enden könnte! Um dies zu verhindern, können andere eingebundene Datenträger separat gesichert werden.</p>

				<p>Der Grund, warum '/proc/*' und nicht einfach '/proc' gesetzt wurde, liegt darin, dass damit ein Backupverzeichnis /proc angelegt wird, der Inhalt jedoch ignoriert. Gleiches trifft auf /tmp, /sys und alle anderen Mountpunkte zu. Man sieht, mit rdiff-backup kann ein hochintelligentes Backup angelegt werden.</p>

				 <p>Das bedeutet, nach einer Zerstörung der Root-Partition kann ein vollständiges Backup wieder eingespielt werden, die Mountpunkte /tmp, /proc, /sys und alle weiteren originale Mountpunkte werden wieder angelegt (genau, wie es sein soll). Wenn z. B. /tmp beim Start von X nicht existieren würde, könnte ein Problem gegeben sein (siehe die man-page für mehr Optionen bezüglich --exclude und --include).</p>

			<h5>Wiederherstellung von Verzeichnissen aus dem Backup</h5>

				<p>rdiff-backup verwendet folgende Syntax:</p>
<pre>
rdiff-backup -r from-when source-dir dest-dir
</pre>
				<p>from-when: von wann<br />
				source-dir: Quellverzeichnis<br />
				dest-dir: Zielverzeichnis</p>
				<p>Angenommen, das Verzeichnis /media/hda7/photos wurde irrtümlich gelöscht, so kann es mit folgendem Befehl wiederhergestellt werden:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5/photos /media/hda5/photos
</pre>
				<p>Die Option "-r now" bedeutet eine Wiederherstellung des letzten Backups. Wenn nun periodisch (via crontab etwa) ein Backup erstellt und erst einige Tage nach der Löschung bemerkt wurde, dass das Verzeichnis photos fehlt, muss ein älteres Backup zur Wiederherstellung herangezogen werden (damit nicht die Option "now"). Ein anderes Anwendungsgebiet wäre die Wiederherstellung einer älteren Version einer gegebenen Datei.</p>

				<p>Zur Wiederherstellung eines drei Tage alten Backups wird verwendet:"-r 3D" ... aber, wie in der man-page steht, soll beachtet werden:</p>

				<p class="highlight-1">"3D" refers to the instant 72 hours before the present, and if there was no backup made at that time, rdiff-backup restores the state recorded for the previous backup. For instance, in the above case, if "3D" is used, and there are only backups from 2 days and 4 days ago, the directory would be restored as it was 4 days ago (so you have to think about it before you restore).</p>
				<p>Sinngemäße Übersetzung:</p>
				<p><em>"3D" bezieht sich auf genau 72 Stunden vor der Jetztzeit, und wenn zu diesem Zeitpunkt kein Backup angelegt wurde, wird das letzte Backup davor zur Wiederherstellung herangezogen. Wenn zum Beispiel im obigen Fall "3D" verwendet wird und nur Backups vorhanden sind, welche 2 Tage und 4 Tage alt sind, würde das 4 Tage alte Verzeichnis wiederhergestellt werden (eine Wiederherstellung benötigt also eine genaue Planung vor der Durchführung).</em></p>

				<p>Folgender Befehl listet Datum und Zeitpunkt der letzten Backups von hda5:</p>
<pre>
# rdiff-backup -l /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
			<h5>Wiederherstellung von Partitionen</h5>

				<p>Es können auch ganze Partitionen (Mountpunkte) wiederhergestellt werden, denn schließlich ist ein Mountpunkt auch nur ein Verzeichnis.</p>

				<p class="highlight-2">WARNUNG: Das Root-Verzeichnis darf nicht wiederhergestellt werden, wenn in dieses gebootet wurde! Mit einem einzigen Befehl gehen alle Dateien auf allen Partitionen inklusive aller Backups auf weiteren Festplatten verloren!! rdiff-backup führt exakt das durch, welchen Auftrag es bekommen hat ... Wenn das Backup der Root-Partition leere Mountpunkte hat und der Auftrag der Wiederherstellung ist, diese Mountpunkte ebenso zu rekreieren, wird alles in den gegebenen Mountpunkten gelöscht, um nach Auftrag leere Mountpunkte zu erstellen.</p>

				<p>Um hda5 vom letzten Backup wiederherzustellen, genügt folgender Befehl:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5 /media/hda5
</pre>
			<h5>Wiederherstellung der Root-Partition</h5>

				<p>Die Wiederherstellung der Root-Partition ist keine einfache, triviale Aufgabe. Die Root-Partition darf nicht wiederhergestellt werden, während sie eingebunden (gemountet) ist (siehe Warnung oben). Aber es ist durchaus sinnvoll, in der Lage zu sein, die Root-Partition wiederherstellen zu können. Denn ein dist-upgrade oder ein kernel-upgrade kann auch mal misslingen, und es ist beruhigend zu wissen, dass das System so neu eingespielt werden kann, wie es vor den Problemen war. Der Zeitaufwand beträgt nur etwa 20 Minuten.</p>

				<p>Eine Möglichkeit, die Root-Partition wieder herzustellen, ist, in eine weitere Linux-Partition zu booten, so eine auf der Festplatte vorhanden ist. Danach kann die gewünschte Partition wieder hergestellt werden, da sie nicht als Root-Partition eingebunden ist. Nach Wiederherstellung der Partition kann in sie gebootet werden, und sie wird exakt so aussehen wie zu dem Zeitpunkt, zu dem das Backup angelegt wurde ... genau so! Dies ist die bei weitem leichteste Methode.</p>

				<p>Eine weitere Möglichkeit, die Root-Partition wieder herzustellen, ist, mit der sidux Live-CD zu booten und die Wiederherstellung mit diesem System durchzuführen. rdiff-backup ist auf der sidux Live-CD enthalten. Falls die sidux Live-CD kein rdiff-backup enthalten würde, kann in die Grub-Zeile (Bootoptionen, Cheatcodes) die Option "unionfs" eingegeben werden, wonach weitere Pakete auch im Live-CD-Modus installiert werden können. Im gegebenen Fall sind die Befehle:</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h5>Und jetzt die Wiederherstellung:</h5>
<pre>
# mount /dev/hda1 /media/hda1
# mount /dev/hdb1 /media/hdb1
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Beachte: Bei Nutzung einer anderen Live-CD als sidux und im Falle, dass diese klik unterstützt, kann rdiff-backup unter Verwendung von klik mit folgendem Befehl installiert werden:</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Es ist empfohlen, dass die Wiederherstellung einer Root-Partition mit rdiff-backup getestet wird, um im Ernstfall nicht auf unerwartete Probleme zu stoßen.</p>

			<h5>Sicherung weiterer PCs</h5>

				<p>Es können Daten weiterer Computer auf dem lokalen PC gesichert werden, wenn der lokale PC sich mittels ssh zu den anderen Computern verbinden kann (und natürlich Speicherplatz vorhanden ist). Der ssh-Server (sshd) muss am entfernten (remote) Computer laufen. Der andere Computer muss sich nicht im lokalen Netzwerk (LAN) befinden, er kann irgendwo in der weiten Welt stationiert sein.</p>

				<p>Angenommen, der entfernte (remote) Computer/PC hat folgende Spezifikationen:<br /></p>
				<p>1) Eine Festplatte (hda) mit 100 GB, die mit folgenden Mountpunkten in Verwendung ist:<br />
				2) hda1 ist die Root-Partition,<br />
				3) hda5 speichert temporäre Dateien, welche nicht gesichert werden sollen,<br />
				4) hda6 ist die Swap-Partition<br />
				5) die IP-Adresse ist 192.168.0.2</p>

				<p>Beachte: zwei Festplatten mit je 100 GB können normalerweise nicht auf eine Festplatte mit 200 GB gesichert werden, wenn rdiff-backup verwendet wird, das der Platz für inkrementelle Backups fehlen würde. Da jedoch hda5 des entfernten (remote) PCs nicht gesichert werden soll und - auch wenn man sich nicht darauf verlassen soll - Partitionen in der Regel nicht zu 100 Prozent voll sind, kann man damit spekulieren, dass genug Speicherplatz für das Backup vorhanden ist. Es soll aber berücksichtigt werden, dass jedes Backup mehr Speicherplatz in Anspruch nimmt, da inkrementelle Dateien zugefügt werden.</p>

				<p>rdiff-backup kann beauftragt werden, nur Backups zu behalten, die nicht älter als einen Monat sind (siehe unten). Dies nimmt selbstverständlich weniger Speicherplatz in Anspruch, als wenn Daten über Jahre hinweg gesichert werden. Im letzteren Fall muss selbstverständlich der Speicherplatz vorhanden sein, um Jahre von Daten inkrementell sichern zu können.</p>

				<p>Als erstes muss rdiff-backup am entfernten (remote) PC installiert werden (jeder Computer, dessen Daten gesichert werden sollen, muss - wie auch der Backup-Server - rdiff-backup installiert haben).</p>

				<p>Um den entfernten (remote) PC am lokalen PC zu sichern, wird am lokalen PC (192.168.0.1) gestartet <span class="highlight-4">(beachte den doppelten Doppelpunkt ::) </span>:</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/media/hdb1/rdiff-backups/192.168.0.2/root
</pre>
				<p>Um nun ein Verzeichnis auf dem entfernten (remote) PC wiederherzustellen, wird der Wiederherstellungsprozess entweder am lokalen oder am entfernten (remote) PC in Gang gesetzt.</p>

				<p>So wird das Verzeichnis /usr/local/games auf dem entfernten (remote) PC wiederhergestellt, indem der Prozess am entfernten (remote) PC initiiert wird:</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<p>So wird das Verzeichnis /usr/local/games auf dem entfernten (remote) PC wiederhergestellt, indem der Prozess am lokalen PC initiiert wird:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<p>Die gleiche Syntax wird verwendet, wenn die Root-Partition von einer Live-CD wiederhergestellt wird (wenn der entfernte (remote) PC durch eine Live-CD gebootet wurde ... siehe oben).</p>

			<h5>Automatisierung von Backups:</h5>

				<p>Wenn Backups von anderen PCs auf dem eigenen lokalen gespeichert werden, sollte zunächst ein passwortfreier ssh-Login unter Verwendung von ssh-Schlüsseln (ssh-keys) eingerichtet werden. <span class="highlight-2">Beachte, dies bedeutet passwortfreie ssh-Logins als root. Dies kann beschränkt werden, dass nur Befehle von rdiff-backup ausgeführt werden, aber diese Vorgehensweise ist außerhalb des Rahmens dieser Anleitung, siehe daher: <a href="samba-de.htm#ssh-s">SSH Configuration</a> </span>.  Wir setzten absolute Vertrauenswürdigkeit voraus und zeigen die einfachste Möglichkeit, wie ein passwortfreier ssh-Login angelegt werden kann.</p>

				<p>Vom lokalen PC ist der Befehl:</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<p>Für leere Passwörter wird zweimal die Entertaste gedrückt. Danach:</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\ <!--dunno if this wrong-->
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<p>Das Root-Passwort wird angefragt.</p>

				<p>Jetzt kann eine ssh-Verbindung als root zum entfernten (remote) PC aufgebaut werden, ohne ein Passwort eintippen zu müssen, womit rdiff-backup nun automatisiert werden kann.</p>

				<p>Als nächstes wird ein Bash-Script geschrieben, welches alle rdiff-backup-Befehle enthält. Dieses Bash-Script kann folgendermaßen aussehen:</p>


<pre> #!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Backing up 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
echo "(and purge increments older than 1 month)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Backing up 192.168.0.1 mount hda5======="
${RDIFF} --ssh-no-compression --exclude /media/hda5/myjunk /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo
echo "=======Backing up 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*' 192.168.0.2::/media/hdb1/rdiff-backups/192.168.0.2/root
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.2/root </pre>


				<p>Wir nennen das Bash-Script "myrdiff-backups.bash" und speichern es unter /usr/local/bin auf unserem lokalen PC, der als Backup-Server dient, und machen es ausführbar (executable). Zum Testen wird das Script nun ausgeführt, um sicherzugehen, dass es funktioniert.</p>

				<p>Zu guter Letzt lassen wir cron unser Bash-Script jeden Abend um 20 Uhr ausführen. Um dies der crontab von root zu übertragen, muss folgendes gemacht werden:</p>
<pre>
# crontab -e
</pre>
				<p>Nun folgende Zeile einfügen:</p>
<pre>
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

			<div id="rev">Page last revised 09/05/2007 0330 UTC</div>
</div>
</div>
</body>
</html>
