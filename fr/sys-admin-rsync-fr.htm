<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
	<title>Manuel de sidux - rsync</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body id="welcome">
<div id="menu"> <!-- menu starts here fr lang maintainer LjanA-->
<!--Welcome to the  sidux-manual Operating System Manual version-01.65.2008.01.21 -->
<!-- menu last updated by LjanA 23/01/2008 1800 hrs AEST 23/01/2008 0700 hrs UTC -->
<a href="http://sidux.com/"><img src="../lib/logos/sidux-logo.png" title="Vers sidux.com, forum et wiki" alt="sidux.com logo" id="menu-header" /></a>
	<ul id="top-list">
		<li><a href="wel-quickstart-fr.htm#welcome-quick">Guide rapide de sidux</a></li>
		<li><a href="http://manual.sidux.com/meta-manual">Méta-Manuel de Sidux</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-language-64.png" title="Choisir une autre langue - Choose another language" alt="lang-switch" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-fr.htm">Manuel du système sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-fr.htm#welcome-gen">Manuel du système sidux</a></li>
				<li><a href="welcome-fr.htm#how-to">Comment utiliser ce manuel</a></li>
				<li><a href="welcome-fr.htm#table-contents">Table des matières</a></li>
				<li><a href="help-fr.htm#help-gen">Où trouver de l'aide</a></li>
				<li><a href="help-fr.htm#paste">IRC !paste</a></li>
				<li><a href="credits-fr.htm#cred-team">Mérites</a></li>
				<li><a href="wel-quickstart-fr.htm#welcome-quick">Guide rapide de sidux</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-fr.htm">Contenus du CD</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-fr.htm#cd-content">Contenus du CD</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="cd-dl-burning-fr.htm">Télécharger et graver le CD</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="cd-dl-burning-fr.htm#download-sidux">Miroirs de téléchargement, Télécharger et graver le CD</a></li>
				<li><a href="cd-dl-burning-fr.htm#md5">Vérification de la la somme md5</a></li>
				<li><a href="cd-dl-burning-fr.htm#burn-nero">Graver sous Windows</a></li>
				<li><a href="cd-dl-burning-fr.htm#burn-linux">Graver sous Linux</a></li>
				<li><a href="cd-dl-burning-fr.htm#xdelta">Patcher avec xdelta</a></li>
				<li><a href="cd-no-gui-burn-fr.htm">Graver depuis la console</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-fr.htm">Mode Live</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-fr.htm#rootpw">Mot de passe Root sur le Live-CD</a></li>
				<li><a href="live-mode-fr.htm#live-cd-installsoft">Installer des logiciels en mode Live</a></li>
				<li><a href="live-mode-fr.htm#ntfs-3g">Écrire sur des partitions NTFS avec ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="term-konsole-fr.htm">Le Terminal/Konsole</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="term-konsole-fr.htm#sux"> sux</a></li>
				<li><a href="term-konsole-fr.htm#term-kon"> Le Terminal/Konsole</a></li>
				<li><a href="term-konsole-fr.htm#cli-help">L'aide en ligne de commande</a></li>
				<li><a href="term-konsole-fr.htm#term-cmds">Liste de commandes pour Terminal</a></li>
				<li><a href="term-konsole-fr.htm#shell-scripts">Scripts d'installation .sh</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cheatcodes-fr.htm">Codes de démarrage</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cheatcodes-fr.htm#cheatcodes">Codes de démarrage spécifiques au CD sidux</a></li>
				<li><a href="cheatcodes-fr.htm#cheatcodes-linux">Codes de démarrage génériques Linux</a></li>
				<li><a href="cheatcodes-vga-fr.htm#vga">Codes VGA </a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="part-gparted-fr.htm">Partitionner son disque dur</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="part-gparted-fr.htm#partition">Partitionner avec GParted</a></li>
				<li><a href="part-gparted-fr.htm#ntfs">Retailler les partitions NTFS avec GParted</a></li>
				<li><a href="part-uuid-fr.htm#uuid">UUID, Labels de Partitions et fstab</a></li>
				<li><a href="part-cfdisk-fr.htm#disknames">Désignation des disques et partitions</a></li>
				<li><a href="part-cfdisk-fr.htm#partition">Partitionner  son DDur avec cfdisk</a></li>
				<li><a href="part-cfdisk-fr.htm#formating">Formater après un partitionnement cfdisk</a></li>
				<li><a href="part-size-examp-fr.htm#part-example">Exemples de tailles de partitions</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-fr.htm">Options d'installation</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-fr.htm#Inst-prep">Préparer son Installation</a></li>
				<li><a href="hd-install-fr.htm#Installation">Installer sur son DDur</a></li>
				<li><a href="hd-install-fr.htm#first-hd-boot">Premier démarrage sur DDur</a></li>
				<li><a href="hd-install-opts-fr.htm#fromiso">Démarrage  'fromiso'</a></li>
				<li><a href="hd-install-opts-fr.htm#fromiso-persist">fromiso et persist</a></li>
				<li><a href="hd-install-opts-fr.htm#usb-hd">Installer sur un DDur USB</a></li>
				<li><a href="hd-install-opts-fr.htm#vtbox">Installer sidux avec VirtualBox</a></li>
				<li><a href="hd-install-opts-fr.htm#qemu">Installer sidux avec QEMU</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-fr.htm">Cartes Graphiques, Matériels et pilotes</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="hw-dev-hw-dri-fr.htm#hd-ntfs3g">Écritures sur NTFS</a></li>
				<li><a href="hw-dev-hw-dri-fr.htm#mon-res">Définition d'écran et moniteurs</a></li>
				<li><a href="hw-dev-hw-dri-fr.htm#non-free-3d">Binaires, pilotes propriétaires pour : Nvidia / ATI</a></li>
				<li><a href="hw-dev-hw-dri-fr.htm#native-nv-ati">Pilotes libres xorg pour nVidia, ATI, Radeon, Intel</a></li>
				<li><a href="hw-dev-hw-dri-fr.htm#non-free">Matériels nécessitant des outils propriétaires</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="wm-kde-fr.htm">Environnements Fenêtrés</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="wm-kde-fr.htm#desk-freeze">Gel du bureau KDE</a></li>
				<li><a href="wm-kde-fr.htm#kde-login">KDE ne se lance pas</a></li>
				<li><a href="wm-kde-fr.htm#ch-th">Changer de Thème</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="lamp-apache-fr.htm">Suite LAMP sidux</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="lamp-apache-fr.htm#serv-apache">Suite LAMP sidux</a></li>
				<li><a href="lamp-apache-fr.htm#serv-ftp">Clients FTP</a></li>
				<li><a href="lamp-apache-fr.htm#serv-sec">Protocoles de sécurité</a></li>
				<li><a href="lamp-apache-fr.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-fr.htm#serv-mysql">Configurer MySQL</a></li>
				<li><a href="lamp-ppp-fr.htm#serv-php">PHP dans Apache</a></li>
				<li><a href="ntp-server-fr.htm#ntp-server">Configurer le serveur de Temps</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-apt-fr.htm">Installer/Désinstaller et rétrograder les paquetages</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="sys-admin-apt-fr.htm#apt-cook">Guide pour APT et listes de sources</a></li>
				<li><a href="sys-admin-meta-fr.htm#meta-pack">Installateur de Meta-Paquets</a></li>
				<li><a href="sys-admin-meta-fr.htm#meta-proxy">Installateur de Meta-Paquets et Proxies</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-install">Installer un nouveau paquet</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-delete">Désinstaller un paquet</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-downgrade">Rétrograder/Conserver un paquet</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-cache">Chercher un paquetage avec apt-cache</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-kio">Chercher un paquetage avec kio-apt</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-upgrade">Mettre à niveau un système installé - dist-upgrade</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="internet-connecting-fr.htm">Internet et Réseau</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="tor-privoxy-fr.htm#tor">Tor</a></li>
				<li><a href="tor-privoxy-fr.htm#privoxy">Privoxy</a></li>
				<li><a href="internet-connecting-fr.htm#firewalls">Firewalls</a></li>
				<li><a href="samba-fr.htm#configure">Configuration SAMBA (Windows)</a></li>
				<li><a href="samba-fr.htm#setup">Configuration de serveur Samba</a></li>
				<li><a href="ssh-fr.htm#ssh-fs">Montage SSH distant</a></li>
				<li><a href="ssh-fr.htm#ssh-x">Applications X Window via SSH</a></li>
				<li><a href="ssh-fr.htm#ssh-f">SSH en graphique avec Konqueror</a></li>
				<li><a href="ssh-fr.htm#ssh-w">Transmission-X par SSH depuis un PC Windows</a></li>
				<li><a href="ssh-fr.htm#ssh">SSH et Sécurité</a></li>
				<li><a href="internet-connecting-fr.htm#dial-mod">Modems 56k</a></li>
				<li><a href="internet-connecting-ndis-fr.htm#ndiswrapper-basic">Activation de Ndiswrapper</a></li>
				<li><a href="internet-connecting-ndis-fr.htm#ndiswrapper-advanced">Activation avancée de Ndiswrapper</a></li>
				<li><a href="internet-connecting-wpa-fr.htm#wpa">WIFI-WLAN</a></li>
				<li><a href="internet-connecting-fr.htm#netcardconfig">Se connecter au Web - Ceni</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="smxi-fr.htm">Administration Système</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="smxi-fr.htm#sm">Syntaxe des commandes smxi</a></li>
				<li><a href="siduxcc-fr.htm#siduxcc">Centre de Contrôle Sidux</a></li>
				<li><a href="sys-admin-apt-fr.htm#apt-upgrade">Mettre à niveau un système installé: dist-upgrade</a></li>
				<li><a href="sys-admin-upgrade-fr.htm#live-cd-upgrade">Mettre à niveau à partir d'un Live-CD</a></li>
				<li><a href="sys-admin-kern-upg-fr.htm#kern-upgrade">Mise-à-niveau du noyau</a></li>
				<li><a href="sys-admin-rdiff-fr.htm#rdiff">Sauvegarde avec rdiff</a></li>
				<li><a href="sys-admin-rsync-fr.htm#rsync">Sauvegarde avec rsync</a></li>
				<li><a href="vir-rkits-fr.htm#virus-rkits">Virus et Scanners de Rootkits</a></li>
				<li><a href="sys-admin-gen-fr.htm#start-services">Activer/désaciver les services</a></li>
				<li><a href="sys-admin-gen-fr.htm#pw-lost">Mots passe Root perdus</a></li>
				<li><a href="sys-admin-gen-fr.htm#fonts">Fontes</a></li>
				<li><a href="sys-admin-gen-fr.htm#cups">CUPS -imprimantes</a></li>
				<li><a href="sys-admin-gen-fr.htm#init">niveaux de fonctionnement sidux-init</a></li>
				<li><a href="sys-admin-grub-bootman2-fr.htm#mbr-grub-boot">Effacement du secteur de boot MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-fr.htm#dual-boot">Double et multi-démarrage</a></li>
				<li><a href="sys-admin-grub-bootman2-fr.htm#boot-grub-floppy">Créer une disquette de Boot</a></li>
				<li><a href="sys-admin-grub-bootman2-fr.htm#remove-grub">Enlever grub du MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-fr.htm#what-is-grub">Grub, le getionnaire de démarrage</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --></div>
<div id="main-page">
	<div class="divider" id="rsync">
			<h2 id="top-header">Sauvegarder avec rsync</h2>

<p>Ce qui suit vous apporte quelques connaissances pratiques sur ce que peut faire rsync et quelques exemples de codes utilisables dans vos propres scripts de sauvegarde.</p>

<p>rsync est un programme de sauvegarde de fichiers particulièrement facile à utiliser ; il permet des sauvegardes rapides des fichiers et répertoires. C'est possible grâce à l'utilisation de routines particulièrement astucieuses, vérifiant si les fichiers ont pu être modifiés, et sélectionnant pour le traitement et la copie, les seuls objets qui l'aient effectivement été. Rsync utilise aussi un outil de compression accélérant le processus de duplication <span class=" highlight-3">(lorsqu'on lui adresse explicitement l'option -z)</span>. Voici quelques détails de son fonctionnement:</p>

<p>Le programme rsync détecte les fichiers et répertoires qu'il est nécessaire de copier en vérifiant si certains de leurs attributs ont changé (par exemple leur dernière date/heure de modification, ou leur taille), et si c'est le cas, en déduit qu'il s'agisse de quelque chose qui n'ait pas été sauvegardé auparavant. Ce processus de sélection est particulièrement rapide.</p>

<p>Lorsque rsync a achevé la création de la liste à utiliser, la copie des fichiers/répertoires modifiés est réalisée très vite parce qu'une routine de compression s'exécute durant le processus de copie, avant l'envoi, et que c'est une fois les copies reçues à leur adresse de destination, qu'elles sont décompressées "à la volée".</p>

<p>rsync peut dupliquer des fichiers:<br />
							* d'un système local vers lui-même,<br />
 							* d'un système local vers une machine distante,<br />
							* d'une machine distante vers une machine locale.</p>

<p>Il utilise indifférament le client <a href="ssh-fr.htm">ssh</a> par défaut, ou un démon rsync activé sur chacune des machines utilisée, machine source et machine cible. Ses pages man précisent, que si vous êtes en mesure de vous connecter à un système en utilisant ssh, rsync le pourra aussi.</p>

<p class="highlight-3">Une limitation de Rsync réside dans son INCAPACITÉ à copier des fichiers d'une machine distante à une autre machine distante. Pour ce faire, il vous faudrait copier la source sur votre système local en préalable, pour l'adresser ensuite à la seconde machine distante.</p>

<p>Pour fournir un exemple de cette logique, imaginons disposer de trois ordinateurs;</p>

<pre>
neo – notre système local
morpheus – une machine distante
trinity – une autre machine distante
</pre>


<p>Vous voulez utiliser rsync à copier, synchroniser les répertoires de données inclus dans /home/utilisateur/repertoire_de_donnees de plusieurs machines entre elles. Chaque système "appartient à" un utilisateur spécifique, en d'autres mots un utilisateur précis utilise tel ou tel système précis, qui est sensé être utilisé comme "source" pour les deux autres machines. Vous allez donc devoir lancer la commande rsync sur le système "local" de départ seulement, que nous avons appelé neo :</p> 


<pre>
l'utilisateur principal de neo est cuddles
l'utilisateur principal de morpheus est tartie
l'utilisateur principal de trinity est taylar
</pre>

<p>Récapitulons : ce que nous voulons est sauvegarder et/ou synchroniser les données suivantes :</p>

<pre>
le contenu de /home/cuddles/repertoire_de_donnees de neo
 vers morpheus et trinity,
le contenu de /home/tartie/repertoire_de_donnees de morpheus
 vers neo et trinity,
le contenu de /home/taylar/repertoire_de_donnees de trinity
 vers neo et morpheus.
</pre>

<p>Le problème avec rsync, du fait de son impossibilité à synchroniser d'une machine distante à une autre, va se poser au moment de sauvegarder trinity vers morpheus ou morpheus vers trinity.</p>   

<pre>
neo --> morpheus – c'est bon, local vers machine distante
neo --> trinity – c'est bon, local vers machine distante
morpheus --> neo – c'est bon, machine distante vers locale 
trinity --> neo – c'est bon, machine distante vers locale
morpheus --> trinity – machine distante vers machine distante
				 – ne marchera pas
trinity --> morpheus – machine distante vers machine distante
				 – ne marchera pas
</pre>

<p>Pour résoudre cette limitation, il va falloir légèrement modifier le schéma de rsync. Nous allons réaliser ceci :</p>

<pre>
morpheus --> trinity – deviendra: morpheus --> neo &amp; neo --> trinity
trinity --> morpheus – deviendra: trinity --> neo &amp; neo --> morpheus
</pre>

<p>Nous créerons donc une étape supplémentaire qui, considérant que toute manière, nous voulons que l'intégralité des données soit bien présente sur la machine neo, ne revient qu'à un changement de source, sans incidence sur le résultat voulu. Cela va nous garantir que toutes nos sauvegardes soient bonnes et que rien n'y manque.</p>

<p class="highlight-3">Prenez bien en compte cette limitation de rsync lorsque vous concevez vos procédures de sauvegardes et synchronisation avec cet outil.</p>				

	<h5>Utiliser la syntaxe nom d'hôte à nom d'hôte avec rsync.</h5>

<p>Comme il est décrit plus haut, utiliser neo, morpheus ou trinity en lieu et place de leurs adresses IP physiques, est une méthode propre et facile pour rendre les choses plus lisibles. Pouvoir utiliser la syntaxe nom d'hôte à nom d'hôte avec rsync s'obtient facilement.</p>

<p>Quand vous éditerez le fichier /etc/hosts, pour ajoûter aux adresses IP les noms d'hôtes qui y correspondent, vous écrirez dans les lignes supérieures du fichier ces traductions :</p>				

<pre>
192.168.1.15	 neo
192.168.1.16	 morpheus
192.168.1.17	 trinity
</pre>

<p>La première ligne traduit l'adresse IP 192.168.1.15 en "neo", la deuxième 192.168.1.16 en “morpheus”, et la troisième 192.168.1.17 en “trinity”. Après l'édition et la sauvegarde du fichier /etc/hosts, vous allez ainsi pouvoir indifférament utiliser les IP ou les noms d'hôtes. Vous en comprendrez l'intérêt quand par exemple vous changerez l'IP d'une machine. Imaginons que vous changiez celle de neo de 192.168.1.15 en 192.168.1.25 </p> 
				
<p>Si tous vos scripts utilisent l'IP, vous devrez les localiser tous et y modifier l'adresse IP. Si vos scripts usent de noms d'hôtes, seuls les fichiers /etc/hosts nécessiteront d'être réédités, pour que tous vos scripts continuent à fonctionner. C'est particulièrement pratique lorsque vous gérez beaucoup de scripts utilisant des connexions distantes. Ceci d'autre part rend vos scripts bien plus lisibles.</p> 

				

		<h4>rsync, et les deux façons de l'utiliser.</h4>

<p>La première méthode avec rsync <b>"pousse"</b> les fichiers vers une cible, et la seconde les <b>"tire"</b> depuis une source. Chacune à ses avantages et ses inconvénients. Voyons ce qu'il en est pour chacune au travers d'une explication dans laquelle nous supposerons qu'une des machine est locale et l'autre distante, afin de rendre les choses plus explicites.</p> 
				
<p><b>"pousser"</b> - le système de fichiers local héberge les fichiers et répertoires sources, et la cible est une machine distante. La commande rsync est lancée depuis le système local, et pousse les données vers la machine distante.</p>

<p>Les avantages:<br />
	*Vous pouvez faire les sauvegardes de plusieurs systèmes vers une cible.<br />
	*Le processus de sauvegarde est réparti sur chaque machine et pas sur une seule qui l'assurerait à elle seule.<br />
	*Si un système est plus rapide qu'un autre, il peut finir rapidement et être opérationnel pour d'autres tâches.</p>

<p>Les inconvévients:<br />				
	*Si vous utilisez un script programmé avec cron, vous allez devoir mettre-à-jour et changer les crontabs de tous les systèmes en jeu, ainsi que chacune des versions locales du script.<br />
	*Votre procédure de sauvegarde n'a aucun moyen de détecter si la partition cible du système distant est effectiment montée, et pourrait dans certains cas ne rien sauvegarder sur la cible.</p>				

				
<p><b>"Tirer"</b> - Le système distant héberge les fichiers et répertoires sources et la cible est la machine locale. La commande est lancée depuis la machine locale qui "tire" les données de la machine distante.</p> 
				
<p>Les avantages:<br />
	*Un système unique est dédié au contrôle des sauvegardes de toutes les machines du réseau : il s'agit donc de sauvegarde dite centralisée. <br />
	*Si vous utilisez un script, il n'existe que sur une seule machine, et sa configuration, mise-à-jour et modification en sont d'autant plus simplifiées. Dans la même logique un seul fichier crontab contrôle la programmation chronologique de l'exécution du script.<br />
	*Le script dispose des moyens de vérifier et monter si c'est nécessaire, le système de fichiers de la partition cible.</p>

	

	<h6>Syntaxe de rsync, telle que décrite dans ses pages man:</h6>
<pre>
       rsync [OPTION]... SRC [SRC]... DEST

       rsync [OPTION]... SRC [SRC]... [USER@]HOST:DEST

       rsync [OPTION]... SRC [SRC]... [USER@]HOST::DEST

       rsync [OPTION]... SRC [SRC]... rsync://[USER@]HOST[:PORT]/DEST

       rsync [OPTION]... SRC

       rsync [OPTION]... [USER@]HOST:SRC [DEST]

       rsync [OPTION]... [USER@]HOST::SRC [DEST]

       rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST]
</pre>

			<h5>Exemple opérationnel de commandes rsync:</h5>

<pre>
rsync -agEvz --delete-after --exclude=”*~” morpheus:/home/tartie /media/hda7/SysBackups/morpheus/home
</pre>

<p>Voyons ensemble des parties de cette commande:</p>


<pre>
le chemin des fichiers sources est: morpheus:/home/tartie
et celui de la cible: /media/hda7/SysBackups/morpheus/home
</pre>

<p>tout le contenu de /home/tartie... va être sauvegardé dans /media/hda7/SysBackups/morpheus/home, donnant un résultat comme ceci :</p>

<pre>
/media/hda7/SysBackups/morpheus/home/tartie...
</pre>

<p>il est à noter que la seule raison qui place /tartie dans /home provienne de la syntaxe de désignation de la CIBLE et non de celle de la SOURCE. la "source" ne sélectionne que d'où viennent les données et pas où elles vont aller. C'est la "cible" qui désigne à rsync où copier, les données qu'il récupère de la "source". Voyens cet exemple :</p>


<pre>
rsync [...] /home/user/data/files /media/hda7/SysBackups/neo
</pre>


<p>Dans la commande ci-dessus, seul le répertoire source /files et ce qu'il contient, sera copié sous le répertoire cible /neo, et nous n'obtiendrons pas /media/hda7/SysBackups/neo/home/user/data/files </p>
				
<p>Soyez attentif à ces considérations lorsque vous créez vos commandes de sauvegarde avec rsync.</p>

		<h5>Explications sur les options:</h5>

<pre>
-a est utilisé pour mode archive. Dans les pages man, l'option est expliquée “en termes simples, une façon de sauvegarder en mode récursif, et de préserver 'pratiquement' tout. Il est mentionné que cette option ne préserve pas les liens durs en raison de la complexité du processus.
L'option -a est considérée comme un équivalent à : -rlptgoD qui signifie:
-r = recursif – traite les sous-répertoires et fichiers trouvés dans la source.
-l = liens – quand des liens symboliques sont rencontrés, les re-crée sur la cible.
-p = permissions – commande à rsync de fixer les mêmes permissions que celles de la source.
-t = temps – commande à rsync de régler l'heure de la cible en fonction de celle de la source.
-q = quiet=silencieux – commande à rsync d'afficher le minimum de texte. L'option pour le mode verbeux est -v.
-o = owner=propriétaire – commande à rsync, que bien qu'il soit lancé par root, il doive fixer aux données de la cible les mêmes propriétaires qu'à ceux de la source.
-D = équivaut à l'addition de ces deux commandes: --devices --specials
 --devices = fait en sorte que rsync transfère les caractères et fichiers de périphériques bloc du système distant en sorte de pouvoir recréer ces périphériques. Malheureusement, si vous n'utilisez pas également l'option  --super dans la même commande, cela sera sans effet.
 --specials = fait en sorte que rsync transfère les fichiers spéciaux comme les noms de sockets et fifos.
-g est utilisé pour préserver les permissions de “groupe” de la source vers la cible.
-E est utilisé pour préserver les permissions d'"exécution" de la source vers la cible.
-v est utilisé pour accroître la loquacité de ce qui sera affiché durant l'opération. Après s'être assuré de bien sauvegarder ce que nous voulons, on pourra enlever ce "v". Il est mentionné ici, car s'il on lance ce processus à partir d'un cron, il est souvent utile de "voir" ce qui se fait. Ce sera à vous de décider s'il faut oui ou non, utiliser cette option.
-z est utilisé pour compresser les données à transférer ou copier, rendant le processus de copie plus rapide puisqu'influant sur le volume du transfert.
--delete-after=effacer-après = les fichiers/répertoires qui ne seraient plus dans la source sont effacés après le transfert, et pas avant. Ce "after" est utilisé en cas de crash ou de problèmes, et "effacer" est utilisé pour prévenir que des fichiers n'existant plus sur le système source ne viennent corrompre la cible.
--exclude = une syntaxe qui permet d'exclure certains fichiers ou répertoire du processus. par exemple, --exclude=“*~” excluerait TOUT fichier ou répertoire dont le nom se terminerait par un tilde du processus de sauvegarde. Un seul et unique schéma d'exclusion est admissible avec l'option --exclude, et donc si vous voulez en utiliser plusieurs, il vous faudra ajoûter autant de lignes --exclude que nécessaires dans votre commande. 
</pre>

<p>En complément, voici quelques autres options de commandes utiles:</p>

<pre>
-c – ajoûte un nouveau niveau de vérification des sources, au moment de leur comparaison à la copie sur la cible après l'achèvement du processus ; ceci conduit le processus de copie à prendre plus de temps, et rsync opérant systématiquement des vérifications, il s'agit d'une forme de redondance, conduisant à ne pas recourir a priori à cette option.
--super – comme la page man le décrit, la machine receptrice tentera des opérations d'administration réservées au super-utilisateur
--dry-run – littéralement "lancement à sec", autrement dit, vous retournera ce qui aurait été transféré en cas de commande effective, comme le font par exemple les commandes apt-get install ou apt-get dist-upgrade, quand on leur adresse l'option -s.
</pre>

<p>Notre commande se termine systématiquement par l'adresse du répertoire source que suit celle du répertoire cible.</p>

			<h5>Exemples de commandes:</h5>

<pre>
rsync -agEvz --delete-after --exclude=”*~” morpheus:/home/tartie /media/hda7/SysBackups/morpheus/home
</pre>

<p>Cette commande va sauvegarder tous les fichiers répertoires inclus dans /home/tartie vers le système dont le nom d'hôte est "morpheus", pour les disposer dans le répertoire  /media/hda7/SysBackups/morpheus/home  – préservant la structure d'arborescence du répertoire source /tartie.</p>


<pre>
rsync -agEvz --delete-after --exclude=”*~” /home/tartie neo:/media/hda7/SysBackups/morpheus/home
</pre>

<p>Cette commande est l'équivalent en mode "pousser" de la commande précédente. Elle va pousser tous les fichiers répertoires inclus dans /home/tartie vers la machine neo et dans le même répertoire. Notez qu'un système est considéré "distant" dès lors que son chemin est précédé du signe “:”.</p>

<pre>
rsync -agEvz --delete-after --exclude=”*~” /home/cuddles /media/hda7/SysBackups/neo/home
</pre>

<p>Cette commande réalise une synchronisation de réperoire local à répertoire local puisqu'aucun chemin n'est précédé de “:”. Elle sauvegardera la zone /home/cuddles vers le répertoire /media/hda7/SysBackups/neo/home de la même machine.</p>


<p>Voyons maintenant ce que l'usage de multiples options d'exclusion peut donner:</p>

<pre>
rsync -agEvz --delete-after --exclude=”*~” --exclude=”*.c” --exclude=”*.o” "/*" /media/hda7/SysBackups/neo
</pre>

<p>La commande ci-dessus va sauvegarder TOUT les fichiers et répertoires situés sous racine de la machine locale vers /media/hda7/SysBackups/neo – sauf que cette sauvegarde excluera tout fichier ou répertoire se terminant par un “~”, ou un “.c”, ou un “.o”. </p>



<p class="highlight-2">Ci-dessous figure un exemple de commande rsync à éviter et qui retournerait des erreurs. Un exemple de commande rsync forcément inopérante puisque de machine distante à machine distante:</p>

<pre>
rsync -agEvz --delete-after --exclude=”*~” morpheus:/home/tartie trinity:/home
</pre>

<p class="highlight-2">Comme il est spécifié plus haut : ça ne marche pas avec rsync !</p>

<p>Pour finir et pour la route, voyons ce qu'une commande rsync de machine distante à locale donnerait en remplaçant les noms d'hôte par les IP.</p> 


<p>La même commande est ici successivement écrite en utilisant les noms d'hôte puis les IP.</p>

<pre>
rsync -agEvz --delete-after --exclude=”*~” morpheus:/home/tartie /media/hda7/SysBackups/morpheus/home
</pre>

<pre>
rsync -agEvz --delete-after --exclude=”*~” 192.168.1.16:/home/tartie /media/hda7/SysBackups/morpheus/home
</pre>

<p>Certes, vous n'êtes pas obligés d'utiliser les noms d'hôtes, mais vous conviendrez que ce soit un tantinet plus simple.</p>

<p>Vous devriez à présent être en mesure de concevoir une commande simple pour rsync, en vous inspirant des exemples fournis, jusqu'à obtenir les formes qui correspondront à vos besoins.</p>
	</div>
			<div id="rev">Dernière Révision le 09/09/2007 à 5H21 UTC</div>


</div>
</body>
</html>
