<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="ja">
<head>
	<title>sidux Manuals - rdiff</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<!-- Last translation revision muchan 03/12/2007 2304 UTC -->
<div id="menu"><!-- menu starts here ja lang maintainer muchan-->
<!--Welcome to the  sidux-manual Operating System Manual version-01.63.2008.01.12 -->
<!-- menu last updated by bluewater 11/01/2008 2300 hrs AEST 10/01/2008 1200 hrs UTC -->
<img src="../lib/logos/sidux-logo.png" alt="logo" id="menu-header" />
	<ul id="top-list">
		<li><a href="http://sidux.com/">sidux.comへ</a></li>
		<li><a href="http://manual.sidux.com/meta-manual">sidux メタマニュアル</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-50.png" title="Choose another language" alt="lang-switch" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-ja.htm">sidux OSマニュアル</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-ja.htm#welcome-gen">sidux OSマニュアル</a></li>
				<li><a href="welcome-ja.htm#how-to">このマニュアルの使い方</a></li>
				<li><a href="welcome-ja.htm#table-contents">内容一覧</a></li>
				<li><a href="help-ja.htm#help-gen">困った時は...</a></li>
				<li><a href="help-ja.htm#paste">IRC !paste</a></li>
				<li><a href="credits-ja.htm#cred-team">siduxチーム</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-ja.htm">CDの内容</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-ja.htm#cd-content">CDの内容</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="cd-dl-burning-ja.htm">ミラー, ダウンロードと CDの作成</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="cd-dl-burning-ja.htm#download-sidux">siduxのミラー, ダウンロードとCDの作成</a></li>
				<li><a href="cd-dl-burning-ja.htm#md5">md5のチェックサム</a></li>
				<li><a href="cd-dl-burning-ja.htm#burn-nero">WindowsでCDを焼くには</a></li>
				<li><a href="cd-dl-burning-ja.htm#burn-linux">LinuxでCDを焼くには</a></li>
				<li><a href="cd-dl-burning-ja.htm#xdelta">xdeltaパッチング</a></li>
				<li><a href="cd-no-gui-burn-ja.htm">GUIなしでCDを焼くには</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-ja.htm">Live Mode</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-ja.htm#rootpw">sidux-LiveCDのRootパスワード</a></li>
				<li><a href="live-mode-ja.htm#live-cd-installsoft">Live-CD作動中にソフトをインストール</a></li>
				<li><a href="live-mode-ja.htm#ntfs-3g">ntfs-3gを使ってNTFSパーティションに書く</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="term-konsole-ja.htm">ターミナル/コンソール</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="term-konsole-ja.htm#sux"> sux</a></li>
				<li><a href="term-konsole-ja.htm#term-kon"> ターミナル/コンソール</a></li>
				<li><a href="term-konsole-ja.htm#cli-help">コマンドラインヘルプCommand Line Help</a></li>
				<li><a href="term-konsole-ja.htm#term-cmds">Linuxターミナルのコマンド一覧</a></li>
				<li><a href="term-konsole-ja.htm#shell-scripts">Scripts.shのインストール</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cheatcodes-ja.htm">チートコード</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cheatcodes-ja.htm#cheatcodes">siduxだけのLive-CD用チートコード</a></li>
				<li><a href="cheatcodes-ja.htm#cheatcodes-linux">Linux一般のチートコード</a></li>
				<li><a href="cheatcodes-vga-ja.htm#vga">VGAコード</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="part-gparted-ja.htm">ハードディスクのパーティショニング</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="part-gparted-ja.htm#partition">GPartedでHDをパーティショニング</a></li>
				<li><a href="part-gparted-ja.htm#ntfs">GPartedでNTFSパーティションのサイズ変更</a></li>
				<li><a href="part-uuid-ja.htm#uuid">UUID, パーティションのラベルとfstab</a></li>
				<li><a href="part-cfdisk-ja.htm#disknames">ディスクの名前について</a></li>
				<li><a href="part-cfdisk-ja.htm#partition">cfdiskでHDをパーティショニング</a></li>
				<li><a href="part-cfdisk-ja.htm#formating">cfdiskでパーティション後のフォーマッティング</a></li>
				<li><a href="part-size-examp-ja.htm#part-example">パーティションの例</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-ja.htm">インストールオプション</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-ja.htm#Inst-prep">インストールの準備</a></li>
				<li><a href="hd-install-ja.htm#Installation"> HDへのインストール</a></li>
				<li><a href="hd-install-ja.htm#first-hd-boot">初めての起動</a></li>
				<li><a href="hd-install-opts-ja.htm#fromiso">'fromiso'からの起動</a></li>
				<li><a href="hd-install-opts-ja.htm#fromiso-persist">fromisoと持続モード</a></li>
				<li><a href="hd-install-opts-ja.htm#usb-hd">USB-HDへのインストール</a></li>
				<li><a href="hd-install-opts-ja.htm#vtbox">VirtualBoxにsiduxをインストール</a></li>
				<li><a href="hd-install-opts-ja.htm#qemu">QEMUにsiduxをインストール</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-ja.htm">グラフィックカード ハードウェアデバイスとドライバ</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="hw-dev-hw-dri-ja.htm#hd-ntfs3g">NTFSに書き込む</a></li>
				<li><a href="hw-dev-hw-dri-ja.htm#mon-res">モニターとスクリーンの解像度</a></li>
				<li><a href="hw-dev-hw-dri-ja.htm#non-free-3d">NvidiaとATI用のnon-freeのバイナリ・ドライバ</a></li>
				<li><a href="hw-dev-hw-dri-ja.htm#native-nv-ati">Free xorg drivers for nVidia, ATI, Radeon, Intel用のxorgのfreeドライバ</a></li>
				<li><a href="hw-dev-hw-dri-ja.htm#non-free">non-freeが必要なハードウェア</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="wm-kde-ja.htm">ウィンドウマネージャ</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="wm-kde-ja.htm#desk-freeze">KDEデスクトップが反応しなくなった時は</a></li>
				<li><a href="wm-kde-ja.htm#kde-login">Cant login in KDEにログインできない時は</a></li>
				<li><a href="wm-kde-ja.htm#ch-th">Themesの変更</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="lamp-apache-ja.htm">siduxのLAMPセット</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="lamp-apache-ja.htm#serv-apache">siduxのLAMPセット</a></li>
				<li><a href="lamp-apache-ja.htm#serv-ftp">FTPクライアント</a></li>
				<li><a href="lamp-apache-ja.htm#serv-sec">セキュリティプロトコル</a></li>
				<li><a href="lamp-apache-ja.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-ja.htm#serv-mysql">MySQLの設定</a></li>
				<li><a href="lamp-ppp-ja.htm#serv-php">ApacheとPHP</a></li>
				<li><a href="ntp-server-ja.htm#ntp-server">タイムサーバーの設定</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="internet-connecting-ja.htm">インターネット/ネットワーク</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="tor-privoxy-ja.htm#tor">Tor</a></li>
				<li><a href="tor-privoxy-ja.htm#privoxy">Privoxy</a></li>
				<li><a href="internet-connecting-ja.htm#firewalls">Firewalls</a></li>
				<li><a href="samba-ja.htm#configure">SAMBAの環境設定 (Windowsとの接続)</a></li>
				<li><a href="samba-ja.htm#setup">SAMBAサーバーの設定</a></li>
				<li><a href="ssh-ja.htm#ssh-fs">SSH リモートマウント</a></li>
				<li><a href="ssh-ja.htm#ssh-x">SSHを通じてX Windowのアプリを</a></li>
				<li><a href="ssh-ja.htm#ssh-f">KonquerorでGUIのSSH</a></li>
				<li><a href="ssh-ja.htm#ssh-w">WindowsのPCからSSH X フォワーディング</a></li>
				<li><a href="ssh-ja.htm#ssh">SSHとセキュリティ</a></li>
				<li><a href="internet-connecting-ja.htm#dial-mod">56kモデム</a></li>
				<li><a href="internet-connecting-ndis-ja.htm#ndiswrapper-basic">Ndiswrapperの準備</a></li>
				<li><a href="internet-connecting-ndis-ja.htm#ndiswrapper-advanced">Activating Ndiswrapper - 上級編</a></li>
				<li><a href="internet-connecting-wpa-ja.htm#wpa">WIFI-WLAN</a></li>
				<li><a href="internet-connecting-ja.htm#netcardconfig">インターネットに接続</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-apt-ja.htm">パッケージのインストール、除去とダウングレーディング</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="sys-admin-apt-ja.htm#apt-cook">APTの手引き、ソースリストについて</a></li>
				<li><a href="sys-admin-meta-ja.htm#meta-pack">メタ・パッケージのインストーラーMeta-Package Installer</a></li>
				<li><a href="sys-admin-meta-ja.htm#meta-proxy">メタインストーラーとプロクシー</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-install">新しいパッケージのインストール</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-delete">パッケージの除去</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-downgrade">ダウングレードとホールド</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-cache">apt-cacheでパッケージをさがす</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-kio">kio-aptでパッケージをさがす</a></li>
				<li><a href="sm-siduxcc-ja.htm#sm">smxiスクリプト</a></li>
				<li><a href="sm-siduxcc-ja.htm#siduxcc">siduxcc</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-upgrade">システムのアップグレード -- dist-upgrade</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="sm-siduxcc-ja.htm">システムアドミン</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="sm-siduxcc-ja.htm#sm">smxiスクリプト</a></li>
				<li><a href="sm-siduxcc-ja.htm#siduxcc">siduxcc</a></li>
				<li><a href="sys-admin-apt-ja.htm#apt-upgrade">システムのアップグレード - dist-upgrade</a></li>
				<li><a href="sys-admin-upgrade-ja.htm#live-cd-upgrade">アップグレード用のLive-CD</a></li>
				<li><a href="sys-admin-kern-upg-ja.htm#kern-upgrade">カーネルのアップグレード</a></li>
				<li><a href="sys-admin-rdiff-ja.htm#rdiff">rdiffでバックアップ</a></li>
				<li><a href="sys-admin-rsync-ja.htm#rsync">rsyncでバックアップ</a></li>
				<li><a href="vir-rkits-ja.htm#virus-rkits">ウィルスとルートキットスキャナ</a></li>
				<li><a href="sys-admin-gen-ja.htm#start-services">サービスの自動スタート設定</a></li>
				<li><a href="sys-admin-gen-ja.htm#pw-lost">rootパスワードを忘れたら</a></li>
				<li><a href="sys-admin-gen-ja.htm#fonts">フォント</a></li>
				<li><a href="sys-admin-gen-ja.htm#cups">CUPS</a></li>
				<li><a href="sys-admin-gen-ja.htm#init">siduxのランレベル - init</a></li>
				<li><a href="sys-admin-grub-bootman2-ja.htm#mbr-grub-boot">MBR ブートセクターへの上書き</a></li>
				<li><a href="sys-admin-grub-bootman2-ja.htm#dual-boot">デュアルブートまたはマルチブート</a></li>
				<li><a href="sys-admin-grub-bootman2-ja.htm#boot-grub-floppy">ブート・フロッピーの作成</a></li>
				<li><a href="sys-admin-grub-bootman2-ja.htm#remove-grub">MBRからGRUBを消去する</a></li>
				<li><a href="sys-admin-grub-bootman2-ja.htm#what-is-grub">Grub - ブートマネージャ</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="rdiff">
			<!--- ####
			<h2 id="top-header">Backing-Up the System with rdiff-backup</h2>
			#### -->
			<h2 id="top-header">rdiff-backupを使ってシステムのバックアップ</h2>
				<!--- ####
				<p>rdiff-backup is a tool used to backup your files. (It can be run on a variety of *nix ports).<br />
				#### -->
				<p>rdiff-backupはファイルのバックアップに使うツールです. (様々な*nixシステム上で使えます).<br />
				<!--- ####
				The wonderful situation with sidux is you have choices how to initiate the proccess, DIY or scripted</p>
				#### -->
				siduxではrdiff-backupのプロセスをスタートするのにDIYとスクリプトの二つの方法があります.</p>

				<!--- ####
				<h3><a href="http://techpatterns.com/forums/about831.html">This is the scripted version by h2</a></h3>
				#### -->
				<h3><a href="http://techpatterns.com/forums/about831.html">h2のスクリプトを使う方法はこちらへ</a></h3>
	<div class="spacer02"></div>

			<!--- ####
			<h5>What follows from here is the DIY version</h5>
			#### -->
			<h5>DIYバージョンは次のように</h5>

			<h6>rdiff-backup</h6>

				<!--- ####
				<p class="highlight-2">Run the commands in  as root in konsole, unless told otherwise</p>
				#### -->
				<p class="highlight-2">特に書いていない限り、下記のコマンドはコンソールからrootとして実行します</p>

				<!--- ####
				<p>*great for recovering messed up dist-upgrades, kernel upgrades etc (and also just for restoring individual files).<br />
				#### -->
				<p>*(単に個々のファイルを回復するだけでなく)dist-upgradesやカーネルのアップグレードがうまくいかなかった時などの混乱した状況からシステム全体を回復するのにとても役に立ちます.<br />
				<!--- ####
				*only backs up what's changed like rsync does (so each backup doesn't take long).<br />
				#### -->
				*rsyncと同じく変更のあったところだけをバックアップします(そのため実行時間がそれほど長くかかりません).<br />
				<!--- ####
				*keeps a history of changes (which means that you can restore a file you deleted three weeks ago!)<br />
				#### -->
				*変更履歴を保持します(つまり三週間前に消去してしまったファイルなども回復できるということです!)<br />
				<!--- ####
				*does secure backups over a network (using ssh).<br />
				#### -->
				*(sshを使って)ネット上で安全なバックアップもできます.<br />
				<!--- ####
				*backups up partitions while they are mounted (so it's easy to automate a daily backup ... no unmounting necessary).<br />
				#### -->
				*マウントされているパーティションをバックアップします. (アンマウントする必要がないので毎日のバックアップなどを簡単に自動化できます).<br />
				<!--- ####
				*can restore everything if your hard drive goes belly-up and you have to buy a new one.<br />
				#### -->
				*ハードドライブが壊れて新しいものに交換したときもすべてのファイルを回復できます.<br />
				<!--- ####
				*scales to backup large networks (linux is fine, windows s more difficult) and is used by businesses.<br />
				#### -->
				*大きなネットワークシステムのバックアップ用(LinuxはOKですが、Windowsには向きません）にもスケールできるためビジネスに使われています.<br />
				<!--- ####
				*is a command-line-driven app, so it's great for those who like to do things like automate backups in a powerful way (ie a bash script which is called by cron).<br />
				#### -->
				*コマンドラインのアプリなので自動的で強力なバックアップツールが好きな人にピッタリ(cronからbashスクリプトを呼ぶ).<br />
				<!--- ####
				*remembers and deals with file ownerships and permissions, and also deals with symbolic links (and all that sort of stuff) so when you restore, you get things exactly as they were.</p>
				#### -->
				*ファイルのオーナーやパーミッションも保存し、シンボリックリンク(その他いろいろ)も保存するのでデータの回復の際には保存したときの状態を再現できます.</p>

			<!--- ####
			<h6>What you'll need</h6>
			#### -->
			<h6>必要なのは...</h6>
				<!--- ####
				<p>rdiff-backup keeps an entire (uncompressed) copy of the files you are backing up, and it also keeps a history (incremental backups), so this means that your backup space needs to be larger than what you're backing up. If you are backing up 100 gigs of space, you may need 120 gigs of space (on a separate hard drive preferably!).</p>
				#### -->
				<p>rdiff-backupはファイルのコピーをそのまま(圧縮なしで)保存し、さらに編集履歴も保存(増分バックアップ)するためバックアップ先のスペースは元のスペース以上に必要になります. たとえば100Gbのスペースのデータをバックアップするのに120Gbが必要となるかもしれません. (なるべく別ディスクに保存しましょう!)).</p>

			<!--- ####
			<h6>How to set it up</h6>
			#### -->
			<h6>セッティング</h6>
				<!--- ####
				<p>Let's say that your pc has the following:<br />
				#### -->
				<p>一例として次のようなPCだったとしましょう:<br />
				<!--- ####
				* a 100 gig hard drive (hda) which is in use, with mounts hda1 used for the root partition, and hda5 used for storing music and other files, and hda6 for swap.<br />
				#### -->
				* 100Gbのハードドライブ(hda)を使用. hda1がrootパーティションで、hda5は音楽などのファイルのスペース、hda6がスワップ.<br />
				<!--- ####
				* a spare 200 gig hard drive (hdb) which is not in use, with one mount hdb1 ... we'll use this one for our backups.<br />
				#### -->
				* 200Gbの予備ハードディスク(hdb)はhdb1だけマウントしてある... これをバックアップスペースとして使います.<br />
				<!--- ####
				* IP address 192.168.0.1</p>
				#### -->
				* IPアドレスは192.168.0.1</p>

				<!--- ####
				<p>The first thing to do is to install rdiff-backup:</p>
				#### -->
				<p>まずはrdiff-backupのインストール:</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<!--- ####
				<p>Now although you can backup any directory, this assumption is to back up entire partitions ... we want to back up hda1 and hda5 (we don't want to backup hda6), and so we make some directories to store the data:</p>
				#### -->
				<p>個々のディレクトリのバックアップもできますが、ここではパーティション全体のバックアップを行います... hda1とhda5をバックアップするため(hd6のバックアップは要りません）まずデータを保持するディレクトリを作ります:</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/root
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<!--- ####
				<p>You need the IP address distinguished because if you wish to use this computer to also backup another one (covered later on).</p>
				#### -->
				<p>IPアドレスを使うのは(後述しますが)ここに他のコンピュータのデータもバックアップする場合に備えてです.</p>

			<!--- ####
			<h6>Backing up</h6>
			#### -->
			<h6>バックアップ</h6>

				<p>rdiff-backupは<span class="highlight-3">rdiff-backup source-dir dest-dir</span>のシンタックスを使います. ノート: ファイル名ではなく、常にディレクトリ名を書きます.</p>

				<!--- ####
				<p>To back up hda5, run:</p>
				#### -->
				<p>hda5をバックアップするコマンド:</p>
<pre>
# rdiff-backup /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>rootパーティションをバックアップするコマンド:</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
</pre>
				<!--- ####
				<p>Any "AF_UNIX path too long" errors can be ignored. This may take a while as it's the first time the partition has been backed up, so rdiff-backup will have to back up the entire partition (not just the differences). Notice that we don't want to back up /tmp as this always changes, nor /proc or /sys as these don't contain real files, and also we don't want to back up mounts. If you did back up mounts, then you would be backing up hdb1, and could get into an infinite loop! One way around this is to backup the mounts separately.</p>
				#### -->
				<p>AF_UNIX path too long"というエラーメッセージが表示されても無視して構いません. 初めての時はすべてのファイルをバックアップするので少々時間がかかるかもしれません. 常に変動する/tmpや、実際にはファイルを含まない/procや/sysといったディレクトリを除いていることに注目してください. マウントされている他のディスクもバックアップ対象から外してあります. マウントされているディスクを含めてしますとバックアップ先のhdb1もコピーしようとするので無限ループになってしまいます! これを避けるのにマウントを一つずつバックアップするという方法もあります.</p>

				<!--- ####
				<p>Now the reason you put '/proc/*' instead of just '/proc' is that this will cunningly still backup the directory name /proc, but will ignore everything inside. The same is true to /tmp, /sys, and even more cunningly all the mount point names.</p>
				#### -->
				<p>ここで'/proc'ではなく'/proc/*'が使われているのはこれによって/procというディレクトリの名はバックアップに含めつつディレクトリの内容は無視するためです. /tmpや/sysの場合も同じです. /mountの場合もほとんどトリックといえますが、マウントポイントの名前までバックアップしてその内容は無視します.</p>
		
					<!--- ####
				 <p>This way, if you destroy your root partition and do a full restore, /tmp, /proc, /sysand the mount points names will be created (just as they should). If /tmp doesn't exist when X starts up, it may complain )See the man page for more on --exclude and --include).</p>
					#### -->
				 <p>こうすればrootパーティションに問題が起こってバックアップからパーティション全体を回復するときは自動的に/tmp, /proc, /sysやマウントポイント名も回復します. (これがないと困ったことになります. たとえばXがスタートする時にもし/tmpディレクトリがなかったら、エラーメッセージがでるかもしれません. --excludeと--includeについてはmanページを読んでください).</p>

			<!--- ####
			<h6>Restoring directories from backups</h6>
			#### -->
			<h6>バックアップからディレクトリを回復するには</h6>

				<!--- ####
				<p>rdiff-backup uses the syntax:</p>
				#### -->
				<p>rdiff-backupは次のようなシンタックスで使います:</p>
<!--- ####
<pre>
rdiff-backup -r &lt;from-when&gt; &lt;source-dir&gt; &lt;dest-dir&gt;
</pre>
#### -->
<pre>
rdiff-backup -r &lt;いつから&gt; &lt;どこのディレクトリから-dir&gt; &lt;バックアップ先のディレクトリ&gt;
</pre>
				<!--- ####
				<p>Now if you were to accidentally delete the directory /media/hda7/photos, you can restore it by doing:</p>
				#### -->
				<p>たとえばうっかりして/media/hda5/photosを消去してしまった場合、これを回復するには:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5/photos /media/hda5/photos
</pre>
				<!--- ####
				<p>The "-r now" option means restore from the latest backup. If you have been backing everything up periodically (via crontab, say), and didn't realise that the photos directory were missing until a few days later, you would need to restore from a backup from a few days ago (and not "now", as the latest backup says that the photos directory doesn't exist). Or perhaps you just want to get back to a previous version of something.</p>
				#### -->
				<p>ここで"-r now"は最新のバックアップから回復するオプションです. もしシステムが(crontabなどを使って)定期的にバックアップされていて、photosディレクトリを消してしまったことに何日か気づかずに過ごしてしまった場合、最新ではなく、数日前のバックアップから回復することになります. (最新のバックアップからだと、photosというディレクトリはないと言うでしょう) それとも単に古いバージョンのファイルが見たい時もあるでしょう.</p>

				<!--- ####
				<p>If you want to restore from three days ago, then use the "-r 3D" ... but, as the man page says, note:</p>
				#### -->
				<p>3日前のバックアップから回復するには"-r 3D"のオプションを使います ... ただ、manページにも書いてあるように 注意:</p>

				<!--- ####
				<p class="highlight-1">"3D" refers to the instant 72 hours before the present, and if there was no backup made at that time, rdiff-backup restores the state recorded for the previous backup. For instance, in the above case, if "3D" is used, and there are only backups from 2 days and 4 days ago, the directory would be restored as it was 4 days ago (so you have to think about it before you restore).</p>
				#### -->
				<p class="highlight-1">"-r 3D"というのは現在の７２時間前という風に解釈され、もしその時点までのバックアップがなかったら、その一つ前のバックアップが使われます. 例として"-r 3D"が使われたけれど２日前と４日前のバックアップしかない場合はディレクトリは4日前の状態に回復します. (コマンドを実行するまえにちょっと考えましょう.)</p>

				<!--- ####
				<p>Using the following will list the date and times of when the backups were made for hda5:</p>
				#### -->
				<p>hda5がバックアップされた日時を表示するコマンドは:</p>
<pre>
# rdiff-backup -l /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
			<!--- ####
			<h5>Restoring partitions</h5>
			#### -->
			<h5>パーティションの回復</h5>

				<!--- ####
				<p>You can also restore whole partitions (mounts), after all, a mount point is really just a directory.</p>
				#### -->
				<p>パーティション全体を回復することもできます. 結局のところマウントポイントとはディレクトリなわけですから.</p>

				<!--- ####
				<p class="highlight-2">WARNING: Don't restore the root partition while you are booted up into it! With one command you will lose all the files on all your partitions, including all the backups on a separate hard drive!! rdiff-backup does exactly what it was instructed to do ... if the the backup for the root partition has empty mount points, thus in order to restore to how the backup is, it deletes everything in the mounts to make everything like the backup.</p>
				#### -->
				<p class="highlight-2">警告: rootパーティションの回復はそのパーティションで起動中には行わないこと! 一つのコマンドで他のドライブのバックアップまで含めた全部のファイルを失うことになるかもしれません! rdiff-backupは言われたとおりのことを正確に実行するだけです... もしrootパーティションのバックアップが空っぽのマウントポイントだったら、その状態に回復するためにすべてのファイルを消去してしまいます.</p>

				<!--- ####
				<p>To restore hda5 from the latest backup, we simply do:</p>
				#### -->
				<p>hda5を最新のバックアップから回復するコマンドは:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5 /media/hda5
</pre>
			<!--- ####
			<h5>Restoring the root partition</h5>
			#### -->
			<h5>rootパーティションの回復</h5>

				<!--- ####
				<p>But to restore the root partition, it's not so simple. Don't restore the root partition while it's mounted (see the above warning). It's really useful to be able to restore the root partition, as then if you mess up things when installing/upgrading, or mess up installing a new kernel (etc), you have piece of mind that you can roll things back to how you had them, and it'll only take 20 minutes.</p>
				#### -->
				<p>しかしrootパーティションを回復するのはそれほど単純ではありません. rootパーティションは決してマウント中に回復しないように(上の警告を参照). しかしrootパーティションの回復はとくにアップデートの失敗や新しいカーネルのインストールの問題などの時に、問題が起きる以前の状態に戻せるというのは大変便利なことです. しかもそれが20分程度でできるのですから. .</p>

				<!--- ####
				<p>One way to restore the root partition is to boot into a spare linux partition if you have one on your hard disk. Then since you will be able to restore the partition you want, as it won't be mounted as root. After you restore the partition, boot up into it and it will be exactly has it was when it was backed up ... exactly! This is by far the easiest method.</p>
				#### -->
				<p>rootパーティションを回復する一つの方法はハードディスクに予備のLinuxパーティションがあればそれををrootとして起動することです. そうすれば回復しようとするパーティションはrootではないので、普通のコマンドが使えます. パーティション回復の作業が終わったら改めてそれをrootとして起動すればバックアップした時とまったく同じ状態で起動します. そう、まったく同じです. これがなんといっても一番簡単な方法です.</p>

				<!--- ####
				<p>Another way to restore the root partition is to boot up the sidux-live cd live cd and do the restore from there. rdiff-backup is included in sidux.  In case the sidux live-cd version you have doest not include rdiff, you can type in the grub (Bootoptions, (Cheatcodes)) the cheatcode "unionfs" and that will mean you can install applications on the  live cd. Just boot up and do the following commands:</p>
				#### -->
				<p>rootパーティションを回復するもう一つの方法はsiduxのライブCDから起動してそこからパーティションの回復作業を行うことです. rdiff-backupはsiduxに含まれていますから. もしrdiffを含まないバージョンのsiduxライブCDだった場合は、起動時のGrubの起動オプション(チートコード)に"unionfs"と入力して起動すると、ライブCDのシステムにアプリケーションをインストール出きるようになります. そのように起動したあと、次のようにコマンドを実行します.:</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h6>やっとデータ回復のコマンドです:</h6>
<pre>
# mount /dev/hda1 /media/hda1
# mount /dev/hdb1 /media/hdb1
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<!--- ####
				<p>Note: If you don't have a sidux CD and your Live-CD is supported by klik you can install rdiff-backup using the Klik and calling:</p>
				#### -->
				<p>ノート: siduxのCDがなくてもklikにサポートされたライブCDがあれば、klikを使ってrdiff-backupをインストールできます:</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<!--- ####
				<p>It is recommended that anyone backing up their root partition (with the intention of restoring from it if they have to) should test the restoring process. Nothing worse than thinking everything will be fine, and then coming across something unexpected during an emergency.</p>
				#### -->
				<p>不測の事態に備えてrootパーティションをバックアップしている人は、あらかじめ回復作業をテストしておくべきです. バックアップしてあるから大丈夫だと思っていて、緊急の時になって予期しない問題に直面することほどひどいことはありません.</p>

			<!--- ####
			<h5>Backing up other pc's</h5>
			#### -->
			<h5>他のPCのデータのバックアップ</h5>

				<!--- ####
				<p>You can back up other pc's onto the local pc, as long as our local pc can ssh to the other pc's (and as long as you have room on your hard drive). The ssh server (sshd) needs to be running on remote pc. The other pc's don't have to be in your local lan, they could be anywhere in the world.</p>
				#### -->
				<p>sshの接続さえ可能ならば、他のPCのデータをバックアップすることもできます. (もう一つの条件として、当然バックアップ先のPCには十分なハードディスクスペースが必要です) リモート側のPC上にsshサーバー(sshd)が走っている必要があります. ２台のPCが同じLANに接続されている必要はなく、２台が世界中のどこにあっても同じです.</p>

				<!--- ####
				<p>Let's assume that your remote pc has the following:<br />
				#### -->
				<p>仮に次のようなリモートPCがあったとしましょう:<br />
				<!--- ####
				1) a 100 gig hard drive (hda) which is in use, with only mounts,<br />
				#### -->
				1) 100Gbのハードドライブ(hda)の<br />
				<!--- ####
				2) hda1 used for the root partition,<br />
				#### -->
				2) hda1がrootパーティションで<br />
				<!--- ####
				3) hda5 that we are storing some temporary files that we don't want backed up,<br />
				#### -->
				3) hda5にはバックアップの必要のないテンポラリファイルがあり<br />
				<!--- ####
				4) and hda6 for swap <br />
				#### -->
				4) hda6はスワップ<br />
				<!--- ####
				5) IP address 192.168.0.2</p>
				#### -->
				5) IPアドレスは192.168.0.2</p>

				<!--- ####
				<p>Note: both 100 gig drives cannot usually be backed up on the 200 gig drive using rdiff-backup (since there would be no room for incremental files), but since you aren't backing up hda5 on the remote pc (and since hard drives aren't usually 100% full anyway, although don't rely on this) then you may calculate that you have enough room. Every time rdiff-backup performs another backup, more incremental files are created, and this takes up more and more room.</p>
				#### -->
				<p>ノート: 普通二つの100Gbドライブはrdiff-backupで200Gbのドライブにバックアップすることは(増分のデータを保存するスペースがないため)できませんが、上のリモートPCのhd5はバックアップの対象からはずれているため何とかバックアップできると計算できます.(もう一つハードディスクがいつも100%使われているわけではないという点もありますが、そこはアテにしない方が無難です). rdiff-backupが行われるたびに増分のデータが増えていってスペースがどんどん使われていきます.</p>

				<!--- ####
				<p>You can tell rdiff-backup only to keep a max of 1 months backups (this command is shown later on), and this would take up less room than telling rdiff-backup to keep a years worth of data. And of course if you want a years worth of data backed up, then you have to have the hard drive space to store a years worth of incremental files.</p>
				#### -->
				<p>rdiff-backupに最大１ヶ月分までバックアップさせるように設定することもできます. (コマンドは後述)こうすればrdiff-buckupに一年分のデータをバックアップさせるよりずっと小さいスペースで済みます. 一年分のデータを保存するためには一年分の増分ファイルを保存できるハードディスクが必要ということになります.</p>

				<!--- ####
				<p>The first thing you have to do is to install rdiff-backup on the remote pc as well (every computer that you want to backup including the backup server must have rdiff-backup installed).</p>
				#### -->
				<p>まず初めにすることはリモートPCにrdiff-backupをインストールすることです. (バックアップサーバーも含めてバックアップに使うコンピュータすべてにrdiff-backupがインストールされていなければなりません</p>

				<!--- ####
				<p>To back the remote pc up onto the local pc, run on the local pc (ie 192.168.0.1): <span class="highlight-4">Note the use of the double colons :: </span></p>
				#### -->
				<p>リモートPCのデータをローカルPCに保存するにはローカルPC(ここではie 192.168.0.1)上で次のコマンドを実行します: <span class="highlight-4">二重のコロン :: の使用に注目</span></p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/ /media/hdb1/rdiff-backups/192.168.0.2/root 
</pre>
				<!--- ####
				<p>Now if you want to restore a directory on the remote pc, initiate the restore on either the local pc, or the remote pc.</p>
				#### -->
				<p>今度はリモートPCのディレクトリを回復するにはローカルPCからでもリモートPCからでもコマンドを実行できます.</p>

				<!--- ####
				<p>This is how you would restore the directory /usr/local/games on the remote pc, by initiating it from the remote pc:</p>
				#### -->
				<p>リモートPCの /usr/local/games をリモートPCからのコマンドで回復するには:</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<!--- ####
				<p>This is how you would restore the directory /usr/local/games on the remote pc, by initiating it from the local pc:</p>
				#### -->
				<p>リモートPCの /usr/local/games をローカルPCからのコマンドで回復するには:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<!--- ####
				<p>Use the same sort of syntax when restoring your root partition from a live cd (where the remote pc has been booted up via live cd ... see above).</p>
				#### -->
				<p>ライブCD/Use the same sort of syntax when restoring your root partition from a live cd (where the remote pc has been booted up via live cd ... see above).</p>

			<!--- ####
			<h5>Automating backups:</h5>
			#### -->
			<h5>自動バックアップ:</h5>

				<!--- ####
				<p>If you are backing up other pc's onto your local pc first thing to do is enable password-less ssh logins using ssh keys. <span class="highlight-2">Note that this is talking about password-less ssh logins as root. This can be tied down so that only rdiff-backup commands are performed, but this is outside the scope of this topic Please refer to <a href="ssh-en.htm#ssh-s">SSH Configuration</a> </span>  We are going to assume complete trust, and we are going to set up the simplest way of achieving password-less logins.</p>
				#### -->
				<p>他のPCのデータをバックアップしたい場合、まず初めにするのはsshキーを使ってパスワードなしでsshログインできるようにすることです. <span class="highlight-2">rootとしてパスワードなしでsshログインするわけですが、rdiff-backupのコマンドだけを実行するように設定することもできます. 詳しいことはここでは触れませんので<a href="ssh-ja.htm#ssh-s">SSHの設定</a>のページをご覧ください.</span> ここでは完全な信用があることを想定してパスワードなしのsshログインの一番簡単な設定法を紹介します.</p>

				<!--- ####
				<p>From the local pc, do the following:</p>
				#### -->
				<p>ローカルPC上で次のコマンドを実行します:</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<!--- ####
				<p>And press enter twice for blank passwords. Then do:</p>
				#### -->
				<p>そして空のパスワードとしてEnterキーを二回押し、次に:</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\<!--dunno if this is wrong-->
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<!--- ####
				<p>You will be prompted for your root password.</p>
				#### -->
				<p>ここでrootのパスワードを入力するように求められます.</p>

				<!--- ####
				<p>Now you can ssh to the remote pc as root without having to type a password, and rdiff-backup can be automated.</p>
				#### -->
				<p>これでリモートPCにパスワードをタイプせずにsshログインできるようになりました. これでrdiff-backupも自動化できます.</p>

				<!--- ####
				<p>Next, create a bash script that contains all the rdiff-backup commands. Our bash script may look something like this:</p>
				#### -->
				<p>次にrdiff-backupのコマンドを丸ごと含んだbashスクリプトを作ります. 次のような内容になります:</p>


<pre>
#!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Backing up 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
echo "(and purge increments older than 1 month)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Backing up 192.168.0.1 mount hda5======="
${RDIFF} --ssh-no-compression --exclude /media/hda5/myjunk /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo
echo "=======Backing up 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*' 192.168.0.2::/media/hdb1/rdiff-backups/192.168.0.2/root
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>


				<!--- ####
				<p>Now you can name this bash script "myrdiff-backups.bash" and put it in /usr/local/bin on our local (backup server) machine, and change it to an executable. Run the bash script and make sure it works.</p>
				#### -->
				<p>このbashスクリプトに"myrdiff-backups.bash"のような名前をつけてローカルPC(バックアップ先のPC)の /usr/local/bin に置き、chmod +xで実行ファイルにします. 一度実行してちゃんと作動することを確認しましょう.</p>

				<!--- ####
				<p>And lastly you can get cron to call it every night at 8pm. The following line in root's crontab will do the trick, call</p>
				#### -->
				<p>最後にこれを毎晩8時にcronから実行するようにセットします. rootのcrontabに次の行を加えるだけです</p>
<!--- ####
<pre>
# crontab -e
and insert the following line
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>
#### -->
<pre>
# crontab -e
そして次の行を入力します
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

			<div id="rev">Page last revised 27/09/2007 02200 UTC</div>
</div>
</div>
</body>
</html>
