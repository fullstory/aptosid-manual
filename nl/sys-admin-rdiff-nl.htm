<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>sidux Manuals - rdiff</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<div id="menu"> <!-- menu starts here nl lang maintainer  HarzG-->
<!--Welcome to the  sidux-manual Operating System version 01.33-2007-08-22 -->
<!-- menu last updated by bluewater 22/08/2007 1600rs AEST 22/08/2007 0600hrs UTC -->
<img src="../lib/logos/sidux-logo.png" alt="logo" id="menu-header" />
	<ul id="top-list">
		<li><a href="http://sidux.com/">Naar sidux.com</a></li>
		<li><a href="http://manual.sidux.com/meta-manual">Naar sidux Meta-Manual</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-50.png" title="Kies een andere taal" alt="lang-switch" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-nl.htm">sidux  OS handleiding</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-nl.htm#welcome-gen">sidux OS handleiding</a></li>
				<li><a href="welcome-nl.htm#how-to">Hoe je deze handleiding kunt gebruiken</a></li>
				<li><a href="welcome-nl.htm#table-contents">Index</a></li>
				<li><a href="help-nl.htm#help-gen">Waar je hulp kunt krijgen</a></li>
				<li><a href="credits-nl.htm#cred-team">Credits</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-nl.htm">CD inhoud</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-nl.htm#cd-content">CD inhoud</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="cd-dl-burning-nl.htm">CD downloaden en branden</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="cd-dl-burning-nl.htm#download-sidux">De sidux-CD downloaden</a></li>
				<li><a href="cd-dl-burning-nl.htm#md5">md5 Checksum</a></li>
				<li><a href="cd-dl-burning-nl.htm#burn-nero">Branden in Windows</a></li>
				<li><a href="cd-dl-burning-nl.htm#burn-linux">Branden in Linux</a></li>
				<li><a href="cd-dl-burning-nl.htm#xdelta">xdelta patches</a></li>
				<li><a href="cd-no-gui-burn-nl.htm">Branden zonder GUI</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-nl.htm">Live-CD modus</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-nl.htm#rootpw">Root-wachtwoord op de sidux-Live-CD</a></li>
				<li><a href="live-mode-nl.htm#live-cd-installsoft">Installatie van software in de Live-CD modus</a></li>
				<li><a href="live-mode-nl.htm#ntfs-3g">Schrijven op NTFS-partities met ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="term-konsole-nl.htm">De Terminal/Konsole</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="term-konsole-nl.htm#term-kon">Terminal/Konsole</a></li>
				<li><a href="term-konsole-nl.htm#cli-help">Help voor de commando regel</a></li>
				<li><a href="term-konsole-nl.htm#term-cmds">Lijst van Terminal commando's</a></li>
				<li><a href="term-konsole-nl.htm#shell-scripts">Installeer Scripts.sh</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cheatcodes-nl.htm">CheatCodes</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cheatcodes-nl.htm#cheatcodes">Cheatcodes</a></li>
				<li><a href="cheatcodes-vga-nl.htm#vga">VGA Codes</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="part-gparted-nl.htm">Partitioneren van je harddisk</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="part-gparted-nl.htm#partition">Partitioneren van je HD dmv GParted</a></li>
				<li><a href="part-gparted-nl.htm#ntfs">NTFS partitie vergroten/verkleinen mbv GParted</a></li>
				<li><a href="part-uuid-nl.htm#uuid">UUID, Partitie Labelling en fstab</a></li>
				<li><a href="part-cfdisk-nl.htm#partition">Partitioneren van je HD dmv cfdisk</a></li>
				<li><a href="part-cfdisk-nl.htm#formating">Formatteren na partitioneren mbv cfdisk</a></li>
				<li><a href="part-size-examp-nl.htm#part-example">Voorbeelden van partitie groottes</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-nl.htm">Installatie opties</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-nl.htm#Inst-prep">Installatie voorbereiden</a></li>
				<li><a href="hd-install-nl.htm#Installation">Installeren naar je HD</a></li>
				<li><a href="hd-install-nl.htm#first-hd-boot">De eerste keer opstarten</a></li>
				<li><a href="hd-install-opts-nl.htm#fromiso">Opstarten middels 'fromiso'</a></li>
				<li><a href="hd-install-opts-nl.htm#usb-hd">Installeren op een USB-HD</a></li>
				<li><a href="hd-install-opts-nl.htm#qemu">Installeren met QEMU</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-nl.htm">Grafische kaarten, HW devices en drivers</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="hw-dev-hw-dri-nl.htm#hd-ntfs3g">Schrijven naar NTFS</a></li>
				<li><a href="hw-dev-hw-dri-nl.htm#non-free-3d">Binary, non-free drivers voor Nvidia / ATI</a></li>
				<li><a href="hw-dev-hw-dri-nl.htm#native-nv-ati">Free xorg drivers voor nVidia, ATI, Radeon, Intel</a></li>
				<li><a href="hw-dev-hw-dri-nl.htm#mon-res">Schermresolutie en monitor</a></li>
				<li><a href="hw-dev-hw-dri-nl.htm#non-free">Hardware met niet-vrije/gratis drivers</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="wm-kde-nl.htm">Window managers</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="wm-kde-nl.htm#desk-freeze">KDE Desktop bevriest</a></li>
				<li><a href="wm-kde-nl.htm#kde-login">Kan niet in KDE aanloggen</a></li>
				<li><a href="wm-kde-nl.htm#ch-th">Thema veranderen</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="lamp-apache-nl.htm">sidux LAMP Stack</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="lamp-apache-nl.htm#serv-apache">sidux LAMP Stack</a></li>
				<li><a href="lamp-apache-nl.htm#serv-ftp">FTP Clients</a></li>
				<li><a href="lamp-apache-nl.htm#serv-sec">Security Protocols</a></li>
				<li><a href="lamp-apache-nl.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-nl.htm#serv-mysql">MySQL Setup</a></li>
				<li><a href="lamp-ppp-nl.htm#serv-php">PHP in Apache</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="internet-connecting-nl.htm">Internet en netwerken</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="ntp-server-nl.htm#ntp-server">Tijdserver NTP instellen</a></li>
				<li><a href="internet-connecting-nl.htm#firewalls">Firewalls</a></li>
				<li><a href="tor-privoxy-nl.htm#tor">Tor</a></li>
				<li><a href="tor-privoxy-nl.htm#privoxy">Privoxy</a></li>
				<li><a href="samba-nl.htm#configure">Configureren van SAMBA (Windows)</a></li>
				<li><a href="samba-nl.htm#setup">Samba-Server instellen</a></li>
				<li><a href="ssh-nl.htm#ssh-fs">SSH Remote mounten</a></li>
				<li><a href="ssh-nl.htm#ssh-x">X Window Apps via SSH</a></li>
				<li><a href="ssh-nl.htm#ssh-f">GUI SSH mbv Konqueror</a></li>
				<li><a href="ssh-nl.htm#ssh-w">SSH X-doorsturen vanaf een Windows-PC</a></li>
				<li><a href="ssh-nl.htm#ssh">SSH en beveiliging</a></li>
				<li><a href="internet-connecting-nl.htm#dial-mod">56k modems</a></li>
				<li><a href="internet-connecting-ndis-nl.htm#ndiswrapper-basic">Activeren van Ndiswrapper</a></li>
				<li><a href="internet-connecting-ndis-nl.htm#ndiswrapper-advanced">Activeren van Ndiswrapper -  Advanced</a></li>
				<li><a href="internet-connecting-wpa-nl.htm#wpa">WIFI-WLAN</a></li>
				<li><a href="internet-connecting-nl.htm#internetsharing">Internet delen</a></li>
				<li><a href="internet-connecting-nl.htm#netcardconfig">Online komen</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-apt-nl.htm">Installeren/verwijderen en downgraden van een pakket</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="sys-admin-apt-nl.htm#apt-cook">APT kookboek en sources list</a></li>
				<li><a href="sys-admin-meta-nl.htm#meta-pack">Meta-Pakket installeren</a></li>
				<li><a href="sys-admin-meta-nl.htm#meta-pack">Meta-Pakket en proxies</a></li>
				<li><a href="sys-admin-apt-nl.htm#apt-install">Nieuw pakket installeren</a></li>
				<li><a href="sys-admin-apt-nl.htm#apt-delete">Een pakket verwijderen</a></li>
				<li><a href="sys-admin-apt-nl.htm#apt-downgrade">Downgraden van een pakket</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="sys-admin-apt-nl.htm">Systeembeheer</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="sm-siduxcc-nl.htm#sm">smxi Syntax commando sets</a></li>
				<li><a href="sm-siduxcc-nl.htm#siduxcc">siduxcc</a></li>
				<li><a href="sys-admin-apt-nl.htm#apt-upgrade">Upgraden van een ge&#239;nstalleerd systeem</a></li>
				<li><a href="sys-admin-upgrade-nl.htm#live-cd-upgrade">Upgraden dmv je Live-CD</a></li>
				<li><a href="sys-admin-kern-upg-nl.htm#kern-upgrade">Upgraden van de kernel</a></li>
				<li><a href="sys-admin-rdiff-nl.htm#rdiff">Backup met rdiff</a></li>
				<li><a href="sys-admin-rsync-nl.htm#rsync">Backup met rsync</a></li>
				<li><a href="vir-rkits-nl.htm#virus-rkits">Virus en rootkit scanners</a></li>
				<li><a href="sys-admin-gen-nl.htm#start-services">Een service starten</a></li>
				<li><a href="sys-admin-gen-nl.htm#pw-lost">Root wachtwoord vergeten</a></li>
				<li><a href="sys-admin-gen-nl.htm#fonts">Lettertypes</a></li>
				<li><a href="sys-admin-gen-nl.htm#cups">CUPS</a></li>
				<li><a href="sys-admin-gen-nl.htm#init">sidux runlevels - init</a></li>
				<li><a href="sys-admin-grub-bootman2-nl.htm#mbr-grub-boot">MBR bootsector overschreven</a></li>
				<li><a href="sys-admin-grub-bootman2-nl.htm#dual-boot">Dual- en multibooting</a></li>
				<li><a href="sys-admin-grub-bootman2-nl.htm#boot-grub-floppy">Aanmaken van een boot-diskette</a></li>
				<li><a href="sys-admin-grub-bootman2-nl.htm#remove-grub">Grub uit de MBR verwijderen</a></li>
				<li><a href="sys-admin-grub-bootman2-nl.htm#what-is-grub">Grub de bootmanager</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="rdiff">
			<h2 id="top-header">Een backup van het systeem maken met rdiff-backup</h2>
				<p>rdiff-backup is een programma om je bestanden te 'backuppen' (het kan op verschillende *nix-porten gedraaid worden).<br />
				Het mooie van sidux is dat je kunt kiezen hoe je dit proces wil beginnen: met DIY of dmv eeb script.</p>

				<h3><a href="http://techpatterns.com/forums/about831.html">Hier vind je het script van h2</a></h3>
	<div class="spacer02"></div>

			<h5>Hieronder volgt de DIY versie</h5>

			<h6>rdiff-backup</h6>

				<p class="highlight-2">Voer de commando's in als root in de konsole, tenzij anders vermeld.</p>

				<p>
          *het is supergeschikt om misgelopen dist-upgrades, kernel-upgrades enz te herstellen (trouwens ook prima om individuele bestanden terug te halen).
          <br />
				*het maakt alleen een backup van wat er veranderd is, zoals rsync dat doet (dus iedere backup neemt maar weinig tijd in beslag).<br />
				*het houdt bij wat er verandert (dat betekent dat je een bestand kunt terug halen dat je drie weken geleden verwijderd hebt!).<br />
				*het maakt veilige backups over een netwerk (gebruikt daarbij ssh)<br />
				*het maakt een backup van partities terwijl ze gemount (aangekoppeld) zijn. (dus het is erg makkelijk om een dagelijkse backup in te stellen ... umounten (ontkoppelen) is niet nodig).<br />
				*het kan alles herstellen als je harde schijf over de kop gaat en je een nieuwe moet kopen.<br />
				*het past zich aan om backups te maken ook binnen grotere netwerken (linux doet het hier goed, windows is moeilijker) en wordt gebruikt in het bedrijfsleven.<br />
				*het is een command-line applicatie, dus het is zeer geschikt als je ervan houdt om dingen als automatische backups op een krachtige manier te doen (bijvoorbeeld een bash script dat aangeroepen wordt door cron).<br />
				*het herinnert zich en gaat om met bestandseigendom en -permissie, en ook met symbolische links (en dat soort zaken), zodat je als je iets herstelt of terughaalt, dat precies zo terugkrijgt als het was.</p>

			<h6>Wat je nodig hebt</h6>
				<p>rdiff-backup bewaart een volledige (uncompressed) kopie van de files waar je een backup van maakt, en ook een geschiedenis (incremental backups). Dit betekent dat de ruimte die je gebruikt om backups te maken groter moet zijn dan die waar je een backup van maakt.  Als je een backup maakt van 100 gig, heb je daar misschien wel 120 gig voor nodig (bij voorkeur op een aparte schijf!).</p>

			<h6>Hoe je het moet instellen</h6>
				<p>Laten we zeggen dat er het volgende in je pc zit:<br />
				* een harde schijf van 100 gig (hda) die in gebruik is, met koppelpunten (mounts): hda1 voor de root partitie, en hda5 om muziek en andere bestanden op te slaan, en hda6 voor swap (wisselheugen).<br />
				* een lege harde schijf van 200 gig (hdb), die niet gebruikt wordt, met één koppelpunt (mount) op hdb1 .... deze gebruiken we om onze backup op te maken.<br />
				* IP addres 192.168.0.1</p>

				<p>Het eerste wat je moet doen is rdiff-backup installeren:</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<p>Hoewel je van iedere directory een backup kunt maken, gaan we er hier van uit dat je een backup maakt van een hele partitie ... je wilt een backup maken van hda1 en hda5 (en niet van hda6), en dus maak je een paar directories aan waar je je data op gaat slaan:</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/root
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Je hebt een eigen IP adres nodig voor als je deze computer wilt gebruiken om ook een backup te maken vanaf een andere computer (dit wordt later behandeld).</p>

			<h6>Het maken van een backup</h6>

				<p>rdiff-backup gebruikt de syntax <span class="highlight-3">rdiff-backup source-dir dest-dir</span>. Opmerking: specificeer altijd de namen van directories, niet van bestanden.</p>

				<p>Om een backup te maken van hda5, doe het volgende:</p>
<pre>
# rdiff-backup /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>En om een backup van de root-partitie te maken, doe je:</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
</pre>
				<p>Alle "AF_UNIX path too long" foutmeldingen kun je negeren.<br />Het kan allemaal een tijdje duren omdat dit de eerste keer is dat er een backup van de partitie gemaakt wordt. rdiff-back maakt dus een backup van de hele partitie (niet alleen van de verschillen). Merk op dat je niet van alles een backup wilt maken: niet van /tmp omdat deze altijd verandert; niet van /proc of /sys omdat hier geen echte bestanden op staan; bovendien willen we ook geen backup van mounts (koppelpunten), zoals in /media - als je daar wel een backup van maakt, doe je dat in dit geval van hdb1 en kom je terecht in een eeuwige 'loop'. Een manier om daaraan te ontkomen is om van de (andere) mounts een aparte backup te maken.</p>

				<p>Je voert '/proc/*' in in plaats van alleen '/proc' omdat hierdoor slim genoeg wel een backup gemaakt wordt van de directorienaam /proc, maar alles in de directory met rust laat. Hetzelfde geldt voor /tmp, /sys en nog bijdehanter: alle namen van de koppelpunten (mountpoints).</p>

				 <p>Als je dus je rootpartitie vernietigt en een volledig herstel uitvoert zullen de directorienamen: /tmp, /proc, /sys, en de mountpoints aangemaakt worden (zoals dat ook hoort). Als /tmp niet bestaat terwijl X opstart, zou deze daarover kunnen klagen. Daardoor werkt deze mogelijk dan niet. Zie voor meer informatie de handleiding over: --exclude en --include).</p>

			<h6>Directories herstellen vanaf backups</h6>

				<p>rdiff-backup gebruikt dee syntax:</p>
<pre>
rdiff-backup -r &lt;from-when&gt; &lt;source-dir&gt; &lt;dest-dir&gt;
</pre>
				<p>Als je nu per ongeluk de directorie /media/hda7/foto's verwijderd hebt, kun je dit herstellen door het volgende in te voeren:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5/foto's /media/hda5/foto's
</pre>
				<p>De optie "-r now" betekent: herstel vanaf de laatste backup. Als je van alles periodiek een backup maakte (laat we zeggen met crontab), en je je tot een paar dagen terug niet realiseerde dat de foto's directorie ontbrak, zou je een backup van een paar dagen eerder moeten gebruiken (en niet "now", aangezien de laatste backup aangeeft dat de foto's directorie ontbreekt). Misschien wil je ook wel gewoon om wat voor reden dan ook teruggaan naar een eerdere versie of iets dergelijks.</p>

				<p>Als je iets wilt herstellen van drie dagen terug, gebruik dan "-r 3D" ... maar, zoals de handleiding aangeeft, let hier dan wel even op:</p>

				<p class="highlight-1">"3D" refereert aan de onmiddellijke 72 uur vóór het huidige moment, en als er toen geen backup gemaakt is, herstelt rdiff-backup de situatie zoals die met de backup daarvóór vastgelegd is. Bijvoorbeeld in bovengenoemd situatie: als "3D" gebruikt wordt en er zijn alleen backups van 2 en 4 dagen geleden, dan wordt de directorie teruggezet zoals die 4 dagen geleden was (dus denk daar even aan als je een herstel wilt uitvoeren).</p>

				<p>Het volgende commando zal de data en tijdstippen weergeven waarop de backups van hda5 werden uitgevoerd:</p>
<pre>
# rdiff-backup -l /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
			<h5>Partities herstellen</h5>

				<p>Je kunt ook hele partities (mounts) terugzetten, tenslotte is een mount point (koppelpunt) eigenlijk gewoon een directorie.</p>

				<p class="highlight-2">WAARSCHUWING: Herstel je root-partitie niet als je erin geboot bent! Met één commando verlies je alle bestanden op al je partities, ook alle backups die op een aparte schijf staan!!<br /> rdiff-backup doet precies waarvoor het opdracht krijgt ... als de backup voor de root-partitie lege mount points (koppelpunten) heeft, dus om de situatie te herstellen naar hoe die was, verwijdert diff-backup alles in de mounts.</p>

				<p>Om hda5 terug te zetten van de laatste backup, doe je gewoon:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5 /media/hda5
</pre>
			<h5>De root-partitie herstellen</h5>

				<p>
          Maar de root-partitie terugzetten is minder simpel. Zet de root-partitie niet terug, zolang deze aangekoppeld is (zie daarvoor de waarschuwing hierboven).<br />Het kan echt nuttig zijn om de root-partitie te herstellen. Als je onder het installeren/upgraden de zaak verprutst of de boel verpest bij het installeren van een nieuwe kernel, kun je met een gerust hart alles terugdraaien naar hoe je het had. Dat kost je maar 20 minuten.
        </p>

				<p>Een van de manieren om een root-partitie te herstellen is, om in een ongebruikte linux-partitie te booten - als je er één op je harde schijf hebt. Dan kun je elke partitie herstellen die je maar wilt, aangezien die dan niet gemount is als root. Boot erin, nadat je die partitie hersteld hebt, en alles is precies hetzelfde als wanneer je een backup had gebruikt - precies hetzelfde! Deze manier is verreweg de makkelijkste.</p>

				<p>Een andere manier om je root-partitie te herstellen is om de sidux live cd te gebruiken en vanaf de live cd de zaak te herstellen. rdiff-backup staat erop. Mocht die niet staan op de sidux live cd versie die jij gebruikt, dan kun je in grub (bootoptions, (Cheatcodes)) de cheatcode "unionfs" typen - dat houdt in dat je applicaties op je live cd kunt installeren. Boot gewoon en type de volgende commando's:</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h6>Ok, nu gaan we herstellen:</h6>
<pre>
# mount /dev/hda1 /media/hda1
# mount /dev/hdb1 /media/hdb1
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>NB: Als je geen sidux cd hebt maar je gebruikt een livecd met 'klik' ondersteuning, dan kun je rdiff-backup installeren door 'klik' te gebruiken en dan het volgende aan te roepen:</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Het is raadzaam om het herstelproces te controleren als je van je root-partitie een backup maakt (met de bedoeling een herstel uit te voeren als dat nodig is). Niets ergers dan denken dat alles in orde zal komen en dan iets onverwachts tegenkomen in een noodsituatie.</p>

			<h5>Een backup maken van andere pc's</h5>

				<p>Je kunt ook een backup maken van andere pc's op je eigen pc. Voorwaarde is wel dat je eigen pc gebruik kan maken van het ssh-protocol naar de bedoelde pc-op-afstand - en je moet natuurlijk genoeg opslagcapaciteit hebben op je eigen pc. De ssh-server moet op die andere pc draaien. Hij hoeft niet in je lokale LAN te staan - hij mag overal op de wereld zijn.</p>

				<p>Laten we ervan uitgaan dat je andere pc over het volgende beschikt:<br />
				1) een 100 gig harde schijf (hda) die in gebruik is en waarbij alles dus is aangekoppeld,<br />
				2) hda1 gebruikt voor de root-partitie,<br />
				3) hda5 gebruikt voor het opslaan van een paar tijdelijke gegevens waar we geen backup van willen maken,<br />
				4) en hda6 als swap <br />
				5) IP addres 192.168.0.2</p>

				<p>NB: van alletwee de 100 gig schijven kan normaal gesproken niet een backup gemaakt worden op een 200 gig grote harde schijf, als je rdiff-backup gebruikt (dit omdat er dan geen plek is voor de zogenaamde 'incremental files'). Aangezien je geen backup maakt van hda5 van je pc-op-afstand en trouwens ook omdat normaal gesproken je harde schijf niet voor de volle 100% vol zit, kun je er vanuit gaan dat je genoeg ruimte hebt voor een backup. Het is wel zo dat elke keer dat je met rdiff-backup een backup maakt er meer van die zogenaamde 'incremental files' aangemaakt worden. Deze nemen dus meer en meer plek in beslag.</p>

				<p>Je kunt rdiff-backup opdracht geven om slechts backups van een maand oud te bewaren (dat commando geven we je hier verderop), en dat neemt natuurlijk lang niet zoveel ruimte in beslag dan backups over de periode van ene jaar. Daarnaast .... als je over ene periode van ene jaar backups bewaart dan horen daar ook weer de nodige 'incremental files' bij.</p>

				<p>Het eerste dat je moet doen is rdiff-backup op de pc-op-afstand te installeren (op elke pc waarvan je een backup wil maken en ook op de pc die als backup-server dienst doet moet rdiff-backup staan.)</p>

				<p>Om een backup te maken van de pc-op-afstand op jouw pc (192.168.0.1), voer je het volgende in: <span class="highlight-4">Let op het gebruik van twee keer de dubbele punt :: </span></p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/media/hdb1/rdiff-backups/192.168.0.2/root
</pre>
				<p>Als je nou een directory wil herstellen op je pc-op-afstand, begin dan de 'restore' op of je eigen pc of op de pc-op-afstand.</p>

				<p>Zo herstel je de directory /usr/local/games op je pc-op-afstand, vanaf die pc:</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<p>Zo herstel je de directory /usr/local/games op je pc-op-afstand, vanaf je eigen pc:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<p>Gebruik dezelfde syntax als je je root partitie herstelt vanaf een live cd (de pc-op-afstand is dan wel met een live cd opgestart ... zie hierboven).</p>

			<h5>Automatische backups:</h5>

				<p>Als je backups maakt van andere pc's op je lokale pc, is het eerste dat je moet doen wachtwoordloze ssh logins mogelijk maken, gebruikmakend van ssh-keys.<span class="highlight-2"> Let er op dat we het hier heben over wachtwoordloze ssh-logins als 'root'. Dit kun je zo inperken dat alleen rdiff-backup commando's zo uitgevoerd worden. - maar dit valt buiten de scope van dit topic. Ik verwijs daarom naar de <a href="samba-en.htm#ssh-s">SSH Configuration</a> </span>. We gaan uit van volledig vertrouwen en we zetten hier de eenvoudigste manier op van hetr verkrijgen van wachtwoordloze logins.</p>

				<p>Doe het volgende vanaf je lokale pc:</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<p>En dan twee keer 'enter' voor lege wachtwoorden. Daarna doe je:</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<p>Je zult om je root-wachtwoord gevraagd worden:</p>

				<p>Je kunt nu naar de pc-op-afstand ssh-en als root zonder een wachtwoord te hoeven invoeren, en rdiff-backup kan nu geautomatiseerd worden.</p>

				<p>Maak tenslotte een bash-script dat alle rdiff-backup commando's bevat. Dat van ons ziet er dan ongeveer zo uit:</p>


<pre>
#!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Backing up 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*'\
 --exclude '/sys/*' --exclude '/media/*/*'\
 / /media/hdb1/rdiff-backups/192.168.0.1/root
echo "(and purge increments older than 1 month)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Backing up 192.168.0.1 mount hda5======="
${RDIFF} --ssh-no-compression --exclude /media/hda5/myjunk /media/hda5\
 /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo
echo "=======Backing up 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*' 192.168.0.2::/media/hdb1/rdiff-backups/192.168.0.2/root
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>


				<p>Je kunt dit bash-script nu "myrdiff-backups.bash" noemen en het in de /usr/local/bin plaatsen op je lokale (backup-server) machine, en het uitvoerbaar maken. Start het script en overtuig je ervan dat het goed werkt.</p>

				<p>Tenslotte kun je 'cron' gebruiken om het elke avond om 8 uur te laten draaien. De hieronder weergegeven regel in de 'crontab' van de 'root' doet het hem:</p>
<pre>
# crontab -e
en voeg de volgende regel toe:
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

	
	<div class="spacer05"></div>
</div>
</div>
</body>
</html>
