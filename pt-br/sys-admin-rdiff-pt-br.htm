<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>Manuais do sidux - rdiff (RO)</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<!-- Last translation revision by ceti 17/04/2009 0935 hrs UTC -->
<div id="menu"> <!-- menu starts here pt-br lang maintainer ceti-->
<!--sidux-manual Operating System Manual menu-version-01.87.2009.05.25 -->
<!-- menu last updated by bluewater 2009.05.25 0735 hrs UTC -->
	<div id="menu-header">
<a href="http://sidux.com/"><img src="../lib/logos/sidux-logo.png" title="Ir para sidux.com forums y wiki" alt="sidux.com logo" /></a>
	</div>
	<ul id="top-list">
		<li><a href="manual-search-pt-br.htm#search-on"><img src="../lib/logos/manual-search-22x22.png" title="Search Manual" alt="Search" /> Procurar Online Offline</a> </li>
		<li><a href="http://manual.sidux.com/meta-manual">Manual do sidux-Meta</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-50.png" title="Escolha outra língua - Choose another language" alt="troca-língua" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-pt-br.htm">Manual do sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-pt-br.htm#welcome-gen">Manual do sidux</a></li>
				<li><a href="welcome-pt-br.htm#how-to">Como usar este manual</a></li>
				<li><a href="welcome-pt-br.htm#table-contents">Índice</a></li>
				<li><a href="help-pt-br.htm#help-gen">Onde encontrar ajuda</a></li>
				<li><a href="help-pt-br.htm#paste">IRC !paste</a></li>
				<li><a href="credits-pt-br.htm#cred-team">Créditos</a></li>
				<li><a href="wel-quickstart-pt-br.htm#welcome-quick">Guia Rápido do sidux</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-dl-burning-pt-br.htm">ISO Content, Releases, Download Mirrors and Burning</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-pt-br.htm#cd-content">ISO Content and system requirements</a></li>
				<li><a href="sys-admin-release-pt-br.htm#rolling">Notas sobre atualização automática de versão</a></li>
				<li><a href="cd-dl-burning-pt-br.htm#download-sidux">Espelhos para baixar e queimar</a></li>
				<li><a href="cd-dl-burning-pt-br.htm#md5">Checando o md5</a></li>
				<li><a href="cd-dl-burning-pt-br.htm#burn-nero">Queimando no Windows</a></li>
				<li><a href="cd-dl-burning-pt-br.htm#burn-linux">Queimando no Linux</a></li>
				<li><a href="cd-dl-burning-pt-br.htm#xdelta">Usando o xdelta-patch</a></li>
				<li><a href="cd-no-gui-burn-pt-br.htm#burning-no-gui">Script burniso </a></li>
				<li><a href="cd-no-gui-burn-pt-br.htm#burning-no-gen">Queimando sem interface gráfica</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="live-mode-pt-br.htm">Modo Live</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="live-mode-pt-br.htm#rootpw">Senha de root no sidux-Live ISO</a></li>
				<li><a href="live-mode-pt-br.htm#live-cd-installsoft">Instalando software no modo sidux-Live ISO</a></li>
				<li><a href="live-mode-pt-br.htm#ntfs-3g">Escrevendo em partições NTFS com o ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="term-konsole-pt-br.htm">O Terminal/Konsole</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="term-konsole-pt-br.htm#sux"> sux</a></li>
				<li><a href="term-konsole-pt-br.htm#term-kon"> Terminal/Konsole</a></li>
				<li><a href="term-konsole-pt-br.htm#cli-help">Ajuda para a linha de comando</a></li>
				<li><a href="term-konsole-pt-br.htm#term-cmds">Lista de comandos do terminal</a></li>
				<li><a href="term-konsole-pt-br.htm#shell-scripts">Instalando scripts .sh</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="cheatcodes-pt-br.htm">Cheatcodes</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="cheatcodes-pt-br.htm#cheatcodes">Cheatcodes específicas do sidux-Live ISO</a></li>
				<li><a href="cheatcodes-pt-br.htm#cheatcodes-linux">Cheatcodes para o Linux em geral</a></li>
				<li><a href="cheatcodes-vga-pt-br.htm#vga">Códigos para VGA</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="part-gparted-pt-br.htm">Particionando seu HD</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="part-gparted-pt-br.htm#partition">Particionando seu HD com o GParted</a></li>
				<li><a href="part-gparted-pt-br.htm#ntfs">Redimensionando a partição NTFS com o GParted</a></li>
				<li><a href="part-uuid-pt-br.htm#uuid">UUID, nomeando partições e a fstab</a></li>
				<li><a href="part-cfdisk-pt-br.htm#disknames">Nomes dos discos: uma breve explicação</a></li>
				<li><a href="part-cfdisk-pt-br.htm#partition">Particionando seu HD com o cfdisk</a></li>
				<li><a href="part-cfdisk-pt-br.htm#formating">Formatando com o cfdisk, após particionamento</a></li>
				<li><a href="part-size-examp-pt-br.htm#part-example">Exemplos de tamanhos de partições</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="hd-install-pt-br.htm">Opções de Instalação</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="hd-install-pt-br.htm#Inst-prep">Preparando a instalação</a></li>
				<li><a href="hd-install-pt-br.htm#Installation">Instalando no HD</a></li>
				<li><a href="hd-install-pt-br.htm#first-hd-boot">Primeira inicialização</a></li>
				<li><a href="hd-install-opts-pt-br.htm#fromiso">Inicializando com 'fromiso'</a></li>
				<li><a href="hd-install-opts-pt-br.htm#fromiso-persist">Fromiso e Persist</a></li>
				<li><a href="hd-install-opts-pt-br.htm#usb-hd">Instalando em HD-USB</a></li>
				<li><a href="hd-install-opts-pt-br.htm#vtbox">Instalando com o VirtualBox</a></li>
				<li><a href="hd-install-opts-pt-br.htm#qemu">Instalando com o QEMU</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-pt-br.htm">Placas de Vídeo, Dispositivos Diversos e Drivers</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hw-dev-hw-dri-pt-br.htm#hd-ntfs3g">Escrevendo em partições NTFS com o ntfs-3g</a></li>
				<li><a href="hw-dev-mon-pt-br.htm#mon-res">Resolução de tela e monitores</a></li>
				<li><a href="hw-dev-mon-pt-br.htm#xrandr">Dois monitores e xrandr</a></li>
				<li><a href="hw-dev-mon-pt-br.htm#mon-binary">Dois monitores (usando binários)</a></li>
				<li><a href="hw-dev-hw-dri-pt-br.htm#non-free-3d">Drivers proprietários para nVidia e ATI</a></li>
				<li><a href="hw-dev-hw-dri-pt-br.htm#native-nv-ati">Drivers livres para nVidia, ATI, Radeon e Intel</a></li>
				<li><a href="hw-dev-hw-dri-pt-br.htm#non-free">Hardware que precisa de soluções proprietárias</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="wm-kde-pt-br.htm">Gerenciadores de Janelas</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="wm-xfce-pt-br.htm#xfce-notes">Extras úteis para o XFCE</a></li>
				<li><a href="wm-kde-pt-br.htm#install-add">Extras úteis para o KDE</a></li>
				<li><a href="wm-kde-pt-br.htm#desk-freeze">Travamentos do desktop</a></li>
				<li><a href="wm-kde-pt-br.htm#kde-login">Não consigo entrar no KDE</a></li>
				<li><a href="wm-kde-pt-br.htm#ch-th">Mudando temas</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="lamp-apache-pt-br.htm">LAMP no sidux</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="lamp-apache-pt-br.htm#serv-apache">LAMP no sidux</a></li>
				<li><a href="lamp-apache-pt-br.htm#serv-ftp">Clientes FTP</a></li>
				<li><a href="lamp-apache-pt-br.htm#serv-sec">Protocolos de segurança</a></li>
				<li><a href="lamp-apache-pt-br.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-pt-br.htm#serv-mysql">Configuração do MySQL</a></li>
				<li><a href="lamp-ppp-pt-br.htm#serv-php">PHP no Apache</a></li>
				<li><a href="ntp-server-pt-br.htm#ntp-server">Configuração do serviço NTP</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="internet-connecting-pt-br.htm">Internet e Rede</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="tor-privoxy-pt-br.htm#tor">Tor</a></li>
				<li><a href="tor-privoxy-pt-br.htm#privoxy">Privoxy</a></li>
				<li><a href="internet-connecting-pt-br.htm#firewalls">Firewalls</a></li>
				<li><a href="samba-pt-br.htm#configure">Configurando o SAMBA (Windows)</a></li>
				<li><a href="samba-pt-br.htm#setup">sidux como servidor Samba</a></li>
				<li><a href="ssh-pt-br.htm#ssh-fs">Montagem remota do SSH </a></li>
				<li><a href="ssh-pt-br.htm#ssh-x">Aplicações X via SSH</a></li>
				<li><a href="ssh-pt-br.htm#ssh-f">SSH com o Konqueror</a></li>
				<li><a href="ssh-pt-br.htm#ssh-w">Acesso remoto SSH a partir do Windows</a></li>
				<li><a href="ssh-pt-br.htm#ssh">SSH e segurança</a></li>
				<li><a href="internet-connecting-pt-br.htm#dial-mod">Modems discados</a></li>
				<li><a href="internet-connecting-wpagui-pt-br.htm#wpa-roaming-gui">WiFi - roaming WPA-GUI</a></li>
				<li><a href="internet-connecting-wpa-pt-br.htm#wpa-basic">WiFi - guia básico de configuração</a></li>
				<li><a href="internet-connecting-wpa-pt-br.htm#wpa">WiFi - wpasupplicant</a></li>
				<li><a href="internet-connecting-pt-br.htm#netcardconfig">Configurando a rede - Ceni</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="sys-admin-apt-pt-br.htm">Dist-upgrade e Gerenciamento de Pacotes</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="sys-admin-apt-pt-br.htm#apt-cook">Guia do APT e a sources list</a></li>
				<li><a href="sys-admin-meta-pt-br.htm#meta-pack">Instalador do Meta-Package</a></li>
				<li><a href="sys-admin-meta-pt-br.htm#meta-proxy">Instalador do Meta-Package e proxies</a></li>
				<li><a href="sys-admin-apt-pt-br.htm#apt-install">Instalando um novo pacote</a></li>
				<li><a href="sys-admin-apt-pt-br.htm#apt-delete">Apagando um pacote</a></li>
				<li><a href="sys-admin-apt-pt-br.htm#apt-downgrade">Rebaixando um pacote</a></li>
				<li><a href="sys-admin-apt-pt-br.htm#apt-cache">Procurando pacotes com o apt-cache</a></li>
				<li><a href="sys-admin-apt-pt-br.htm#gui-pacsea">Procurando pacotes no modo gráfico</a></li>
				<li><a href="siduxcc-pt-br.htm#hermes">sidux-hermes</a></li>
				<li><a href="sys-admin-upgrade-pt-br.htm#live-cd-upgrade">Atualizando pelo Live- ISO</a></li>
				<li><a href="sys-admin-kern-upg-pt-br.htm#kern-upgrade">Atualizando o kernel</a></li>
				<li><a href="sys-admin-apt-pt-br.htm#apt-upgrade">Atualizando todo o sistema -  dist-upgrade</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-gen-pt-br.htm">Administração do Sistema</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="hd-install-pt-br.htm#adduser">Adding a new user</a></li>
				<li><a href="home-pt-br.htm#home-bu">Movendo a /home</a></li>
				<li><a href="siduxcc-pt-br.htm#siduxcc">sidux Control Center</a></li>
				<li><a href="sys-admin-rdiff-pt-br.htm#rdiff">Backups com o rdiff</a></li>
				<li><a href="sys-admin-rsync-pt-br.htm#rsync">Backups com o rsync</a></li>
				<li><a href="vir-rkits-pt-br.htm#virus-rkits">Antivírus e caçadores de rootkits</a></li>
				<li><a href="sys-admin-gen-pt-br.htm#start-services">Habilitando/desabilitando serviços</a></li>
				<li><a href="sys-admin-gen-pt-br.htm#pw-lost">Perda de senhas root</a></li>
				<li><a href="sys-admin-gen-pt-br.htm#fonts">Fontes</a></li>
				<li><a href="sys-admin-gen-pt-br.htm#cups">CUPS</a></li>
				<li><a href="sys-admin-gen-pt-br.htm#init">Runlevels no sidux - init</a></li>
				<li><a href="sys-admin-grub-bootman2-pt-br.htm#mbr-grub-boot">Sobrescrição da MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-pt-br.htm#dual-boot">Boots duplos e múltiplos</a></li>
				<li><a href="bios-freedos-pt-br.htm#bois-prep">Atualizando a BIOS com FreeDOS</a></li>
				<li><a href="sys-admin-grub-bootman2-pt-br.htm#boot-grub-floppy">Criando um disquete de boot</a></li>
				<li><a href="sys-admin-grub-bootman2-pt-br.htm#remove-grub">Removendo o GRUB da MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-pt-br.htm#what-is-grub">GRUB, o gerenciador de boot</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>

<div id="main-page">
	<div class="divider" id="rdiff">
			<h2 id="top-header">Como Fazer Back-up do Sistema com o rdiff-backup</h2>
				<p>rdiff-backup é uma ferramenta usada para fazer back-ups (cópias) de seus arquivos. Ele roda em diversos sistemas *nix.<br />
				O diferencial do sidux é que você pode escolher como iniciar o processo: por conta própria ou com um script.</p>

				<h3><a href="http://techpatterns.com/forums/about831.html">Esta é a versão do script desenvolvido por h2.</a></h3>
	<div class="spacer02"></div>

			<h5>O que se segue é a versão DIY - Do It Yourself ('Faça Você Mesmo')</h5>

			<h6>rdiff-backup</h6>

				<p class="highlight-2">Rode os comandos como root no terminal/console, a menos que se diga outra coisa.</p>

				<p>* ótimo para recuperar dist-upgrades e atualizações do kernel que falharam etc (e também para restaurar arquivos individuais).<br />
				* só faz back-ups do que tiver sofrido alterações, como faz o rsync (donde cada back-up não demorar muito).<br />
				* mantém um histórico das mudanças (portanto, você pode recuperar um arquivo que você apagou três semanas atrás!)<br />
				* faz back-ups seguros pela rede (usando ssh).<br />
				* faz back-ups de partições enquanto estão montadas (portanto, é fácil automatizar back-ups diários... não há necessidade de desmontar).<br />
				* pode restaurar tudo se seu HD morrer e você tiver de comprar um novo.<br />
				* reconfigura-se para fazer back-ups de grandes redes (fácil no Linux; no Windows é mais complicado) e é usado em negócios.<br />
				* é um aplicativo de linha de comando, portanto é ótimo para quem gosta de fazer coisas como automatizar back-ups (usando um script chamado pelo cron).<br />
				* lembra e lida bem com donos de arquivos e permissões e também com links simbólicos (e todo esse tipo de coisa); assim, após uma restauração, tudo fica exatamente como era antes.</p>

			<h6>Do que você vai precisar</h6>
				<p>rdiff-backup mantém uma cópia inteira (não comprimida) dos arquivos objeto do back-up e guarda, igualmente, um histórico (back-ups incrementais), o que significa que você vai precisar de um espaço maior do que aquele que está sendo copiado. Por exemplo, se você vai fazer um back-up de 100GB de espaço, você vai precisar de 120GB (de preferência, em um HD separado!).</p>

			<h6>Como configurá-lo</h6>
				<p>Digamos que seu computador tenha:<br />
				* um HD de 100GB (sda), com sda1 usada como partição root, sda5 para guardar músicas e outros arquivos e sda6 como partição swap.<br />
				* outro HD de 200GB (sdb), não utilizado no momento, apenas com a partição sdb1; use-a para seus back-ups.<br />
				* endereço IP 192.168.0.1</p>

				<p>A primeira coisa a fazer é instalar rdiff-backup:</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<p>Embora você possa fazer cópia de qualquer diretório, nosso exemplo é para back-ups de partições inteiras...queremos fazer back-up das partições sda1 e sda5; vamos, então, criar alguns diretórios para armazenar os dados:</p>
<pre>
# mkdir -p /media/sdb1/rdiff-backups/192.168.0.1/root
# mkdir -p /media/sdb1/rdiff-backups/192.168.0.1/sda5
</pre>
				<p>Você precisa do endereço IP bem especificado para o caso de usar esta máquina para fazer o back-up de outra (assunto coberto mais tarde).</p>

			<h6>Como fazer o back-up</h6>

				<p>rdiff-backup usa a sintaxe <span class="highlight-3">rdiff-backup source-dir dest-dir</span>. Nota: especifique sempre os nomes dos diretórios, não os nomes dos arquivos.</p>

				<p>Para fazer cópia de sda5, execute:</p>
<pre>
# rdiff-backup /media/sda5 /media/sdb1/rdiff-backups/192.168.0.1/sda5
</pre>
				<p>e para a partição root:</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/sdb1/rdiff-backups/192.168.0.1/root
</pre>
				<p>Qualquer mensagem de erro "AF_UNIX path too long" pode ser ignorada. Isso vai demorar um pouco, porque é a primeira vez que você faz um back-up dessa partição e, assim, o rdiff-backup terá de fazer cópia de tudo (e não apenas das diferenças). Note que não queremos fazer back-up do diretório /tmp, pois ele sempre muda, nem de /proc ou /sys, que não contêm arquivos reais, e nem de pontos de montagem. Se você fizer back-up dos pontos de montagem, então você estará copiando sdb1 e você poderá cair em um loop (círculo vicioso) infinito! Uma maneira de evitar isso é fazer back-up dos pontos de montagem separadamente.</p>

				<p>A razão de você ter colocado '/proc/*' e não apenas '/proc' é que o nome do diretório /proc fará parte do back-up, mas seu conteúdo será ignorado. O mesmo vale para /tmp, /sys e todos os nomes dos pontos de montagem.</p>

				 <p>Desse jeito, se você destruir sua partição /root e restaurá-la, /tmp, /proc, /sys e os nomes dos pontos de montagem serão criados (como deve ser). Se /tmp não existir quando o X for iniciado, ele vai reclamar. (Veja as páginas de manual para saber mais sobre --exclude e --include).</p>

			<h6>Como restaurar diretórios a partir de back-ups</h6>

				<p>rdiff-backup usa a sintaxe:</p>
<pre>
rdiff-backup -r &lt;de-quando&gt; &lt;dir-fonte&gt; &lt;dir-destino&gt;
</pre>
				<p>Se você deletar acidentalmente o diretório /media/sda7/fotos, você pode restaurá-lo com:</p>
<pre>
# rdiff-backup -r now /media/sdb1/rdiff-backups/192.168.0.1/sda5/fotos /media/sda5/fotos
</pre>
				<p>A opção "-r now" significa que é para restaurar a partir do último back-up. Se você tem feito cópias regularmente de tudo (via crontab, p. ex.) e só reparou dias depois que o diretório de fotos foi apagado, você terá de fazer o back-up a partir de alguns dias atrás (e não 'now' - agora -). Ou talvez você apenas queira voltar a uma versão anterior de alguma coisa.</p>

				<p>Se você quiser restaurar a partir de três dias atrás, então use "-r 3D" ... mas, como dizem as páginas de manual, note o seguinte:</p>

				<p class="highlight-1">"3D" se refere a 72 horas antes do presente e se não houver backup daquele dia, o rdiff-backup restaura a partir da data imediatamente anterior. No caso acima, por exemplo, se "3D" for usado e somente existir back-ups de 2 e 4 dias atrás, o diretório será restaurado a seu estado de 4 dias atrás. (Portanto, você terá de pensar um pouco antes de restaurar).</p>

				<p>Usando o seguinte, você terá datas e horas dos back-ups de sda5:</p>
<pre>
# rdiff-backup -l /media/sdb1/rdiff-backups/192.168.0.1/sda5
</pre>
			<h5>Como restaurar partições</h5>

				<p>Você pode também restaurar partições inteiras (mounts), pois um ponto de montagem nada mais é que um diretório.</p>

				<p class="highlight-2">ATENÇÃO: Não restaure a partição root, se ela está em uso!!! Com apenas um comando, você perderá todos os arquivos em todas as partições, inclusive todos seus back-ups, mesmo que estiverem em HDs separados!! O rdiff-backup segue exatamente as instruções que recebeu...se o back-up para a partição root tiver pontos de montagens vazios, então para restaurar ao estado do back-up, ele deleta tudo nos pontos de montagem, para que tudo fique igual ao back-up.</p>

				<p>Para restaurar sda5 para o último back-up, faça isto:</p>
<pre>
# rdiff-backup -r now /media/sdb1/rdiff-backups/192.168.0.1/sda5 /media/sda5
</pre>
			<h5>Como restaurar a partição root</h5>

				<p>Restaurar a partição root não é tão simples. Não a restaure enquanto ela estiver montada (veja o aviso acima). É realmente útil poder restaurar a partição root, porque se você bagunçar tudo quando estiver instalando/atualizando ou quando estiver instalando um novo kernel etc, você tem a tranquilidade de saber que tudo pode voltar a ser como era antes em apenas 20 minutos.</p>

				<p>Um modo de restaurar a partição root é dar o boot em outra distribuição Linux que por acaso você tiver instalado. Assim, você será capaz de restaurar a partição root que você quer porque ela não está montada. Após restaurá-la, dê o boot por ela e perceba que as coisas estão exatamente como eram quando você fez o back-up. Este é de longe o jeito mais fácil.</p>

				<p>Outra maneira de restaurar a partição root é dar o boot pelo LiveCd do sidux e restaurar a partir dele, pois o rdiff-backup está incluído no CD. Se acaso ele não estiver na sua versão do LiveCD, digite no Grub (Bootoptions, Cheatcodes) a "cheatcode" 'unionfs' para ser capaz de instalar aplicações no modo LiveCD. Simplesmente carregue o sidux e digite no terminal:</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h6>Agora, vamos restaurar:</h6>
<pre>
# mount /dev/sda1 /media/sda1
# mount /dev/sdb1 /media/sdb1
# rdiff-backup -r now /media/sdb1/rdiff-backups/192.168.0.1/root /media/sda1
</pre>

				<p>Nota: se você não tiver um CD do sidux, mas se o LiveCD que você estiver usando tiver suporte do Klik, você pode instalar o rdiff-backup por ele e chamando:</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/sdb1/rdiff-backups/192.168.0.1/root /media/sda1
</pre>

				<p>É recomendável que todos que fizerem back-ups da partição root (com a intenção de restaurá-la) testem o processo de restauração. Nada pior que pensar que tudo está correto e só descobrir algo inesperado numa emergência.</p>

			<h5>Como fazer back-ups de outros PCs</h5>

				<p>Você pode fazer back-ups de outros PCs a partir de sua máquina local, desde que seja possível a conexão de sua máquina com as outras, através do ssh (e desde que você tenha espaço sobrando em seu HD). O servidor ssh (sshd) precisa estar rodando em um PC remoto. Os outros PCs não precisam estar em sua rede local, eles podem estar em qualquer lugar do mundo.</p>

				<p>Vamos assumir que seu PC remoto tenha as seguintes características:<br />
				1) um HD de 100GB (sda1), em uso, somente com pontos de montagem<br />
				2) sda1 usado para a partição root<br />
				3) sda5 onde guardamos alguns arquivos temporários, que não serão objeto do back-up<br />
				4) sda6 para swap <br />
				5) endereço IP 192.168.0.2</p>

				<p>Nota: ambos HDs de 100GB não podem, geralmente, ser copiados em um HD de 200GB com o rdiff-backup (porque não há espaço para os arquivos incrementais), mas já que você não vai fazer back-up da partição sda5 em seu PC remoto (e tendo em vista que HDs raramente estão 100% cheios, mas não confie tanto nisso), então você pode concluir que, sim, você tem espaço suficiente. Toda vez que o rdiff-backup fizer um back-up, mais arquivos incrementais serão criados, ocupando mais e mais espaço.</p>

				<p>Você pode pedir ao rdiff-backup para manter apenas os back-ups do último mês; assim seu HD estará menos cheio do que se o rdiff-backup guardar dados de um ano inteiro. Naturalmente, você pode guardar dados de um ano, mas você terá de comprar outro HD.</p>

				<p>Antes de mais nada, instale o rdiff-backup no PC remoto também (todos os computadores cujos back-ups você deseja fazer e também o servidor de back-up precisam do rdiff-backup instalado).</p>

				<p>Para copiar o PC remoto em seu PC local, rode neste (IP 192.168.0.1): <span class="highlight-4">Note o use de duplos dois pontos --> :: </span></p>
<pre>
# mkdir /media/sdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/ /media/sdb1/rdiff-backups/192.168.0.2/root 
</pre>
				<p>Se você quiser restaurar um diretório no PC remoto, a restauração pode ser iniciada tanto no PC remoto quanto no PC local.</p>

				<p>Por exemplo, para restaurar o diretório /usr/local/games no PC remoto, iniciando o processo nele mesmo:</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/sdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<p>Para restaurar o diretório /usr/local/games no PC remoto, iniciando o processo no PC local:</p>
<pre>
# rdiff-backup -r now /media/sdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<p>Use a mesma sintaxe quando for restaurar a partição root a partir do LiveCD (onde o boot do PC remoto foi feito via LiveCD... veja mais acima).</p>

			<h5>Como automatizar os back-ups:</h5>

				<p>Se você estiver fazendo back-ups de outros PCs em sua máquina local, a primeira coisa a fazer é ativar logins sem senha no ssh, usando chaves ssh. <span class="highlight-2">Note que estamos falando de logins como root. Você pode limitar o rdiff-backup de forma que apenas seus comandos sejam executados, mas isso está fora do escopo deste tópico. Favor ver <a href="ssh-pt-br.htm#ssh-s">Configuração do SSH</a> </span>. Vamos configurar a maneira mais simples de fazer logins sem senha.</p>

				<p>No PC local, faça o seguinte:</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<p>... e pressione [ENTER] duas vezes para senhas em branco. Então digite:</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\<!--dunno if this is wrong-->
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<p>O sistema vai pedir sua senha de root.</p>

				<p>Agora você pode se conectar com o PC remoto pelo ssh, sem precisar de digitar uma senha, e o back-up do diff-backup passa a ser automatizado.</p>

				<p>A seguir, crie um script que contenha todos os comandos do rdiff-backup. Esse script terá mais ou menos essa feição:</p>


<pre>
#!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Back-up de 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/sdb1/rdiff-backups/192.168.0.1/root
echo "(e purgue incrementos mais antigos que 1 mês)"
${RDIFF} --remove-older-than 1M --force /media/sdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Back-up de 192.168.0.1 partição sda5======="
${RDIFF} --ssh-no-compression --exclude /media/sda5/myjunk /media/sda5 /media/sdb1/rdiff-backups/192.168.0.1/sda5
echo "(e purgue incrementos mais antigos que 1 mês)"
${RDIFF} --remove-older-than 1M --force /media/sdb1/rdiff-backups/192.168.0.1/sda5
echo
echo "=======Back-up de 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*' 192.168.0.2::/media/sdb1/rdiff-backups/192.168.0.2/root
echo "(e purgue incrementos mais antigos que 1 mês)"
${RDIFF} --remove-older-than 1M --force /media/sdb1/rdiff-backups/192.168.0.2/root
</pre>


				<p>Dê o nome de "myrdiff-backups.bash" a esse script, coloque-o no diretório /usr/local/bin de seu PC local (servidor de back-up), e torne-o executável. Rode o script para ter certeza de que funciona.</p>

				<p>Por fim, vamos pedir ao cron para rodá-lo todas as noites, às 20:00h. Insira a linha abaixo no crontab,como root:</p>
<pre>
# crontab -e
e insira a seguinte linha:
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

			<div id="rev">Content last revised 05/12/2007 1230 UTC</div>
</div>
</div>
</body>
</html>
