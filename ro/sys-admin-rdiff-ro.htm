<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>sidux Manuals - rdiff</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
	<style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
	<style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
	<link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
	<script type="text/javascript" src="../lib/css-js/menu2.js"></script>
</head>
<body>
<div id="menu"> <!-- menu starts here -->
<!--Welcome to the Official sidux-manual 0.1-05-05-2007 ro lang maintainer ladepa-->
<!-- menu last updated by bluewater 05/05/2007 1100rs AEST 05/05/2007 0100hrs UTC -->
<img src="../lib//logos/sidux-logo.png" alt="logo" id="menu-header" />
	<ul id="top-list">
		<li><a href="http://sidux.com/">Back to main sidux menu</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-50.png" title="Choose another language" alt="lang-switch" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-ro.htm">Bine ati venit la manualul oficial  Sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-ro.htm#welcome-gen">Manual Oficial </a></li>
				<li><a href="welcome-ro.htm#how-to">Folosirea acestui manual</a></li>
				<li><a href="help-ro.htm#help-gen">De unde primiti ajutor</a></li>
				<li><a href="credits-ro.htm#cred-team">Credits</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-ro.htm">Continutul CD-ului</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-ro.htm#cd-content">Continutul CD-ului</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cd-dl-burning-ro.htm">Descarcarea si scrirea CD-ului</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cd-dl-burning-ro.htm#download-sidux">Descarcarea si scrierea CD-ului</a></li>
				<li><a href="cd-dl-burning-ro.htm#md5">Verificarea cu suma de control md5 </a></li>
				<li><a href="cd-dl-burning-ro.htm#burn-nero">Scrierea in Windows</a></li>
				<li><a href="cd-dl-burning-ro.htm#burn-linux">Scrierea in Linux</a></li>
				<li><a href="cd-dl-burning-ro.htm#xdelta">Adaugirile xdelta (Patching)</a></li>
				<li><a href="cd-no-gui-burn-ro.htm">Scrierea CD-ului fara GUI (interfata grafica)</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-ro.htm">Live Mode</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-ro.htm#rootpw">Parola de root pe sidux-LiveCD</a></li>
				<li><a href="live-mode-ro.htm#live-cd-installsoft">Instalarea de software in timpul lucrului de pe Live-CD</a></li>
				<li><a href="live-mode-ro.htm#live-cd-perm-store">Stocarea permanenta a schimbarilor facute pe un HD folosind Live-CD-ul</a></li>
				<li><a href="live-mode-ro.htm#ntfs-3g">Scrierea pe partitii  NTFS cu ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="term-konsole-ro.htm">Terminalul /Konsola</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="term-konsole-ro.htm#term-kon"> Terminalul/Konsola</a></li>
				<li><a href="term-konsole-ro.htm#cli-help">Ajutor in Linie de Comanda</a></li>
				<li><a href="term-konsole-ro.htm#shell-scripts">Instalarea Scripts.sh</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="cheatcodes-ro.htm">CheatCodes</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="cheatcodes-ro.htm#cheatcodes">Cheatcodes</a></li>
				<li><a href="cheatcodes-vga-ro.htm#vga"> Coduri VGA </a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="part-gparted-ro.htm">Partitionarea Hard Discului</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="part-gparted-ro.htm#partition">Partitionarea Hard Discului folosind GParted</a></li>
				<li><a href="part-gparted-ro.htm#ntfs">Redimensionarea partitiilor NTFS folosind GParted</a></li>
				<li><a href="part-uuid-ro.htm#uuid">UUID, Etichetarea Partitiilor si fstab</a></li>
				<li><a href="part-cfdisk-ro.htm#partition">Partitionarea Hard discului folosind cfdisk</a></li>
				<li><a href="part-cfdisk-ro.htm#formating">Formatarea dupa partitionarea cu cfdisk</a></li>
				<li><a href="part-size-examp-ro.htm#part-example">Exemple de marimi de Partitii </a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-ro.htm">Optiuni de Instalare </a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-ro.htm#Inst-prep">Pregatirea Instalarii</a></li>
				<li><a href="hd-install-ro.htm#Installation">Instalarea pe  Hard Disc</a></li>
				<li><a href="hd-install-ro.htm#first-hd-boot">Prima Pornire</a></li>
				<li><a href="hd-install-opts-ro.htm#perst-home"> Home permanent</a></li>
				<li><a href="hd-install-opts-ro.htm#fromiso">Pornirea 'fromiso'</a></li>
				<li><a href="hd-install-opts-ro.htm#usb-hd">Instalarea pe un USB-Hard Disc</a></li>
				<li><a href="hd-install-opts-ro.htm#qemu">Instalarea prin QEMU</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-ro.htm">Placi Grafice ,Dispozitive Hardware si Drivere</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="hw-dev-hw-dri-ro.htm#hd-ntfs3g">Scrierea pe partitii NTFS</a></li>
				<li><a href="hw-dev-hw-dri-ro.htm#nvidia-3d">nVidia 3d</a></li>
				<li><a href="hw-dev-hw-dri-ro.htm#ati-3d">ATI 3d</a></li>
				<li><a href="hw-dev-hw-dri-ro.htm#native-nv">Native nv</a></li>
				<li><a href="hw-dev-hw-dri-ro.htm#native-ati">Native ati</a></li>
				<li><a href="hw-dev-hw-dri-ro.htm#mon-res">Schimbarea rezolutiei si Monitoare</a></li>
				<li><a href="hw-dev-hw-dri-ro.htm#non-free">Hardware ce necesita drivere non-free </a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="wm-kde-ro.htm"> Managere in mod grafic</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="wm-kde-ro.htm#desk-freeze">KDE Desktop se blocheaza</a></li>
				<li><a href="wm-kde-ro.htm#kde-login">Daca nu poti loga in KDE</a></li>
				<li><a href="wm-kde-ro.htm#ch-th">Schimbarea Temelor</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="lamp-apache-ro.htm">Setul LAMP din sidux </a>
			<ul class="sub-menu" id="sm14">
				<li><a href="lamp-apache-ro.htm#serv-apache"> Setul LAMP din sidux</a></li>
				<li><a href="lamp-apache-ro.htm#serv-ftp">Clienti FTP </a></li>
				<li><a href="lamp-apache-ro.htm#serv-sec">Protocoale de Securitate</a></li>
				<li><a href="lamp-apache-ro.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-ro.htm#serv-mysql">Setarea MySQL </a></li>
				<li><a href="lamp-ppp-ro.htm#serv-php">PHP in Apache</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="internet-connecting-ro.htm">Internet si Networking</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="ntp-server-ro.htm#ntp-server">Setarea Timeserver-ului </a></li>
				<li><a href="internet-connecting-ro.htm#firewalls">Mini-Firewall</a></li>
				<li><a href="samba-ro.htm#configure">Configurarea SAMBA (Windows)</a></li>
				<li><a href="samba-ro.htm#setup">Setarea Serverului Samba </a></li>
				<li><a href="ssh-ro.htm#ssh-fs">Montarea de la distanta SSH </a></li>
				<li><a href="ssh-ro.htm#ssh-x">Aplicatii X Window via SSH</a></li>
				<li><a href="ssh-ro.htm#ssh-f">GUI SSH cu Konqueror</a></li>
				<li><a href="ssh-ro.htm#ssh-w">SSH X-Forwarding de la un Windows-PC</a></li>
				<li><a href="ssh-ro.htm#ssh">SSH si Securitatea</a></li>
				<li><a href="internet-connecting-ro.htm#dial-mod">Modemuri 56k </a></li>
				<li><a href="internet-connecting-ro.htm#ndiswrapper">Activarea Ndiswrapper</a></li>
				<li><a href="internet-connecting-wpa-ro.htm#wpa">WIFI-WLAN</a></li>
				<li><a href="internet-connecting-ro.htm#internetsharing">Internet Sharing</a></li>
				<li><a href="internet-connecting-ro.htm#netcardconfig">Conectarea Online</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="sys-admin-apt-ro.htm">Administrarea Sistemului</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="sys-admin-apt-ro.htm#apt-cook">Ghid APT si Sources list</a></li>
				<li><a href="sys-admin-meta-ro.htm#meta-pack">Instalarea Meta-Pachetelor </a></li>
				<li><a href="sys-admin-apt-ro.htm#apt-install">Instalarea unui  pachet nou</a></li>
				<li><a href="sys-admin-apt-ro.htm#apt-delete">Stergerea unui pachet</a></li>
				<li><a href="sys-admin-apt-ro.htm#apt-upgrade">Upgrade-ul unui Sistem instalat</a></li>
				<li><a href="sys-admin-upgrade-ro.htm#live-cd-upgrade">Upgrade-ul folosind Live-CD</a></li>
				<li><a href="sys-admin-kern-upg-ro.htm#kern-upgrade">Upgrade-ul de kernel</a></li>
				<li><a href="sys-admin-rdiff-ro.htm#rdiff">Salvarile cu rdiff</a></li>
				<li><a href="sys-admin-rsync-ro.htm#rsync">Salvarile cu rsync</a></li>
				<li><a href="vir-rkits-ro.htm#virus-rkits">Scanerele AntiVirus si Rootkit </a></li>
				<li><a href="sys-admin-gen-ro.htm#start-services">Activarea serviciilor</a></li>
				<li><a href="sys-admin-gen-ro.htm#pw-lost">Parolele de root pierdute</a></li>
				<li><a href="sys-admin-gen-ro.htm#fonts">Fonturi </a></li>
				<li><a href="sys-admin-grub-bootman2-ro.htm#mbr-grub-boot">Suprascrierea sectorului de boot din MBR </a></li>
				<li><a href="sys-admin-grub-bootman2-ro.htm#boot-grub-floppy">Crearea unei dischete de Boot </a></li>
				<li><a href="sys-admin-grub-bootman2-ro.htm#remove-grub">Scoaterea programului grub din MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-ro.htm#what-is-grub">Managerul de boot Grub </a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="rdiff">
			<h2 id="top-header">Salvarile de Sistem cu rdiff-backup</h2>
				<p>rdiff-backup este o unealta folosita pentru a salva fisiere. (si poate rula pe o  varietate de porturi *nix ).<br />
				Situatia frumoasa in legatura cu sidux este ca puteti alege cum sa executati o mare varietate de procese , DIY (do it yourself) sau prin scripturi </p>

				<p><a href="http://techpatterns.com/forums/about831.html">Aceasta este versiunea scriptica de la h2</a></p>

			<h5>Ceea ce urmeaza este versiunea DIY </h5>

			<h6>rdiff-backup</h6>

				<p class="highlight-2">Rulati comenzile in  consola ca root , daca nu este specificat altcumva </p>

				<p>*foarte bun pentru recuperarea de dupa dist-upgrade sau kernel upgrade nereusite, etc (si deasemeni pentru a restaura fisiere individuale ) .<br />
				*salveaza doar ceea ce este schimbat ca si rsync  (deci fiecare backup nu dureaza mult ) .<br />
				*tine un jurnal al schimbarilor (ceea ce inseamna ca puteti restaura fisiere pe care le-ati sters acu` trei saptamani !) .<br />
				*face salvari in conditii de securitate din retea (folosind ssh).<br />
				*face salvarea unei partitii intregi in timp ce este montata (este usor sa programati o salvare automata...fara sa faceti de-montare ).<br />
				*poate restaura totul in cazul in care discul devine inutilizabil si trebuie sa cumparati altul .<br />
				*se autoconfigureaza pentru a salva o retea intreaga  (in linux este perfect , in windows un pic mai dificil) si este folosit in afaceri .<br />
				*este o aplicatie controlata din linia de comanda , foarte potrivita pentru cei care prefera sa faca backup automat  (cum ar fi un bash script  lansat prin intermediul cron).<br />
				*memoreaza si se descurca foarte bine cu apartenenta fisierelor si permisiunile acestora precum si cu link-urile simbolice (si toate lucrurile de acest gen) deci cand veti face restaurarea toate vor fi exact cum au fost inainte .</p>

			<h6>Ce veti avea nevoie</h6>
				<p>rdiff-backup tine o copie completa (necompresata) a fisierelor pe care le salvati , deasemeni tine un jurnal a ceea ce este salvat (incremental backups) , asta inseamna ca spatiul pe care se salveaza va fi mai mare decat ceea ce este salvat . Daca salvati 100 giga de spatiu este posibil sa aveti nevoie de 120 giga pentru a salva ( si de preferat pe un hard separat !) .</p>

			<h6>Setarile care trebuiesc facute</h6>
				<p>Sa spunem ca PC-ul dumneavoastra are urmatoarele :<br />
				* un hard de 100 giga ce este folosit (hda) , cu partitia hda1 ca partitie root , partitia hda5 pentru a stoca muzica si alte fisiere si partitia hda6 ca swap .<br />
				* un disc nefolosit de 200 giga (hdb) cu partitia hdb1 ... si pe care o vom folosi pentru salvarile noastre .<br />
				* adresa IP  192.168.0.1</p>

				<p>Primul lucru ce trebuie facut este sa instalam rdiff-backup :</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<p>Acum veti putea sa salvati orice director , dar aici presupunem ca salvam o intreaga partitie ...vom salva partitiile hda1 si hda5 (nu si hda6 ) iar pentru aceasta vom crea niste directori in care vom stoca datele :</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/root
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Trebuie ca adresa IP sa fie specificata exact pentru ca se poate salva si o partitie din alt calculator , iar la restaurare sa stie pe care calculator sa o faca (vom vedea mai departe).</p>

			<h6>Salvarea</h6>

				<p>rdiff-backup foloseste sintaxa <span class="highlight-3">rdiff-backup source-dir dest-dir</span>. Nota : intotdeauna specificati numele directorului , nu numele fisierelor .</p>

				<p>Pentru a face salvarea partitiei hda5 , rulati :</p>
<pre>
# rdiff-backup /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Iar pentru a salva partitia root , rulati :</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' /media/hdb1/rdiff-backups/192.168.0.1/root
</pre>
				<p>Orice eroare de genul "AF_UNIX path too long" poate fi ignorata . Aceasta va dura ceva timp de vreme ce este prima oara cand partitia e salvata si deci rdiff-backup va trebui sa o scrie in intregime (si nu numai diferentele ) . Observati ca nu salvam  /tmp deoarece acesta mereu se schimba , si nici  /proc sau  /sys din cauza ca acestea nu contin fisiere reale , si deasemeni nu vom salva punctele de montare . Daca am face salvarea punctului de montare am salva de fapt hdb1, si am intra intr-o bucla infinita ! O alta cale este sa salvati punctele de montare separat .</p>

				<p>Acum , motivul pentru care se foloseste  '/proc/*' in loc de  '/proc' este ca astfel ar fi salvat doar numele de director  /proc , si ar fi ignorat tot ceea ce este in interiorul acestuia . La fel este valabil si pentru /tmp, /sys , si chiar pentru punctele de montare .</p>

				 <p>In acest fel , daca va veti distruge partitia root si veti apela la o restaurare completa numele directorilor  /tmp ,  /proc ,  /sys si numele punctelor de montare vor fi create (asa cum ar trebui). Daca /tmp nu exista cand X porneste  vi se va semnaliza .( Gasiti mai multe in manpage pentru  --exclude si  --include).</p>

			<h6>Restaurarea directorilor din salvarile prealabile</h6>

				<p>rdiff-backup foloseste sintaxa :</p>
<pre>
rdiff-backup -r &lt;from-when&gt; &lt;source-dir&gt; &lt;dest-dir&gt;
</pre>
				<p>Daca din greseala ati sters directorul  /media/hda5/photos , il puteti restaura executand :</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5/photos /media/hda5/photos
</pre>
				<p>Optiunea  "-r now" inseamna restaurarea din ultima salvare facuta . Daca ati facut salvari periodice  (via crontab, sa spunem), si nu v-ati dat seama ca acel director cu fotografii lipseste pana acum cateva zile veti avea nevoie de o restaurare dintr-o salvare facuta acum cateva zile (si nu  "now", pentru ca in ultima salvare facuta probabil acel director nu exista). Sau poate ca vreti pur si simplu sa ajungeti inapoi la o anumita versiune a unui program ,ceva .</p>

				<p>Daca doriti sa restaurati la starea de acum trei zile folositi optiunea  "-r 3D" ... dar , asa cum este mentionat si in manpages , retineti :</p>

				<p class="highlight-1">"3D" se refera la exact 72 ore inainte de momentul prezent , si daca nu exista nici o salvare facuta la acel moment , rdiff-backup va restaura starea salvata anterior acestui moment . Ca in cazul de mai sus , de exemplu , daca  "3D" este folosit , si exista salvari facute cu 2 si cu  4 zile in urma , acel director va fi restaurat asa cum era el cu 4 zile in urma (deci va trebui sa va ganditi bine inainte de a face restaurarea).</p>

				<p>Folosind urmatoarele comenzi veti primi o lista cu data si ora la care au fost facute toate salvarile pentru hda5 :</p>
<pre>
# rdiff-backup -l /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
			<h5>Restaurarea partitiilor</h5>

				<p>Puteti deasemeni restaura partitii intregi (puncte de montare) , pana la urma un punct de montare este tot un director .</p>

				<p class="highlight-2">ATENTIE : Nu incercati sa restaurati partitia root atat timp cat lucrati de pe ea ! Cu o singura comanda puteti pierde toate fisierele de pe toate partitiile , inclusiv salvarile de pe un disc separat !! rdiff-backup face exact ce-i spuneti sa faca ... daca salvarea pentru partitia root are puncte de montare goale , programul  va sterge orice exista in punctul de montare pentru a face sa fie conform salvarii existente .</p>

				<p>Pentru a restaura hda5 din ultima salvare vom executa :</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5 /media/hda5
</pre>
			<h5>Restaurarea partitiei root</h5>

				<p>Pentru a restaura partitia root nu este la fel de simplu . Nu restaurati niciodata partitia root atat timp cat este montata (cititi avertismentul de mai sus). Este foarte util sa poti restaura partitia root , mai ales dupa o incercare nereusita de upgrade sau de instalare a unui nou kernel (etc) ; veti fi linistit stiind ca puteti intoarce lucrurile asa cum au fost si toate acestea in doar 20 minute .</p>

				<p>O cale de a restaura partitia root este sa bootati intr-o partitie linux neocupata , daca aveti una in computer . De acolo veti putea restaura partitia dorita , daca nu este montata ca root . Dupa ce restaurati partitia puteti porni de pe ea si veti vedea ca este exact ca inainte ...exact ! Aceasta nu este nicidecum cea mai usoara metoda .</p>

				<p>O alta cale de a restaura partitia root este sa porniti cu sidux live-cd si sa faceti restaurarea de acolo. rdiff-backup este inclus in sidux.  In cazul in care versiunea sidux live-cd pe care o aveti nu include si rdiff, puteti folosi la linia de comanda grub (Bootoptions, (Cheatcodes)) codul "unionfs" iar asta va insemna ca veti putea instala programe noi cat timp rulati de pe live cd . Doar porniti si lansati urmatoarele comenzi :</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h6>Acum vom face restaurarea :</h6>
<pre>
# mount /dev/hda1 /media/hda1
# mount /dev/hdb1 /media/hdb1
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Nota : In cazul in care aveti un Live-CD care suporta klik puteti instala rdiff-backup folosind Klik si ruland :</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Este recomandat ca toti cei care fac salvarea partitiei root (cu intentia de a o restaura la nevoie ) sa faca un test al procesului de restaurare . Nimic nu este mai neplacut decat sa te gandesti ca totul va fi in regula dupa restaurare si aceasta sa nu reuseasca din cauza a ceva neasteptat  cand ai mai mare nevoie .</p>

			<h5>Salvarea partitiilor din alte computere </h5>

				<p>Puteti sa salvati partitiile altor computere in computerul local atata vreme cat va puteti conecta ssh la acele computere (si aveti destul spatiu pe hard disc). Serverul ssh (sshd) trebuie sa ruleze pe computerul comandat . Acesta nu trebuie sa fie neaparat in reteaua locala , poate fi oriunde in lume .</p>

				<p>Sa presupunem ca PC-ul comandat are urmatoarele :<br />
				1) un hard de 100 giga (hda) in uz , cu urmatoarele,<br />
				2) hda1 ca partitie root ,<br />
				3) hda5 unde sunt stocate niste fisiere temporare si pe care nu dorim sa le salvam ,<br />
				4) si hda6 ca partitie swap si adresa IP  192.168.0.2</p>

				<p>Nota : doua discuri de 100 giga de obicei nu pot fi salvate pe un disc de 200 giga folosind rdiff-backup (pentru ca nu va mai fi loc si pentru fisierele incrementale ), dar pentru ca nu salvati si partitia hda5 de pe computerul comandat (si pentru ca de obicei discurile nu sunt 100% pline , dar nu va bazati pe asta) va trebui intotdeauna sa calculati daca aveti destul spatiu pentru backup .De fiecare data cand rdiff-backup face o alta salvare , el va crea inca un fisier incremental , si acesta va ocupa din ce in ce mai mult spatiu .</p>

				<p>Puteti specifica programului rdiff-backup sa pastreze salvarile doar din ultima luna (aceasta comanda va fi detaliata mai tarziu), si aceasta va ocupa mai putin spatiu decat salvarile unui an intreg . Bineinteles ,daca veti dori sa pastrati salvarile de pe parcursul intregului an veti avea nevoie de spatiu pe hard corespunzator marimii fisierelor incrementale facute de-a lungul intregului an .</p>

				<p>Va trebui mai intai sa instalati rdiff-backup pe computerul comandat  (oricarui computer caruia doriti sa-i faceti salvari ,inclusiv server backup ,trebuie sa aiba rdiff-backup instalat ).</p>

				<p>Pentru a salva datele din computerul comandat in calculatorul local rulati in computerul local (cu adresa ,sa zicem 192.168.0.1) : <span class="highlight-4">Fiti atenti la folosirea de doua ori a semnului doua puncte  :: </span></p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/ /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>
				<p>Acum daca doriti sa restaurati un director in computerul comandat puteti initia restaurarea atat din computerul local cat si din cel comandat .</p>

				<p>In exemplul urmator veti restaura fisierul /usr/local/games in computerul comandat , initializand restaurarea tot din computerul comandat :</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<p>In exemplul ce urmeaza veti restaura directorul  /usr/local/games in computerul comandat , initializand restaurarea din computerul local :</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<p>Folositi cam aceasi sintaxa cand restaurati partitia root de pe un live cd (cand computerul comandat a fost pornit de pe live cd ...vedeti mai sus).</p>

			<h5>Salvarile automate :</h5>

				<p>Daca vreti sa salvati partitiile  altor computere in computerul local primul lucru ce trebuie facut este sa activati logarea ssh fara parola folosind ssh keys . <span class="highlight-2">Retineti ca acum vorbim despre logarea ssh ca root fara parola . Acest lucru poate fi restrictionat in asa fel incat numai comenzile rdiff-backup  sa fie executate , dar prezentarea acestei sectiuni este in afara subiectului nostru deocamdata . Adresati-va la <a href="samba-ro.htm#ssh-s">Configurarea SSH </a> </span> . Vom presupune ca suntem in deplina siguranta , si vom seta cel mai simplu mod de conectare ssh fara parola .</p>

				<p>De pe PC-ul local executati urmatoarele :</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<p>Si apasati enter de doua ori pentru nicio parola . Apoi faceti :</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<p>Vi se va cere parola de root .</p>

				<p>Acum puteti loga ssh in computerul comandat fara sa mai trebuiasca sa tastati parola si se poate executa rdiff-backup in mod automat .</p>

				<p>Mai departe creati un script bash care sa contina toate comenzile rdiff-backup . Acest script va arata cam asa :</p>


<pre>
#!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Backing up 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*'\
 --exclude '/sys/*' --exclude '/media/*/*'\
 / /media/hdb1/rdiff-backups/192.168.0.1/root
echo "(and purge increments older than 1 month)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Backing up 192.168.0.1 mount hda5======="
${RDIFF} --ssh-no-compression --exclude /media/hda5/myjunk /media/hda5\
 /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo
echo "=======Backing up 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*'\
 --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*'\
 192.168.0.2::/ /media/hdb1/rdiff-backups/192.168.0.2/root
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M
 --force /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>


				<p>Numiti acest script "myrdiff-backups.bash" si salvati-l in /usr/local/bin din computerul local (serverul de backup) si schimbati-l intr-un executabil . Rulati scriptul si asigurati-va ca functioneaza .</p>

				<p>In final puteti seta cron sa lanseze scriptul in fiecare seara la 8pm . Urmatoarea linie in root's crontab va face totul , deschideti</p>
<pre>
# crontab -e
and insert the following line
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

			<div id="rev">Page last revised 06/05/2007 0900 UTC</div>
</div>
</div>
</body>
</html>
