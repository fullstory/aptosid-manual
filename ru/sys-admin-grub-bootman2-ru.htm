<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="ru">
<head>
	<title>Руководство sidux - grub-ru</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" /><style type="text/css" media="all">@import url("../lib/css-js/content.css");</style><style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style><style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" /><script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<!-- Last translation revision by RoEn 14/03/2008 2142 UTC -->
<div id="menu"> <!-- menu starts here ru language maintained by RoEn -->
<!--Welcome to the  sidux-manual Operating System Manual version-01.73.2008.02.25 -->
<!-- menu last updated by RoEn 09/03/2008 1610 hrs UTC -->
<a href="http://sidux.com/"><img src="../lib/logos/sidux-logo.png" title="Главная страница sidux.com, форума и вики" alt="sidux.com logo" id="menu-header" /></a>
	<ul id="top-list">
		<li><a href="wel-quickstart-ru.htm#welcome-quick">Краткое руководство sidux</a></li>
		<li><a href="http://manual.sidux.com/meta-manual">Мета-пакеты sidux</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-language-64.png" title="Выбор языка - Choose another language" alt="Переключение языка" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-ru.htm">Руководство sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-ru.htm#welcome-gen">Добро пожаловать!</a></li>
				<li><a href="welcome-ru.htm#how-to">Об использовании</a></li>
				<li><a href="welcome-ru.htm#table-contents">Содержание</a></li>
				<li><a href="help-ru.htm#help-gen">Где получить помощь</a></li>
				<li><a href="help-ru.htm#paste">IRC !paste</a></li>
				<li><a href="credits-ru.htm#cred-team">Благодарности</a></li>
				<li><a href="wel-quickstart-ru.htm#welcome-quick">Краткое руководство sidux</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-ru.htm">Содержание диска</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-ru.htm#cd-content">Содержание LiveCD</a></li>
		</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="cd-dl-burning-ru.htm">Получение ISO-образа</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="cd-dl-burning-ru.htm#download-sidux">Скачание ISO-образа и список зеркал</a></li>
				<li><a href="cd-dl-burning-ru.htm#md5">Проверка ISO-образа с md5</a></li>
				<li><a href="cd-dl-burning-ru.htm#burn-nero">Запись ISO-образа в Windows</a></li>
				<li><a href="cd-dl-burning-ru.htm#burn-linux">Запись ISO-образа в Linux</a></li>
				<li><a href="cd-dl-burning-ru.htm#xdelta">Xdelta патчи</a></li>
				<li><a href="cd-no-gui-burn-ru.htm#burning-no-gui">Запись ISO-образа в консоли</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-ru.htm">Режим LiveCD</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-ru.htm#rootpw">Пароль root</a></li>
				<li><a href="live-mode-ru.htm#live-cd-installsoft">LiveCD: установка ПО</a></li>
				<li><a href="live-mode-ru.htm#ntfs-3g">Запись на раздел NTFS: ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="term-konsole-ru.htm">Терминал и оболочка</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="term-konsole-ru.htm#sux"> Команда: sux</a></li>
				<li><a href="term-konsole-ru.htm#term-kon">Терминал и оболочка</a></li>
				<li><a href="term-konsole-ru.htm#cli-help">Помощь в терминале</a></li>
				<li><a href="term-konsole-ru.htm#term-cmds">Команды в терминале</a></li>
				<li><a href="term-konsole-ru.htm#shell-scripts">"Скрипт scripts.sh"</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cheatcodes-ru.htm">Чит-коды</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cheatcodes-ru.htm#cheatcodes">Особые для sidux LiveCD чит-коды</a></li>
				<li><a href="cheatcodes-ru.htm#cheatcodes-linux">Общие для Linux чит-коды</a></li>
				<li><a href="cheatcodes-vga-ru.htm#vga">VGA коды</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="part-gparted-ru.htm">Разметка диска</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="part-gparted-ru.htm#partition">Разметка диска: GParted</a></li>
				<li><a href="part-gparted-ru.htm#ntfs">Разделы NTFS: GParted</a></li>
				<li><a href="part-uuid-ru.htm#uuid">Актуализация, UUID и метки раздела: fstab </a></li>
				<li><a href="part-cfdisk-ru.htm#disknames">Имена жестких дисков</a></li>
				<li><a href="part-cfdisk-ru.htm#partition">Разметка диска: cfdisk</a></li>
				<li><a href="part-cfdisk-ru.htm#formating">Форматирование разделов</a></li>
				<li><a href="part-size-examp-ru.htm#part-example">Примеры разметки диска</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-ru.htm">Установка sidux</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-ru.htm#Inst-prep">Подготовка</a></li>
				<li><a href="hd-install-ru.htm#Installation">Инсталляция на HD</a></li>
				<li><a href="hd-install-ru.htm#first-hd-boot">Первая загрузка</a></li>
				<li><a href="hd-install-opts-ru.htm#fromiso">Инсталляция 'fromiso'</a></li>
				<li><a href="hd-install-opts-ru.htm#fromiso-persist">Способы 'fromiso' и 'persist'</a></li>
				<li><a href="hd-install-opts-ru.htm#usb-hd">Инсталяция на  USB-HD</a></li>
				<li><a href="hd-install-opts-ru.htm#vtbox">Инсталляция в VirtualBox</a></li>
				<li><a href="hd-install-opts-ru.htm#qemu">Инсталляция в QEMU</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-ru.htm">Оборудование</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="hw-dev-hw-dri-ru.htm#hd-ntfs3g">Запись на раздел NTFS</a></li>
				<li><a href="hw-dev-mon-ru.htm#mon-res">Разрешение экрана и мониторы</a></li>
				<li><a href="hw-dev-mon-ru.htm#xrandr">Двойные экраны и xrandr</a></li>
				<li><a href="hw-dev-mon-ru.htm#mon-binary">Двойные экраны (изпользуя двоичные файлы)</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#non-free-3d">Драйверы от NVIDIA и ATI</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#native-nv-ati">Свободные драйверы от xorg</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#non-free">Другие проприетарные драйверы</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="wm-kde-ru.htm">Оконный менеджер</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="wm-kde-ru.htm#desk-freeze">"КДЕ зависает"</a></li>
				<li><a href="wm-kde-ru.htm#kde-login">Проблемы входа в KDE</a></li>
				<li><a href="wm-kde-ru.htm#ch-th">Управление темами</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="lamp-apache-ru.htm">Мета-пакет LAMP</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="lamp-apache-ru.htm#serv-apache">Что такое LAMP</a></li>
				<li><a href="lamp-apache-ru.htm#serv-ftp">Клиенты FTP</a></li>
				<li><a href="lamp-apache-ru.htm#serv-sec">Защищенные протоколы</a></li>
				<li><a href="lamp-apache-ru.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-ru.htm#serv-mysql">Установка MySQL</a></li>
				<li><a href="lamp-ppp-ru.htm#serv-php">PHP и Apache</a></li>
				<li><a href="ntp-server-ru.htm#ntp-server">Сервер времени</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="internet-connecting-ru.htm">Интернет и локальная сеть</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="tor-privoxy-ru.htm#tor">Маршрутизатор Tor</a></li>
				<li><a href="tor-privoxy-ru.htm#privoxy"> Веб-прокси Privoxy</a></li>
				<li><a href="internet-connecting-ru.htm#firewalls">Брандмауэры</a></li>
				<li><a href="samba-ru.htm#configure">Интеграции в сеть Windows</a></li>
				<li><a href="samba-ru.htm#setup">Сервер Samba</a></li>
				<li><a href="ssh-ru.htm#ssh-fs">Удаленное монтирование: SSH</a></li>
				<li><a href="ssh-ru.htm#ssh-x">Приложения X-Windows: SSH</a></li>
				<li><a href="ssh-ru.htm#ssh-f">SSH и Konqueror</a></li>
				<li><a href="ssh-ru.htm#ssh-w">SSH X-Forwarding</a></li>
				<li><a href="ssh-ru.htm#ssh">Безопасность SSH</a></li>
				<li><a href="internet-connecting-ru.htm#dial-mod">56кбит-модемы</a></li>
				<li><a href="internet-connecting-ndis-ru.htm#ndiswrapper-basic">Использование Ndiswrapper</a></li>
				<li><a href="internet-connecting-ndis-ru.htm#ndiswrapper-advanced">Использование Ndiswrapper - допол.</a></li>
				<li><a href="internet-connecting-wpa-ru.htm#wpa">Wi-Fi-WLAN</a></li>
				<li><a href="internet-connecting-ru.htm#netcardconfig">Подключение - Ceni</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-apt-ru.htm">Управление пакетами</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="sys-admin-apt-ru.htm#apt-cook">APT и репозитории</a></li>
				<li><a href="sys-admin-meta-ru.htm#meta-pack">Мета-пакеты</a></li>
				<li><a href="sys-admin-meta-ru.htm#meta-proxy">Мета-инсталлятор и прокси</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-install">Установка</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-delete">Удаление</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-downgrade">Понижение hold версии</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-cache">Поиск информации о пакете</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-kio">Поиск информации о пакете kio-apt</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-upgrade">Обновление -  dist-upgrade</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="smxi-ru.htm">Системное администрирование</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="smxi-ru.htm#smxi">Описание и опции команды smxi</a></li>
				<li><a href="siduxcc-ru.htm#siduxcc">sidux Центр управления</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-upgrade">Обновление -  dist-upgrade</a></li>
				<li><a href="sys-admin-upgrade-ru.htm#live-cd-upgrade">Обновление с LiveCD</a></li>
				<li><a href="sys-admin-kern-upg-ru.htm#kern-upgrade">Обновление ядра</a></li>
				<li><a href="sys-admin-rdiff-ru.htm#rdiff">Резервирование: rdiff</a></li>
				<li><a href="sys-admin-rsync-ru.htm#rsync">Резервирование: rsync</a></li>
				<li><a href="vir-rkits-ru.htm#virus-rkits">Сканер безопасности</a></li>
				<li><a href="sys-admin-gen-ru.htm#start-services">Выбор служб</a></li>
				<li><a href="sys-admin-gen-ru.htm#pw-lost">Восстановление root-пароля</a></li>
				<li><a href="sys-admin-gen-ru.htm#fonts">Шрифты</a></li>
				<li><a href="sys-admin-gen-ru.htm#cups">CUPS</a></li>
				<li><a href="sys-admin-gen-ru.htm#init">sidux режимы загрузки - init</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#mbr-grub-boot">Восстановление MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#dual-boot">Мультизагрузка</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#boot-grub-floppy">Загрузочная дискета</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#remove-grub">Удаление GRUB из MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#what-is-grub">Менеджер загрузки GRUB</a></li>
			</ul>
		</li>
	</ul>
	<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="mbr-grub-boot">
					<h2 id="top-header">Обновление Grub</h2>
						<p>Если Grub только надо обновлять в MBR (с более новой версией), эта команда вводится:</p> 
<pre>
/usr/sbin/grub-install --recheck --no-floppy /dev/sda
</pre>
						<p>Защитный опрос может возникать, чтобы эта команда повторялась.</p>


		<h2>Windows переписал мой загрузочный сектор.</h2>

							<p>Чтобы перезаписывать Grub к MBR и/или восстановить Grub вообще, сначала Вы должны загрузить <span class="highlight-3">sidux Live-CD</span> :</p>
						<ol>
							<li>Чтобы идентифицировать, какие разделы имеются на диске (например [h,s]d[a..]X)), нуждаются в привилегиях root, которые получают таким образом (#):
<pre>
$ sux
</pre>
							</li>
							<li>Чтобы получить правильные названия разделений, вводится: 
            <pre>
fdisk -l
cat /etc/fstab
</pre>
							
							</li>							
							<li>После того Вы oпределили правильное разделение, создается пункт монтирования:
<pre>
mkdir -p /media/[hdxx,sdxx,diskx]
</pre>				
							</li>
							<li>Смонтируется с:
<pre>
mount /dev/xdxx /media/xdxx
</pre>
							</li>

							<li>Сейчас переписывается Grub в MBR первого жёсткого диска (типично):
<pre>
/usr/sbin/grub-install --recheck --no-floppy --root-directory=/media/xdxx /dev/sda
</pre>
							</li>
						</ol>

					<h6>Пример</h6>
<pre>
root@sidux:/home/sidux# fdisk -l
# fdisk -l
Disk /dev/sda: 115.9 GB, 115989736960 bytes
255 heads, 63 sectors/track, 14101 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x40444044
   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1        3673    29503341    7  HPFS/NTFS
/dev/sda2            3674       14101    83762910    5  Extended
/dev/sda5            3674        7239    28641784+  83  Linux
/dev/sda6            7239       10842    28934104+  83  Linux
/dev/sda7           10843       14101    26177886    b  W95 FAT32
Disk /dev/sdb: 120.0 GB, 120034123776 bytes
255 heads, 63 sectors/track, 14593 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0xa41e667f
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1               1        3574    28708123+  83  Linux
/dev/sdb2            3575        7247    29503372+  83  Linux
/dev/sdb3            7248       10845    28900935   83  Linux
/dev/sdb4           10846       14593    30105810    5  Extended
/dev/sdb5   *       10846       14338    28057491   83  Linux
/dev/sdb6           14339       14593     2048256   82  Linux swap / Solaris
Disk /dev/sdc: 250.0 GB, 250059350016 bytes
255 heads, 63 sectors/track, 30401 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x00077541
   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1               1       30401   244196001   83  Linux
Disk /dev/sdd: 250.0 GB, 250059350016 bytes
255 heads, 63 sectors/track, 30401 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x1c01ad92
   Device Boot      Start         End      Blocks   Id  System
/dev/sdd1               1       30401   244196001   83  Linux

root@sidux:/home/sidux# cat /etc/fstab
# /etc/fstab - static information about the filesystems - fstab(5)
#
# /etc/fstab is only read by programs, and not written; it is the duty of the
# system administrator to properly maintain this file.
#
# Instead  of giving the device explicitly, one may indicate the filesystem
# that is to be mounted by its UUID or VOLUME label. This will make the
# system more robust: adding or removing a disk changes the disk device name
# but not the filesystem UUID or VOLUME label.

# automatically added, ST3120026A-3LJ093B4-part1
/dev/sda1       /media/disk0    ntfs    noauto,users,exec,ro,dmask=0022,fmask=0133      0       0

# automatically added, ST3120026A-3LJ093B4-part5
/dev/sda5       /media/disk1    jfs     noauto,users,exec,noatime       0       2

# automatically added, ST3120026A-3LJ093B4-part6
/dev/sda6       /media/disk2    reiserfs        noauto,users,exec,noatime       0       2

# automatically added, ST3120026A-3LJ093B4-part7
/dev/sda7       /media/disk3    vfat    noauto,users,exec,shortname=lower,quiet,umask=000       0       0

# automatically added, ST3120026A-3LJ09RBF-part1
/dev/sdb1       /media/disk4    reiserfs        noauto,users,exec,noatime       0       2

# automatically added, ST3120026A-3LJ09RBF-part2
/dev/sdb2       /media/disk5    ext3    noauto,users,exec,noatime       0       2

# automatically added, ST3120026A-3LJ09RBF-part3
/dev/sdb3       /media/disk6    reiserfs        noauto,users,exec,noatime       0       2

# automatically added, ST3120026A-3LJ09RBF-part5
/dev/sdb5       /media/disk7    ext3    noauto,users,exec,noatime       0       2

# automatically added, ST3120026A-3LJ09RBF-part6
/dev/sdb6       none    swap    sw      0       0

# automatically added, ST3250824AS-4ND1V199-part1
/dev/sdc1       /media/disk9    ext3    noauto,users,exec,noatime       0       2

# automatically added, ST3250620AS-9QE13XVF-part1
/dev/sdd1       /media/disk10   ext3    noauto,users,exec,noatime       0       2

# automatically added, _NEC_DVD_RW_ND-4550A
/dev/cdrom      /media/cdrom    udf,iso9660     user,noauto     0       0

# automatically added, ASUS_DVD-ROM_DVD-E616P_0104
/dev/cdrom1     /media/cdrom1   udf,iso9660     user,noauto     0       0

# automatically added
/dev/fd0        /media/fd0      auto    rw,user,noauto  0       0

# temporary filesystem in virtual memory
#tmpfs  /tmp    tmpfs   defaults        0       0
</pre>
					<p>Таким образом /dev/sdb1 является разделом root и MBR находится на sda. Grub восстанавливается с этими 3 командами:</p>
<pre>
mkdir -p /media/sdb1
mount /dev/sdb1 /media/sdb1
/usr/sbin/grub-install --recheck --no-floppy --root-directory=/media/sdb1 /dev/sda
</pre>

	
	</div>

	<div class="divider" id="boot-grub-floppy">
		<h2>Создание загрузочной дискеты</h2>

							<p>Скачайте из интернета <a href="http://sidux.com/files/misc/grubboot.zip">имидж дискет с grub</a> (ca. 580 Кб). На дискете также установленны функционирующая версия FreeDOS и редактор. Если удалить защиту, то можно редактировать menu.lst на самой дискете. Содержание этого файла можно изменять по желанию.</p>

							<p>Другой возможностью создания загрузочной дискеты является использование программы с <a href="http://www.ultimatebootcd.com/">UBCD (Ultimate Boot Disk CD)</a></p>
			
						<h5>Потребуется осуществить следующие шаги:</h5>

							<p>1. Форматирование дискеты</p>
<pre>
# fdformat /dev/fd0
Double-sided, 80 tracks, 18 sec/track. Total capacity 1440 kB.
Formatting ... done
Verifying ... done
</pre>
							<p>2. Создание файловой ситемы на дискете (желательно ext2, minix(fs) или vfat)</p>
<pre>
# mkfs -t minix /dev/fd0
480 inodes
1440 blocks
Firstdatazone=19 (19)
Zonesize=1024
Maxsize=268966912
</pre>
							<p>3. Смонтировать дискету</p>
<pre>
# mount -t minix /dev/fd0 /mnt
</pre>
							<p>4. Запустить скрипт grub-install</p>
<pre>
# grub-install --recheck --root-directory=/mnt /dev/fd0
Probing devices to guess BIOS drives. This may take a long time.
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Unknown partition table signature
Due to a bug in xfs_freeze, the following command might produce a segmentation
fault when /mnt/boot/grub is not in an XFS filesystem. This error is harmless and
can be ignored.
xfs_freeze: specified file ["/mnt/boot/grub"] is not on an XFS filesystem
Unknown partition table signature
Installation finished. No error reported.
This is the contents of the device map /mnt/boot/grub/device.map.
Check if this is correct or not. If any of the lines is incorrect,
fix it and re-run the script `grub-install'.
 
(fd0)   /dev/fd0
(hd0)   /dev/sda
</pre>
							<p>5. Последние шаги:</p>
<pre>
# sed "s|^gfxmenu.*|gfxmenu\ \\(fd0\\)\\/boot\\/message|" /boot/grub/menu.lst > /mnt/boot/grub/menu.lst
# cp -L /boot/message /mnt/boot/
# umount /mnt
</pre>
					
	</div>
	<div class="divider" id="remove-grub">
		<h2>Удаление grub с загрузочного сектора</h2>

		<p>Введите как root (суперпользователь)</p>
		<pre>lilo -M /dev/hda -s /dev/null</pre>

		<p>в консоли.</p>
	</div>
	<div class="divider" id="what-is-grub">
		<h2>Менеджер загрузки grub</h2>
<pre>
<span class="highlight-3">Примечание: Grub для ядер 2.6.22 и выше использует sdax
и требует изаменить строку
initrd (hd0,x)/sidux/miniroot.gz
на:
initrd		/boot/initrd.img-2.6.xx.x-slh-smp-x</span>
</pre>
		<h3>Введение</h3>

		<p>grub - это менеджер загрузки, который может загружать операционные системы с различных разделов. grub не зависит от блочных списков (blocklists), используемых для поиска файлов, необходимых для запуска системы. Менеджер загрузки поддерживает большое число файловых систем: ext2?, ext3?, reiserfs... (Linux), Fat32, Fat16 (Windows), UFS (BSD), Minix и многие другие.</p>

		<p>grub использует расширения BIOS (таким образом может загружать системы с разделов, расположенных даллее 8 Гб) и не имеет ограничения на 1024 цилиндра. Для Grub не имеет значения, где находится физически ядро загружаемой ОС, ему достаточно знать раздел и путь к файлам ядра (или их символическим ссылкам). После изменения конфигурации (т.е файла menu.lst) нет необходимости в вызове программы (как в случае с lilo) - новые настройки будут автоматически восприняты при следующей загрузке.</p>

                <p>sidux использует Grub при загрузке компьютера с LiveCD. Как стандартный загрузчик при работе с жесткого диска используется также grub. Однако grub ,без каких-либо проблем, может быть установлен и позже. Для установки grub в MBR необходимo из оболочки с правами root выполнить команду:</p>

		<pre>grub-install --root-directory=/media/hdaX /dev/hdY</pre>

		<p>/media/hdaX -  это раздел, смонтированный с правами на запись, на котором в директории <i>/boot/grub</i> будут размещены файлы (stage2, stage1_5xxx).<br /> Файл конфигурации menu.lst должен находиться в этой директории. /dev/hdY - это диск в MBR которого должен быть записан код запуска, обычно это /dev/hda.</p>

		<h3>Обозначения дисков и имена устройств</h3>

							<p><span class="highlight-2">Please Note: </span><span class="highlight-3">hda</span> is in the process of being depreciated, therefore you need to start substituting <span class="highlight-3">hda </span>with <span class="highlight-3">sda</span> for kernels 2.6.22 and onward.</p>

		<p>grub не делает различия между SCSI-и IDE жесткими дисками. (hd0) - всегда первый жесткий диск, который является первым в последовательности загрузки устанавливающейся в BIOS), независимо от того является ли он IDE или SCSI. Несколько необычен метод нумерации разделов, принятый в grub: первый раздел на первом жестком диске обозначается как (hd0,0). Первичные разделы нумеруются от 0 до 3, а логические разделы от 4 и далее.</p>

		<table>
			<tbody>
				<tr>
					<th><b>Grub</b></th>
					<th><b>Linux</b></th>
					<th><b>Label</b></th>
				</tr>
				<tr>
					<td>(fd0)</td>
					<td>/dev/fd0</td>
					<td>дискета (под Windows)</td>
				</tr>
				<tr>
					<td>(hda0)</td>
					<td>/dev/hda</td>
					<td>первый жёсткый диск</td>	
				</tr>
				<tr>
					<td>(hd0,0)</td>
					<td>/dev/hda1</td>
					<td>первое разделение на первом жёстком диске</td>	
				</tr>
				<tr>
					<td>(hd0,5)</td>
					<td>/dev/hda6</td>
					<td>разширенное разделение на первом жёстком диске auf hd 1</td>	
				</tr>
			</tbody>
		</table>
	<div class="spacer05"></div>
		<p>Все обозначения устройств в grub берутся в скобки ( ). Тем не менее, следует обратить внимание на запись параметров, передаваемых ядру. В противоположность grub параметры ядра должны быть записаны в обычном для Linux виде. В следующем примере обе записи указывают на один и тот же раздел, а именно на четвертый раздел первого диска. Первая запись в стиле grub, а вторая в виде, типичном для Linux:</p>

<pre>
root (hd0,3)
kernel          /boot/vmlinuz root=UUID=bf955abf-ce1f-45a3-9ee5-93b5c5dc4fe0 ro quiet vga=791
initrd          /boot/initrd.img
</pre>

		<h3>Командный режим (grub-shell)</h3>

		<p>Одним из особенно приятных свойств grub является наличие командного режима. Для входа в этот режим необходимо нажать клавишу "<b>c</b>" чтобы запустить оболочку grub. В этом режиме имеется возможность, даже при наличии испорченного файла menu.lst, находить и загружать различные системы и файлы (например ядро).</p>

		<p>Для того, чтобы иметь возможность немного попрактиковаться можно при загруженном sidux запустить grub из оболочки root с помощью команды <span># grub</span>. В командном режиме grub можно получить справку о всех доступных командах. Для этого нужно выполнить инструкцию "<b>help</b>". Подробную информацию о каждой команде можно получить выполнив "<b>help &lt;команда&gt;</b>". Выйти из командного режима grub можно с помощью инструкции <b>quit</b>". Большой помощью является тот факт, что в оболочке grub клавиша табуляции (Tab) работает так же как и в оболочке Linux, т.е. команды, имена дисков, разделов и файлов могут быть автоматически дополнены ее нажатием.</p>

		<p>grub дает возможность определить и наити даже перед началом загрузки местонахождение ядра и файл initrd, по команде <b>find</b>", например grub выдает при</p>
		<pre>find /boot/vmlinuz</pre>

		<p>список разделов, на которых в директории <i>/boot</i> находится файл ядра <i>vmlinuz</i>:</p>
		<pre>(hd0,3) (hd1,0)</pre>

		<p>С помощью команды "<b>geometry</b>" можно выяснить параметры интересующего раздела. Например на запрос:</p>
		<pre>geometry (hd0)</pre>

		<p>показывается следующее:</p>
		<pre>"drive 0x80: C/H/S = 3648/255/63, The number of sectors = 58605120, /dev/hda Partition num: 0,
		Filesystem type is fat, partition type 0xb Partition num: 1,
		Filesystem type is fat, partition type 0xb Partition num: 2,
		Filesystem type is fat, partition type 0xc Partition num: 4,
		Filesystem type is ext2fs, partition type 0x83 Partition num: 5,
		Filesystem type unknown, partition type 0x82 Partition num: 6,
		Filesystem type is fat, partition type 0xb"
		</pre>
		<p>После того как ядро и, возможно, имеющийся <i>initrd</i> (или <i>miniroot.gz</i>) найдены, можно начать загрузку командой <b>boot</b>.</p>


		<h3>Режим редактирования</h3>

		<p>Этот режим позволяет изменять пункты в <i>menu.lst</i> в процессе загрузки. Эта возможность существует даже тогда, когда grub загружается с LiveCD и файл menu.lst защищен от записи. Для входа в этот режим следует нажать <b>ESC</b>клавишу, затем для подтверждения <b>Return</b> клавишу и, наконец, "e" клавишу. После этого параметры будут дописаны в конец строки. Перемещение в строке осуществляется с помощью клавиш курсора.</p>


		<h3>menu.lst (примеры)</h3>

		<p>Строки с коментариями начинают с символа "#" и не мешают процессу загрузки, т.о. они могут быть оставленны в файле menu.lst.</p>

<pre>
# Example /boot/grub/menu.lst
################################################
# setkey changes the keyboardlayout to german (as an example)
setkey y z
setkey z y
setkey Y Z
setkey Z Y
setkey equal parenright
setkey parenright parenleft
setkey parenleft asterisk
setkey doublequote at
setkey plus bracketright
setkey minus slash
setkey slash ampersand
setkey ampersand percent
setkey percent caret
setkey underscore question
setkey question underscore
setkey semicolon less
setkey less numbersign
setkey numbersign backslash
setkey colon greater
setkey greater bar
setkey asterisk braceright
# menu.lst - See: grub(8), info grub, update-grub(8)
#            grub-install(8), grub-floppy(8),
#            grub-md5-crypt, /usr/share/doc/grub
#            and /usr/share/doc/grub-doc/.

## default num
# Set the default entry to the entry number NUM. Numbering starts from 0, and
# the entry number 0 is the default if the command is not used.
default		0

## timeout sec
# Set a timeout, in SEC seconds, before automatically booting the default entry
# (normally the first entry defined).
timeout		5

# Pretty colours
color cyan/blue white/blue
gfxmenu (hd0,5)/boot/message

## password ['--md5'] passwd
# If used in the first section of a menu file, disable all interactive editing
# control (menu entry editor and command-line)  and entries protected by the
# command 'lock'
# e.g. password topsecret
#      password --md5 $1$gLhU0/$aW78kHK1QfV3P2b2znUoe/
# password topsecret

#
# examples
#
# title		Windows 95/98/NT/2000
# root		(hd0,0)
# makeactive
# chainloader	+1
#
# title		Linux
# root		(hd0,1)
# kernel	/vmlinuz root=/dev/hda2 ro
#

#
# Put static boot stanzas before and/or after AUTOMAGIC KERNEL LIST

### BEGIN AUTOMAGIC KERNELS LIST
## lines between the AUTOMAGIC KERNELS LIST markers will be modified
## by the debian update-grub script except for the default options below

## DO NOT UNCOMMENT THEM, Just edit them to your needs

## ## Start Default Options ##
## default kernel options
## default kernel options for automagic boot options
## If you want special options for specific kernels use kopt_x_y_z
## where x.y.z is kernel version. Minor versions can be omitted.
## e.g. kopt=root=/dev/hda1 ro
##      kopt_2_6_8=root=/dev/hdc1 ro
##      kopt_2_6_8_2_686=root=/dev/hdc2 ro
# kopt=root=UUID=1885d68b-cc9c-49f8-9f98-a6874e7b3e7e ro  quiet vga=791

## default grub root device
## e.g. groot=(hd0,0)
# groot=(hd0,5)

## should update-grub create alternative automagic boot options
## e.g. alternative=true
##      alternative=false
# alternative=false

## should update-grub lock alternative automagic boot options
## e.g. lockalternative=true
##      lockalternative=false
# lockalternative=false

## additional options to use with the default boot option, but not with the
## alternatives
## e.g. defoptions=vga=791 resume=/dev/hda5
# defoptions=

## should update-grub lock old automagic boot options
## e.g. lockold=false
##      lockold=true
# lockold=false

## Xen hypervisor options to use with the default Xen boot option
# xenhopt=

## Xen Linux kernel options to use with the default Xen boot option
# xenkopt=console=tty0

## altoption boot targets option
## multiple altoptions lines are allowed
## e.g. altoptions=(extra menu suffix) extra boot options
##      altoptions=(single-user) single
# altoptions=(single-user mode) single

## controls how many kernels should be put into the menu.lst
## only counts the first occurence of a kernel, not the
## alternative kernel options
## e.g. howmany=all
##      howmany=7
# howmany=all

## should update-grub create memtest86 boot option
## e.g. memtest86=true
##      memtest86=false
# memtest86=true

## should update-grub adjust the value of the default booted system
## can be true or false
# updatedefaultentry=false

## ## End Default Options ##

title		Debian GNU/Linux, kernel 2.6.22.1-slh-smp-7
root		(hd0,5)
kernel		/boot/vmlinuz-2.6.22.1-slh-smp-7 root=UUID=1885d68b-cc9c-49f8-9f98-a6874e7b3e7e ro  quiet vga=791 
initrd		/boot/initrd.img-2.6.22.1-slh-smp-7

title		Debian GNU/Linux, kernel 2.6.22.1-slh-smp-7 (single-user mode)
root		(hd0,5)
kernel		/boot/vmlinuz-2.6.22.1-slh-smp-7 root=UUID=1885d68b-cc9c-49f8-9f98-a6874e7b3e7e ro  quiet vga=791 single
initrd		/boot/initrd.img-2.6.22.1-slh-smp-7

### END DEBIAN AUTOMAGIC KERNELS LIST

#### MS (TM)
title Windows 2K/XP/2003 (hda1)
chainloader (hd0,0)+1

### ISO boot
title sidux 32bit from gaiaISO
kernel (hd0,3)/sidux3/vmlinuz-2.6.22.1-slh-smp-7 boot=fll quiet vga=791 fromiso=/sidux3/siduxgaia.iso
initrd (hd0,3)/sidux3/initrd.img-2.6.22.1-slh-smp-7


title Debian GNU/Linux, kernel 2.6.18-1-686 (hda5)
root (hd0,4)
kernel (hd0,4)/boot/vmlinuz-2.6.18-1-686 root=/dev/hda5 ro vga=791
initrd (hd0,4)/boot/initrd.img-2.6.18-1-686
savedefault
</pre>

	</div>
	<div class="divider" id="dual-boot">
			<h2>Мультизагрузка</h2>

<pre>
<span class="highlight-3">NOTE Grub for kernels 2.6.22 and up uses sdax
and the line
initrd (hd0,x)/sidux/miniroot.gz
has changed to:
initrd (hd0,x)/sidux/initrd.img-2.6.22.x-slh-smp-x</span>
</pre>

			<p>С помощью "chainloading" очень просто расширять меню выбора Grub с другими операционными системами. Если бы хотелось иметь возможность запускать системы например MS Windows (TM) и Debian etch вместе с sidux' fromiso инсталляцию ', нужно Grub настраивать немножко только. Для того редактируют файл <span class="highlight-3">/boot/grub/menu.lst </span> как root и добавляют следующие строки после того <span class="highlight-3">### END DEBIAN AUTOMAGIC KERNELS LIST</span>:</p>


<pre>
####MS Windows (TM) perhaps even MS Vista (TM)
Title Windows (95/98/XP/Vista
rootnoverify (hd0,1)
makeactive
chainloader +1

### Debian etch
title Debian etch
kernel (hd0,3)/debian/vmlinuz root=/dev/hda4 ro (or whatever)
initrd (hd0,3)/debian/miniroot.gz (or (whatever)

### ISO boot
title sidux 32bit from ISO
kernel (hd0,5)/sidux/vmlinuz boot=fll quiet vga=791 fromiso=/sidux/sidux.iso
initrd (hd0,5)/sidux/miniroot.gz
</pre>

		<p>Некоторые люди хотят/вынужденны иметь несколько инсталляций Windows на компьютере. Однако, системы этого семейства всегда запускают с 1-го диска. Таким образом, необходимо один из разделов скрыть, а другой активировать. Последующие команды должны быть введены в командную строку grub и, в случае успеха, добавлены в menu.lst. Сделать это следует для каждого Windows-раздела. Не забудьте о резервном копировании! ;-)</p>

<pre>hide (hd0,0) # скрыть 1-й раздел на 1-ом диске
unhide (hd0,1) # показать 2-й раздел на 1-ом диске
rootnoverify (hd0,1) # сделать 2-й раздел на 1-ом диске к корневой файловой системе
makeactive # активировать 2-й раздел на 1-ом диске
chainloader +1 # показывает на 1-й сектор стартового раздела
boot # загружает операционную систему</pre>

		<p>Для того чтобы загрузить вторую Windows со второго диска, надо виртуально поменять местами диски 1 и 2. Таким образом для Windows будет симулироваться первый диск:</p>
<pre>map (hd0) (hd1)
map (hd1) (hd0)
</pre>


		<h3>Возможные трудности</h3>

		<p>Хотя grub не имеет ограничения на 1024-цилиндрa и может загружать системы, расположенные далее, тем не менее файл /boot/grub/stage2 должен быть доступен посредством базовой системы ввода-вывода BIOS (должен быть расположен до 1024 цилиндра).  Файл stage2 не может быть перемещен после инсталляции (например, программа defrag может попытаться это сделать), , т.к. в этом случае данные, записанные во время установки Grub теряют свою актуальность. Кроме того, разумно так же защитить файл stage2 от записи. Для этого, находясь в директории grub, выполнить следующие команды:</p>
<pre>Dos: attrib +r +s stage2
LINUX: # chmod a -w ./stage2
</pre>


		<h3>Вы заинтересовались?</h3>

		<p>Кроме того, болeе можно узнать в <a href="http://www.gnu.org/software/grub/grub-faq.de.html">официальных ЧАВО к grub</a>.</p>

		<p>Если имеется поддержанную сетевую карту, Linux может загрузить по сети. Соответствующий <a href="http://os.inf.tu-dresden.de/%7Efm3/grub.html">Загрузочный диск может быть получен здесь</a> (одинако, со старшей версией grub).</p>
		
	</div>
			<div id="rev">Содержание, последнее пересмотрено 06/02/2008 1200 UTC</div>
</div>
</body>
</html>
