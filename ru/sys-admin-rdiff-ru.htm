<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="ru">
<head>
	<title>sidux Manuals - rdiff</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
        <style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
        <style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
        <link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
        <script type="text/javascript" src="../lib/css-js/menu2.js"></script>
        <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-7_override.css">
        <![endif]-->
        <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" href="../lib/css-js/ie_5-6_override.css">
        <![endif]-->
</head>
<body>
<!-- Last translation revision by RoEn 07/12/2007 1300 UTC -->>
<div id="menu"> <!-- menu starts here ru language maintained by RoEn -->
<!--Welcome to the  sidux-manual Operating System Manual version-01.80.2008.01.10 -->
<!-- menu last updated by bluewater 10/01/2009 10400 hrs UTC -->
<a href="http://sidux.com/"><img src="../lib/logos/sidux-logo.png" title="Главная страница sidux.com, форума и вики" alt="sidux.com logo" id="menu-header" /></a>
	<ul id="top-list">
		<li><a href="manual-search-ru.htm#search-on"><img src="../lib/logos/kappfinder.png" title="Пойск в руководстве" alt="Search" />Варианты пойска</a> </li>
		<li><a href="http://manual.sidux.com/meta-manual">Мета-пакеты sidux</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-language-64.png" title="Выбор языка - Choose another language" alt="Переключение языка" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-ru.htm">Руководство sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-ru.htm#welcome-gen">Добро пожаловать!</a></li>
				<li><a href="welcome-ru.htm#how-to">Об использовании</a></li>
				<li><a href="welcome-ru.htm#table-contents">Содержание</a></li>
				<li><a href="help-ru.htm#help-gen">Где получить помощь</a></li>
				<li><a href="help-ru.htm#paste">IRC !paste</a></li>
				<li><a href="credits-ru.htm#cred-team">Благодарности</a></li>
				<li><a href="wel-quickstart-ru.htm#welcome-quick">Краткое руководство sidux</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-ru.htm">Текуший релис</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-ru.htm#cd-content">Системые требования</a></li>
				<li><a href="sys-admin-release-ru.htm#rolling">Замечания</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="cd-dl-burning-ru.htm">Получение ISO-образа</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="cd-dl-burning-ru.htm#download-ISO и сsidux">Скачивание ISO-образа и список зеркал</a></li>
				<li><a href="cd-dl-burning-ru.htm#md5">Проверка ISO-образа с md5</a></li>
				<li><a href="cd-dl-burning-ru.htm#burn-nero">Запись ISO-образа в Windows</a></li>
				<li><a href="cd-dl-burning-ru.htm#burn-linux">Запись ISO-образа в Linux</a></li>
				<li><a href="cd-dl-burning-ru.htm#xdelta">Xdelta патчи</a></li>
				<li><a href="cd-no-gui-burn-ru.htm#burning-no-gui">Запись ISO-образа в консоли</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-ru.htm">Режим LiveCD</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-ru.htm#rootpw">Пароль root</a></li>
				<li><a href="live-mode-ru.htm#live-cd-installsoft">LiveCD: установка ПО</a></li>
				<li><a href="live-mode-ru.htm#ntfs-3g">Запись на раздел NTFS: ntfs-3g</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="term-konsole-ru.htm">Терминал и оболочка</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="term-konsole-ru.htm#sux"> Команда: sux</a></li>
				<li><a href="term-konsole-ru.htm#term-kon">Терминал и оболочка</a></li>
				<li><a href="term-konsole-ru.htm#cli-help">Помощь в терминале</a></li>
				<li><a href="term-konsole-ru.htm#term-cmds">Команды в терминале</a></li>
				<li><a href="term-konsole-ru.htm#shell-scripts">"Скрипт scripts.sh"</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cheatcodes-ru.htm">Чит-коды</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cheatcodes-ru.htm#cheatcodes">Особые для sidux LiveCD чит-коды</a></li>
				<li><a href="cheatcodes-ru.htm#cheatcodes-linux">Общие для параметров ядра чит-коды</a></li>
				<li><a href="cheatcodes-vga-ru.htm#vga">Общие для видиокарты коды</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="part-gparted-ru.htm">Разметка диска</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="part-gparted-ru.htm#partition">Разметка диска: GParted</a></li>
				<li><a href="part-gparted-ru.htm#ntfs">Разделы NTFS: GParted</a></li>
				<li><a href="part-uuid-ru.htm#uuid">Актуализация, UUID и метки раздела: fstab </a></li>
				<li><a href="part-cfdisk-ru.htm#disknames">Имена жестких дисков</a></li>
				<li><a href="part-cfdisk-ru.htm#partition">Разметка диска: cfdisk</a></li>
				<li><a href="part-cfdisk-ru.htm#formating">Форматирование разделов</a></li>
				<li><a href="part-size-examp-ru.htm#part-example">Примеры разметки диска</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-ru.htm">Установка sidux</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-ru.htm#Inst-prep">Подготовка</a></li>
				<li><a href="hd-install-ru.htm#Installation">Инсталляция на HD</a></li>
				<li><a href="hd-install-ru.htm#first-hd-boot">Первая загрузка</a></li>
				<li><a href="hd-install-opts-ru.htm#fromiso">Инсталляция 'fromiso'</a></li>
				<li><a href="hd-install-opts-ru.htm#fromiso-persist">Способы 'fromiso' и 'persist'</a></li>
				<li><a href="hd-install-opts-ru.htm#usb-hd">Инсталяция на  USB-HD</a></li>
				<li><a href="hd-install-opts-ru.htm#vtbox">Инсталляция в VirtualBox</a></li>
				<li><a href="hd-install-opts-ru.htm#qemu">Инсталляция в QEMU</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-ru.htm">Оборудование</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="hw-dev-hw-dri-ru.htm#hd-ntfs3g">Запись на раздел NTFS: ntfs-3g</a></li>
				<li><a href="hw-dev-mon-ru.htm#mon-res">Разрешение экрана и мониторы</a></li>
				<li><a href="hw-dev-mon-ru.htm#xrandr">Двойные экраны и xrandr</a></li>
				<li><a href="hw-dev-mon-ru.htm#mon-binary">Двойные экраны (изпользуя двоичные файлы)</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#non-free-3d">Драйверы от NVIDIA и ATI</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#native-nv-ati">Свободные драйверы от xorg</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#non-free">Другие проприетарные драйверы</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="wm-kde-ru.htm">Оконный менеджер</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="wm-kde-ru.htm#desk-freeze">"КДЕ зависает"</a></li>
				<li><a href="wm-kde-ru.htm#kde-login">Проблемы входа в KDE</a></li>
				<li><a href="wm-kde-ru.htm#ch-th">Управление темами</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="lamp-apache-ru.htm">Мета-пакет LAMP</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="lamp-apache-ru.htm#serv-apache">Что такое LAMP</a></li>
				<li><a href="lamp-apache-ru.htm#serv-ftp">Клиенты FTP</a></li>
				<li><a href="lamp-apache-ru.htm#serv-sec">Защищенные протоколы</a></li>
				<li><a href="lamp-apache-ru.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-ru.htm#serv-mysql">Установка MySQL</a></li>
				<li><a href="lamp-ppp-ru.htm#serv-php">PHP и Apache</a></li>
				<li><a href="ntp-server-ru.htm#ntp-server">Сервер времени</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="internet-connecting-ru.htm">Интернет и локальная сеть</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="tor-privoxy-ru.htm#tor">Маршрутизатор Tor</a></li>
				<li><a href="tor-privoxy-ru.htm#privoxy"> Веб-прокси Privoxy</a></li>
				<li><a href="internet-connecting-ru.htm#firewalls">Брандмауэры</a></li>
				<li><a href="samba-ru.htm#configure">Интеграции в сеть Windows</a></li>
				<li><a href="samba-ru.htm#setup">Сервер Samba</a></li>
				<li><a href="ssh-ru.htm#ssh-fs">Удаленное монтирование: SSH</a></li>
				<li><a href="ssh-ru.htm#ssh-x">Приложения X-Windows: SSH</a></li>
				<li><a href="ssh-ru.htm#ssh-f">SSH и Konqueror</a></li>
				<li><a href="ssh-ru.htm#ssh-w">SSH X-Forwarding</a></li>
				<li><a href="ssh-ru.htm#ssh">Безопасность SSH</a></li>
				<li><a href="internet-connecting-ru.htm#dial-mod">56кбит-модемы</a></li>
				<li><a href="internet-connecting-ndis-ru.htm#ndiswrapper-basic">Использование Ndiswrapper</a></li>
				<li><a href="internet-connecting-ndis-ru.htm#ndiswrapper-advanced">Использование Ndiswrapper - допол.</a></li>
				<li><a href="internet-connecting-wpagui-ru.htm#wpa-roaming-gui">WiFi - roaming WPA-GUI</a></li>
				<li><a href="internet-connecting-wpa-ru.htm#wpa-basic">WiFi - основые инструкции</a></li>
				<li><a href="internet-connecting-wpa-ru.htm#wpa">WiFi - wpasupplicant</a></li>
				<li><a href="internet-connecting-ru.htm#netcardconfig">Подключение - Ceni</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 13 );" onmouseout="startTime();" ><a href="sys-admin-apt-ru.htm">Управление пакетами</a>
			<ul class="sub-menu" id="sm13">
				<li><a href="sys-admin-apt-ru.htm#apt-cook">APT и репозитории</a></li>
				<li><a href="sys-admin-meta-ru.htm#meta-pack">Мета-пакеты</a></li>
				<li><a href="sys-admin-meta-ru.htm#meta-proxy">Мета-инсталлятор и прокси</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-install">Установка</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-delete">Удаление</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-downgrade">Понижение hold версии</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-cache">Поиск информации о пакете</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-kio">Поиск информации о пакете kio-apt</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-upgrade">Обновление - dist-upgrade</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="sys-admin-gen-ru.htm">Системное администрирование</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="home-ru.htm#home-bu">Перемещение /home</a></li>
				<li><a href="siduxcc-ru.htm#siduxcc">sidux Центр управления</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-upgrade">Обновление - dist-upgrade</a></li>
				<li><a href="sys-admin-upgrade-ru.htm#live-cd-upgrade">Обновление с LiveCD</a></li>
				<li><a href="sys-admin-kern-upg-ru.htm#kern-upgrade">Обновление ядра</a></li>
				<li><a href="sys-admin-rdiff-ru.htm#rdiff">Резервирование: rdiff</a></li>
				<li><a href="sys-admin-rsync-ru.htm#rsync">Резервирование: rsync</a></li>
				<li><a href="vir-rkits-ru.htm#virus-rkits">Сканер безопасности</a></li>
				<li><a href="sys-admin-gen-ru.htm#start-services">Выбор служб</a></li>
				<li><a href="sys-admin-gen-ru.htm#pw-lost">Восстановление root-пароля</a></li>
				<li><a href="sys-admin-gen-ru.htm#fonts">Шрифты</a></li>
				<li><a href="sys-admin-gen-ru.htm#cups">CUPS</a></li>
				<li><a href="sys-admin-gen-ru.htm#init">sidux режимы загрузки - init</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#mbr-grub-boot">Восстановление MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#dual-boot">Мультизагрузка</a></li>
				<li><a href="bios-freedos-ru.htm#bois-prep">Обновление BIOS с FreeDOS</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#boot-grub-floppy">Загрузочная дискета</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#remove-grub">Удаление GRUB из MBR</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#what-is-grub">Менеджер загрузки GRUB</a></li>
			</ul>
		</li>
	</ul>
	<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="rdiff">
			<h2 id="top-header">Система резервного копирования файлов rdiff-backup</h2>
				<p>Утилита rdiff-backup позволяет создавать резервные копии ваших данных. (Работает в окружении различных unix-подобных ОС).<br />
				В sidux предлагается на выбор два варианта использования: интерактивно или как скрипт.</p>

				<h3><a href="http://techpatterns.com/forums/about831.html">Описание скрипт-версии</a></h3>
	<div class="spacer02"></div>

			<h5>Ниже рассматривается интерактивный способ использования</h5>

			<h6>Краткое описание rdiff-backup</h6>

				<p class="highlight-2">Вплоть до явного указания все команды необходимо выполнять в Konsole отимени суперпользователя (root)</p>

				<p>*Эта утилита - прекрасный инструмент для восстановления после полного обновления системы или обновления ядра.Но столь же замечательно она может быть применена для восстановления отдельных файлов<br />
				*Так же как при использовании rsinc резервируются лишь измененные файлы ( что существенно сокращает время создания резервной копии).<br />
				*История всех произведенных изменений сохраняется ( это позволит восстановить не только последние измененные файлы, но и ,к примеру, удаленные 3 недели назад!)<br />
				*Доступно безопасное сетевое копирование данных (используя ssh).<br />
				*Возможно создание резервных копий смонтированных разделов целиком (что позволяет легко настроить ежедневное копировани данных...не нуждающееся в отмонтированиии резервируемого раздела).<br />
				*Привыходе из строя, покупке нового жесткого диска Вы можете полностью восстановить данные!<br />
				*Возможно промышленное использование как инструмента резервного копирования в больших сетях ( для linux не вызывает ни малейших проблем, несколько сложнее с резервированием windows-машин).<br />
				*Являясь консольной утилитой rdiff-backup легко встраивается в shell-скрипты, позволяя автоматизировать процесс резервного копирования посредством cron.<br />
				*При создании резервной копии с помощью rdiff-backup сохраняются как права доступа , так и символические ссылки. Т.о. после восстановления из резервной копии Вы получаете все "как было".</p>

			<h6>Что нужно знать</h6>
				<p>Копии резервируемых файлов сохраняются целиком ( в несжатом виде).Таким же образом сохраняется истории произведенных изменений (пошаговое резервирование). Это означает, что суммарное пространство для резервной копии должно быть больше обьема самих резервируемых файлов! (При резервировании файлов обьемом 100Гб на диске необходимо выделить 120 Гб под резервную копию).Место для сохранения резервной копии необходимо выделять на отдельном жестком диске.</p>

			<h6>Как это работает</h6>
				<p>(названия и размеры разделов приведены в качестве примера и могут быть другими в Вашем конкретном случае)</p>
				<p>Сперва убедитесь в том, что:<br />
				* Первый жесткий диск (hda) 100Гб используется со следующими смонтированными разделами:, hda1 как /;hda5 для сохранения музыки и прочих файлов;hda6 под swap.<br />
				* Второй жесткий диск (hdb) 200Гб не используется и смонтирован как hdb1 ...(будет задействован для сохранения резервных копий).<br />
				* IP адрес 192.168.0.1</p>

				<p>Сперва устанавливаем rdiff-backup:</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<p>Теперь, хотя возможно осуществить резервирование любой дирректории, рассмотрим пример резервирования раздела жесткого диска целиком ( пусть это будут hda1 и hda5; создавать бэкап раздела swap - необходимости нет).Создадим небходимые дирректории для сохраняемых файлов:</p>
<pre>
# mkdir -p /media/hdb1/rdiff-backups/192.168.0.1/root
# mkdir -p /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Необходимо указать свой IP адрес для сохранения возможности резервировать данные с других хостов в будущем.</p>

			<h6>Резервирование</h6>

				<p>синтаксис утилиты rdiff-backup: <span class="highlight-3">rdiff-backup source-dir dest-dir</span>. (Примечание: всегда указывайте имя дирректории, а не файла!).</p>

				<p>Для резервирования раздела hda5 выполнить в командной строке:</p>
<pre>
# rdiff-backup /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Тоже самое, но для корневого раздела:</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
</pre>
				<p>Ошибки типа "AF_UNIX path too long" могут быть проигнорированны. Их появление может быть связано с тем, что при первичном копировании раздела rdiff-backup сохраняет все, а не только измененные файлы. Так же обращаем внимание, что из списка резервирования исключены /tmp(постоянно изменяющиеся временные файлы); /proc и /sys, как не содержащие реальных файлов; а также /mount(здесь содержится раздел с резервными копиями файлов; включив его в список мы создадим бесконечный цикл "самокопирования" этого раздела. Если создать копию все же необходимо - придется выбрать отдельный диск).</p>

				<p>Причина использования в команде '/proc/*' вместо '/proc' в том, что во втором случае произойдет копирование только названия дирректории, без ее содержимого. Это же относится и к /tmp, /sys, и в целом к использованию имен точек монтирования.</p>

				 <p>При восстановлении после сбоев или повреждений корневого раздела целиком, разделы /tmp, /proc, /sys и имена точек монтирования будут созданы заново (так как и должны быть). Если не существует раздела /tmp, старт Х-ов приведет к появлению многочисленных ошибок.Страничка man содержит подробные сведения об опциях --exclude and --include).</p>

			<h6>Восстановление дирректорий из файлов резервного копирования</h6>

				<p>В данном случае синтаксис команды rdiff-backup таков:</p>
<pre>
rdiff-backup -r &lt;from-when&gt; &lt;source-dir&gt; &lt;dest-dir&gt;
</pre>
				<p>Теперь, если вы случайно удалили дирректорию /media/hda7/photos,ее возможно восстановить:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5/photos /media/hda5/photos
</pre>
				<p>Опция "-r now" означает восстановление из последнего бэкапа. Если резервное копирование осуществляется периодически (посредством crontab, например) и дирректория с фотографиями была удалена несколько дней назад, то для восстановления следует использовать соответствующий бэкап (не "now", т.к. в нем не содержатся необходимые файлы). То же самое верно во всех случаях, когда необходимо восстановить прежнюю версию чего бы то ни было.</p>

				<p>Для восстановления из бэкапа, созданного 3 дня назад используйте: "-r 3D" ... но не забывайте свериться с указаниями man</p>

				<p class="highlight-1">"3D" позволяет вернуться к состоянию за 72 часа до настоящего момента, и если тогда не было создано резервной копии, восстановление автоматически произойдет из предыдущего бэкапа. Например, указана опция "3D", но существуют бэкапы только двухдневной и черырехдневной давности; запрошенный файл будет восстановлен из бэкапа, созданного 4 дня назад ( это обстоятельство необходимо учесть перед проведением восстановления).</p>

				<p>Следующая команда отображает дату и время резервных копий, созданых для hda5:</p>
<pre>
# rdiff-backup -l /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
			<h5>Восстановление разделов</h5>

				<p>Является возможным и восстановление разделов жесткого диска целиком ( ведь точка монтирования, по сути, та же дирректория).</p>

				<p class="highlight-2">ПРЕДУПРЕЖДЕНИЕ: Не пытайтесь восстановить корневой раздел, если Вы в него загрузились! Это может привести к потере всех данных на всех разделах, включая резервные копии на отдельном жестком диске!! ...rdiff-backup выполнят в точности то, что ему указано... если в бэкапе корневой раздел пуст, то при восстановлении будет удалнено все содиржимое настоящего корневого раздела - в точности как в резервной копии.</p>

				<p>Для восстановления hda5 из последней резервной копии необходимо выполнить:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5 /media/hda5
</pre>
			<h5>Восстановление корневого раздела</h5>

				<p>Восстановление корневого раздела не является простым. Как было сказано выше- не допускается восстановление "/", усли он смонтирован. Необходимость данного действия может возникнуть в результате неудачной инсталляции, обновления системы или ее ядра. При правильном исполнении - возможен откат к прежнему состоянию системы, и он займет не более 20 минут.</p>

				<p>Один из способов восстановления состоит в загрузке в параллельно установленную linux-систему. Далее процесс восстановления аналогичен вышеописанной стандартной процедуре ( т.к. в загруженной системе восстанавливаемый корневой раздел не является таковым и выступает в роли обычной точки монтирования). Перегрузитесь в систему, корневой раздел которой был восстановлен - сама система будет в точности соответствовать использованной резервной копии. Даный способ- самый легкий.</p>

				<p>Другим способом является загрузка с sidux-live и осуществление восстановления корневого раздела из "Live-CD" системы (утилита rdif-backup включена в состав ПО на диске). Если же утилита не обнаружена в комплекте Live-CD, можно при загрузке в командной строке grub (Bootoptions, (Cheatcodes)) указать "unionfs", что позволит производить инсталляцию пакетов в режиме Live-CD. По окончании загрузки необходимо выполнить в командной строке:</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h6>А теперь осуществим восстановление:</h6>
<pre>
# mount /dev/hda1 /media/hda1
# mount /dev/hdb1 /media/hdb1
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Примечание: если вы не имеете диска sidux, но располагаете Live-CD с поддержкой klik, установить rdiff-backup возможно с помощью Klik:</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Рекомендуется каждому попробовать осуществить восстановление  корневого раздела на практике. так как нет ничего хуже, чем думать, как все просто и легко, а потом столкнуться с неожиданностью в аварийной ситуации.</p>

			<h5>Резервирование данных других хостов</h5>

				<p>Данные с удаленной машины возможно сохранять локально с условием наличия ssh доступа к удаленному хосту и достаточного количества свободного места на локальном жестком диске. На удаленной машине должен быть запущен сервер ssh, где при этом расположен сам хост - значения не имеет( это может быть и локальная сеть и интернет).</p>

				<p>Подразумевается соответствие удаленного хоста следующим параметрам:<br />
				1) 100Гб жесткий диск (hda) с обычными точками монтирования<br />
				2) hda1 используется как корневой раздел<br />
				3) hda5 предназначен для хранения временных файлов, которые мы не включаем в резервное копирование<br />
				4) hda6 как swap <br />
				5) IP адрес 192.168.0.2</p>

				<p>Примечание: оба 100 гигабайтных харда обычно не могут быть зарезервированы на 200 гигабайтном винчестере ввиду нехватки дискового пространства, но поскольку мы не копируем hda5 удаленного хоста, а разделы жесткого диска обычно не заполнены на 100% ( хотя полагаться на это не стоит) можно сосчитать количество необходимого места на жестком диске и убедиться в его достаточности. Каждый раз, когда новый раздел сохраняется с помощью rdiff-backup, необходимо помнить, что создается новая 'структура' для вложенных файлов, требующая нового дополнительного пространства.</p>

				<p>Существует возможность ограничить временной интервал хранения резервных копий( например одним месяцем) и соответствующая команда будет рассмотрена ниже. Конечно в этом случае потребуется меньше места, чем при сохранении резервных копий за годовой период. А вслучае, когда необходимо сохранять копии на протяжении года, также необходимо иметь достаточное количество дискового пространства.</p>

				<p>Во-первых необходимо установить rdif-backup на удаленный хост (относится к каждому компьютеру, с которого Вы намерены осуществлять резервирование данных, включая бэкап-сервер).</p>

				<p>На локальном компьютере выполняем: <span class="highlight-4">Обратите внимание на использование двойного двоеточия :: </span></p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/ /media/hdb1/rdiff-backups/192.168.0.2/root 
</pre>
				<p>Теперь для восстановления дирректории на удаленном компьютере возможно инициировать процесс восстановления как локально, так и удаленно.</p>

				<p>Восстановление дирректории /usr/local/games на удаленном компьютере, инициализируя процесс восстановления на нем же:</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<p>Тоже самое, но локально:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<p>Используется такой же синтаксис, как при восстановлении корневого раздела с Live-CD (удаленная машина загружена с Live-CD ... пример - смотри выше).</p>

			<h5>Автоматизированное создание резервных копий:</h5>

				<p>Первое, что необходимо для резервирования данных с удаленного компьютера, включить доступ по ключам ssh без использования пароля. <span class="highlight-2">Речь идет о входе без пароля с учетной записью root. Обсуждение возможности ограничиться беспарольным выполнением только команд rdiff-backup выходит за рамки данной статьи, подробная информация находится в разделе руководства <a href="ssh-ru.htm#ssh-s">"SSH Configuration"</a> </span>. Здесь мы рассмотрим простейший способ установки беспарольного логина, принимая политику "полного доверия".</p>

				<p>Выполняем локально:</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<p>Дважды нажимаем 'enter' для сохранения пустого пароля. После этого:</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\<!--dunno if this is wrong-->
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<p>Будет запрошен пароль root</p>

				<p>Теперь вы можете войти по ssh на удаленный хост под учетной записью кщще, не вводя пароль, и произвести автоматизацию rdiff-backup.</p>

				<p>Следующим шагом создадим shell-script, подобный ниже приведенному и содержащий все необходимые команды rdiff-backup:</p>


<pre>
#!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Backing up 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' / /media/hdb1/rdiff-backups/192.168.0.1/root
echo "(and purge increments older than 1 month)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Backing up 192.168.0.1 mount hda5======="
${RDIFF} --ssh-no-compression --exclude /media/hda5/myjunk /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo
echo "=======Backing up 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*' 192.168.0.2::/media/hdb1/rdiff-backups/192.168.0.2/root
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M --force /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>


				<p>Сохраним скрипт под именем "myrdiff-backups.bash" в дирректории /usr/local/bin локально (на бэкап-сервере), не забываем сделать его исполняемым. Запускаем, чтобы убедится, что скрипт работает.</p>

				<p>И в последнюю очередь прописываем в crontab(root-овый)вызов скрипта ежедневно в 8 часов вечера. Для этого выполняем от имени root следующее:</p>
<pre>
# crontab -e
и пишим следующее
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

			<div id="rev">Содержание, последнее пересмотрено 07/12/2007 1230 UTC</div>
</div>
</div>
</body>
</html>
