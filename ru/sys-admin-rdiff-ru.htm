<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>Sidux Manuals - rdiff-de</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css" media="all">@import url("../lib/css-js/content.css");</style>
	<style type="text/css" media="all">@import url("../lib/css-js/menu.css");</style>
	<style type="text/css" media="print">@import url("../lib/css-js/print.css");</style>
	<link rel ="shortcut icon" href="../lib/favicon/manual.ico" />
	<script type="text/javascript" src="../lib/css-js/menu2.js"></script>
</head>
<body>
<div id="menu"> <!-- menu starts here -->
<!--Welcome to the Official sidux-manual version may very on some pages from snap 39 to 0.6-2007-05-08 ru language maintained by RoEn and koslow-->
<!-- menu last updated by bluewater 08/05/2007 1700rs AEST 08/05/2007 0700hrs UTC -->
<img src="../lib//logos/sidux-logo.png" alt="logo" id="menu-header" />
	<ul id="top-list">
		<li><a href="http://sidux.com/">Back to main sidux menu</a></li>
	</ul>
	<div id="flags-2">
			<a href="../flag-index.html"><img src="../lib/logos/sidux-lang-50.png" title="Choose another language" alt="lang-switch" /></a>
	</div>
	<ul>
		<li  onmouseover="showHide( 1 );" onmouseout="startTime();" ><a href="welcome-ru.htm">Добро пожаловать в sidux</a>
			<ul class="sub-menu" id="sm1">
				<li><a href="welcome-ru.htm#welcome-gen">Официальное руководство</a></li>
				<li><a href="welcome-ru.htm#how-to">Как пользоваться этим руководством?</a></li>
				<li><a href="help-ru.htm#help-gen">Где найти помощь?</a></li>
				<li><a href="credits-ru.htm#cred-team">Благодарности</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 2 );" onmouseout="startTime();" ><a href="cd-content-ru.htm">Содержание CD</a>
			<ul class="sub-menu" id="sm2">
				<li><a href="cd-content-ru.htm#cd-content">Содержание CD</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 6 );" onmouseout="startTime();" ><a href="cd-dl-burning-ru.htm">Cкачать и нажечь CD</a>
			<ul class="sub-menu" id="sm6">
				<li><a href="cd-dl-burning-ru.htm#download-sidux">Cкачать и нажечь CD</a></li>
				<li><a href="cd-dl-burning-ru.htm#md5">Проверка ISO-образа с помошью контрольной суммы md5</a></li>
				<li><a href="cd-dl-burning-ru.htm#burn-nero">Нажигание CD под Windows</a></li>
				<li><a href="cd-dl-burning-ru.htm#burn-linux">Нажигание CD под Linux'ом</a></li>
				<li><a href="cd-dl-burning-ru.htm#xdelta">Xdelta-патчи</a></li>
				<li><a href="cd-no-gui-burn-ru.htm#burning-no-gui">Нажигание CD без графической оболочки</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 4 );" onmouseout="startTime();" ><a href="live-mode-ru.htm">Режим Live-CD</a>
			<ul class="sub-menu" id="sm4">
				<li><a href="live-mode-ru.htm#rootpw">Пароль суперпользователи на sidux-Live-CD</a></li>
				<li><a href="live-mode-ru.htm#live-cd-installsoft">Installing software whilst on a Live-CD</a></li>
				<li><a href="live-mode-ru.htm#ntfs-3g">Запись на NTFS раздел с помошью ntfs-3g в режиме Live-CD</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 9 );" onmouseout="startTime();" ><a href="term-konsole-ru.htm">Терминал / оболочка</a>
			<ul class="sub-menu" id="sm9">
				<li><a href="term-konsole-ru.htm#term-kon">Терминал / оболочка</a></li>
				<li><a href="term-konsole-ru.htm#cli-help">Помощь при использовании оболочки</a></li>
				<li><a href="term-konsole-ru.htm#shell-scripts">установка скриптов типа scripts.sh</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 7 );" onmouseout="startTime();" ><a href="cheatcodes-ru.htm">Применение кодов обмана при загрузке</a>
			<ul class="sub-menu" id="sm7">
				<li><a href="cheatcodes-ru.htm#cheatcodes">Коды обмана</a></li>
				<li><a href="cheatcodes-vga-ru.htm#vga">Коды для видеоадаптера</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 5 );" onmouseout="startTime();" ><a href="part-gparted-ru.htm">Разделение жесткого диска</a>
			<ul class="sub-menu" id="sm5">
				<li><a href="part-gparted-ru.htm#partition">Разделение с помошью GParted</a></li>
				<li><a href="part-gparted-ru.htm#ntfs">Изменение размера NTFS-разделов с помощью GParted</a></li>
				<li><a href="part-uuid-ru.htm#uuid">UUID, названия жестких дисков и скрипт fstab</a></li>
				<li><a href="part-cfdisk-ru.htm#partition">Разделение с помошью cfdisk</a></li>
				<li><a href="part-cfdisk-ru.htm#formating">Разделение с помошью cfdisk</a></li>
				<li><a href="part-size-examp-ru.htm#part-example">Размеры разделов: примеры</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 8 );" onmouseout="startTime();" ><a href="hd-install-ru.htm">Способы установки</a>
			<ul class="sub-menu" id="sm8">
				<li><a href="hd-install-ru.htm#Inst-prep">Подготовка установки</a></li>
				<li><a href="hd-install-ru.htm#Installation">Установка на жесткий диск</a></li>
				<li><a href="hd-install-ru.htm#first-hd-boot">Первоначальная загрузка с жесткого диска</a></li>
				<li><a href="hd-install-opts-ru.htm#fromiso">Загрузка с ISO-образа 'fromiso'</a></li>
				<li><a href="hd-install-opts-ru.htm#usb-hd">Инсталяция на жесткий диск с УСБ-приводом</a></li>
				<li><a href="hd-install-opts-ru.htm#qemu">Установка sidux через qemu</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 10 );" onmouseout="startTime();" ><a href="hw-dev-hw-dri-ru.htm">Видеоадаптеры, аппаратное обеспечение, оборудование и модулы</a>
			<ul class="sub-menu" id="sm10">
				<li><a href="hw-dev-hw-dri-ru.htm#hd-ntfs3g">Запись на NTFS раздел с помошью ntfs-3g в режиме Live-CD</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#mon-res">Разрешения и мониторы экрана</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#nvidia-3d">Собственнический 3D-модиль фирмы nVidia</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#ati-3d">Собственнический 3D-модиль фирмы ATI</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#native-nv">Графический встроен в Linux модуль nv</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#native-ati">Графический встроен в Linux модуль ati</a></li>
				<li><a href="hw-dev-hw-dri-ru.htm#non-free">Аппаратное с собственническими требованиями фирм</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 12 );" onmouseout="startTime();" ><a href="wm-kde-ru.htm">Менеджер окна</a>
			<ul class="sub-menu" id="sm12">
				<li><a href="wm-kde-ru.htm#desk-freeze">Рабочий стол KDE зависает</a></li>
				<li><a href="wm-kde-ru.htm#kde-login">Проблемы при входе в систему под KDE</a></li>
				<li><a href="wm-kde-ru.htm#ch-th">Смена темы</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 14 );" onmouseout="startTime();" ><a href="lamp-apache-ru.htm">Сюита-пакет LAMP в sidux</a>
			<ul class="sub-menu" id="sm14">
				<li><a href="lamp-apache-ru.htm#serv-apache">Пакет LAMP в sidux</a></li>
				<li><a href="lamp-apache-ru.htm#serv-ftp">Клиенты FTP</a></li>
				<li><a href="lamp-apache-ru.htm#serv-sec">Уверенные протоколы</a></li>
				<li><a href="lamp-apache-ru.htm#serv-ssl">SSL</a></li>
				<li><a href="lamp-sql-ru.htm#serv-mysql">Установка MySQL</a></li>
				<li><a href="lamp-ppp-ru.htm#serv-php">Применение PHP в Apache</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 3 );" onmouseout="startTime();" ><a href="internet-connecting-ru.htm">Интернет и локальная сеть</a>
			<ul class="sub-menu" id="sm3">
				<li><a href="ntp-server-ru.htm#ntp-server">Установка сервера времени NTP</a></li>
				<li><a href="internet-connecting-ru.htm#firewalls">Mini-Firewall</a></li>
				<li><a href="ssh-ru.htm#ssh-fs">SSH: Подключение к удаленному компьютеру</a></li>
				<li><a href="ssh-ru.htm#ssh-x">SSH: Применение X-Window-программ по SSH</a></li>
				<li><a href="ssh-ru.htm#ssh-f">SSH: Графическое применение с помощью Konqueror</a></li>
				<li><a href="ssh-ru.htm#ssh-w">SSH: Поддержка графической оболочки на базе X</a></li>
				<li><a href="ssh-ru.htm#ssh">SSH: Безопасность</a></li>
				<li><a href="samba-ru.htm#configure">SAMBA: Совместные использования папки в Windows пользовать </a></li>
				<li><a href="samba-ru.htm#setup">Установка сервера Samba</a></li>
				<li><a href="internet-connecting-ru.htm#dial-mod">56kбит-модемы</a></li>
				<li><a href="internet-connecting-ru.htm#ndiswrapper">Ndiswrapper</a></li>
				<li><a href="internet-connecting-wpa-ru.htm#wpa">WIFI - WLAN</a></li>
				<li><a href="internet-connecting-ru.htm#internetsharing">Совместное использование нитернета</a></li>
				<li><a href="internet-connecting-ru.htm#netcardconfig">Интернет и локальная сеть</a></li>
			</ul>
		</li>
		<li  onmouseover="showHide( 11 );" onmouseout="startTime();" ><a href="sys-admin-apt-ru.htm">Системная администрация</a>
			<ul class="sub-menu" id="sm11">
				<li><a href="sys-admin-apt-ru.htm#apt-cook">Апт и список источников </a></li>
				<li><a href="sys-admin-meta-ru.htm#meta-pack">Установка программых пакетов</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-install">Установка новых пакетов</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-delete">Удаление пакетов</a></li>
				<li><a href="sys-admin-apt-ru.htm#apt-upgrade">Системное обновление инсталированной системы</a></li>
				<li><a href="sys-admin-upgrade-ru.htm#live-cd-upgrade">Системное обновление с помощью Live-CD</a></li>
				<li><a href="sys-admin-kern-upg-ru.htm#kern-upgrade">Обновление ядра</a></li>
				<li><a href="sys-admin-rdiff-ru.htm#rdiff">Резерв-копирование с rdiff</a></li>
				<li><a href="sys-admin-rsync-ru.htm#rsync">Резерв-копирование с rsync</a></li>
				<li><a href="vir-rkits-ru.htm#virus-rkits">Антивирусные программы и сканеры rootkit</a></li>
				<li><a href="sys-admin-gen-ru.htm#start-services">Запуск сервиса в sidux</a></li>
				<li><a href="sys-admin-gen-ru.htm#pw-lost">Забытый root-пароль</a></li>
				<li><a href="sys-admin-gen-ru.htm#fonts">Купели</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#mbr-grub-boot">Загрузочный сектор переписан</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#boot-grub-floppy">Создание загрузочной дискеты</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#remove-grub">Удаление grub с загрузочного сектора</a></li>
				<li><a href="sys-admin-grub-bootman2-ru.htm#what-is-grub">Grub - системный загрузчик</a></li>
			</ul>
		</li>
	</ul>
<!-- menu ends here --> </div>
<div id="main-page">
	<div class="divider" id="rdiff">
			<h2 id="top-header">Systemsicherung mit rdiff-backup</h2>
				<p>rdiff-backup ist eine Applikation zur Dateisicherung, welche unter verschiedenen *nix-Systemen eingesetzt werden kann.<br />
				Unter sidux hat man die Wahl, wie verschiedene Prozesse eingeleitet werden, selbstbestimmt ("klassisch") oder mit Hilfe eines Scriptes.</p>

				<p><a href="http://techpatterns.com/forums/about831.html">Hier die Script-Version von h2</a></p>

			<h5>Ab hier wird das klassische, selbstbestimmte Verfahren beschrieben.</h5>

			<h6>rdiff-backup</h6>
				<p>* besonders geeignet zur Wiederherstellung des Systems nach einem missgl&#252;ckten dist-upgrade, bei Problemen nach einem kernel-upgrade u. a., oder einfach zur Wiederherstellung &#228;lterer Fassungen einzelner Dateien.<br /></p>
				<p>* wie bei rsync wird nur gesichert, was ver&#228;ndert wurde (sehr schneller Sicherungsvorgang!)<br /></p>
				<p>* verschiedene Sicherungsebenen werden angelegt - "Sicherungsgeschichte" (das bedeutet, es kann auch eine Datei wiederhergestellt werden, welche drei Wochen zuvor am Arbeitssystem bereits gel&#246;scht wurde!)<br /></p>
				<p>* ein Backup kann im Netzwerk &#252;ber eine sichere Verbindung durchgef&#252;hrt werden (Verwendung von ssh).<br /></p>
				<p>* ein Backup von eingeh&#228;ngten (gemounteten) Partitionen kann angelegt werden (dies erm&#246;glicht ein einfaches automatisches und t&#228;gliches Backup, ohne manuell eine Partition aush&#228;ngen zu m&#252;ssen).<br /></p>
				<p>* nach einem Festplattentod k&#246;nnen s&#228;mtliche Daten auf einer neuen Festplatte wieder hergestellt werden<br /></p>
				<p>* skaliertes Backup gro&#223;er Netzwerke (problemlos in Linux-Netzwerken, Windows-Netzwerke sind komplexer zu handhaben), benutzt auch in kommerziellen Umgebungen<br /></p>
				<p>* es ist eine Kommandozeilenapplikation, womit es besonders geeignet ist, automatisierte Backups einzurichten (z. B. &#252;ber ein Bash-Script, welches &#252;ber cron aufgerufen wird)<br /></p>
				<p>* kann mit Angaben zu Dateibesitzer und Dateiberechtigungen umgehen wie auch mit symbolischen Verkn&#252;pfungen (und noch viel mehr), sodass nach einer R&#252;ckspielung von Daten ein exaktes Abbild des urspr&#252;nglichen Zustands wiederhergestellt wird.</p>

			<h6>Was ben&#246;tigt wird</h6>
				<p>rdiff-backup legt eine nichtkomprimierte Kopie der Dateien, welche gesichert werden, an, und es wird eine Backup-"Geschichte", ein inkrementelles Backup angelegt. Somit muss der Speicherplatz des Backups gr&#246;&#223;er sein als die Gr&#246;&#223;e der Dateien, welche gesichert werden. Wenn z. B. 100 GB gesichert werden sollen, sollte ein Speicherplatz von etwa 120 GB vorhanden sein, am besten auf einer eigenen Festplatte. Der ben&#246;tigte Speicherplatz kann nat&#252;rlich variieren.</p>

			<h6>Einrichtung</h6>
				<p>Gehen wir von folgenden Spezifikationen des PCs aus:<br /></p>
				<p>* eine Festplatte mit 100 GB (hda), hda1 ist die Rootpartition, hda5 ist die Partition f&#252;r Musik und andere Dateien, hda6 ist die Swap-Partition.<br /></p>
				<p>* eine extra Festplatte (hdb) mit 200 GB, welche nicht im Produktivsystem aktiv ist und die nach hdb1 eingebunden wird. Diese Festplatte wird f&#252;r Sicherheitsbackups verwendet.<br /></p>
				<p>* Die IP-Addresse ist 192.168.0.1</p>

				<p>Als erstes wird rdiff-backup installiert:</p>
<pre>
# apt-get install rdiff-backup
</pre>
				<p>Obwohl nun bereits Backups von jeglichem Ordner angelegt werden k&#246;nnen, wollen wir zeigen, wie ganze Partitionen gesichert werden k&#246;nnen: gesichert werden sollen hda1 und hda5 (nicht hda6). Als erstes legen wir Ordner an, wohin das Backup gespielt werden soll:</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/root
# mkdir /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Die IP-Adresse wird angegeben f&#252;r den Fall, dass von einem anderen Computer ebenfalls Backups auf dieser Festplatte gespeichert werden sollen (siehe unten).</p>

			<h6>Das Backup</h6>

				<p>rdiff-backup verwendet folgende Syntax: <span class="highlight-3">rdiff-backup Quellverzeichnis Zielverzeichnis</span>. Beachte: es werden immer Verzeichnisnamen, nicht Dateinamen angegeben!</p>

				<p>Um ein Backup von hda5 anzulegen, wird folgender Befehl eingegeben:</p>
<pre>
# rdiff-backup /media/hda5 /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
				<p>Um ein Backup der Root-Partition anzulegen, wird folgender Befehl eingegeben::</p>
<pre>
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' /media/hdb1/rdiff-backups/192.168.0.1/root
</pre>
				<p>Fehlermeldungen mit "AF_UNIX path too long" k&#246;nnen ignoriert werden. Der Backupvorgang kann beim ersten Mal l&#228;ngere Zeit beanspruchen, da die gesamte Partition gesichert wird. Beachte auch, dass /tmp nicht gesichert wird, da dieses Verzeichnis st&#228;ndigen Ver&#228;nderungen unterworfen ist. Ebensowenig werden /proc und /sys gesichert, da diese Verzeichnisse keine reellen Dateien beinhalten. Auch werden eingebundene Datentr&#228;ger nicht gesichert, da in diesem Falle hdb1 ebenfalls gesichert w&#252;rde, was in einer unendlichen Schleife, einem unendlichen Loop enden k&#246;nnte! Um dies zu verhindern, k&#246;nnen andere eingebundene Datentr&#228;ger separat gesichert werden.</p>

				<p>Der Grund, warum '/proc/*' und nicht einfach '/proc' gesetzt wurde, liegt darin, dass damit ein Backupverzeichnis /proc angelegt wird, der Inhalt jedoch ignoriert. Gleiches trifft auf /tmp, /sys und alle anderen Mountpunkte zu. Man sieht, mit rdiff-backup kann ein hochintelligentes Backup angelegt werden.</p>

				 <p>Das bedeutet, nach einer Zerst&#246;rung der Root-Partition kann ein vollst&#228;ndiges Backup wieder eingespielt werden, die Mountpunkte /tmp, /proc, /sys und alle weiteren originale Mountpunkte werden wieder angelegt (genau, wie es sein soll). Wenn z. B. /tmp beim Start von X nicht existieren w&#252;rde, k&#246;nnte ein Problem gegeben sein (siehe die man-page f&#252;r mehr Optionen bez&#252;glich --exclude und --include).</p>

			<h6>Wiederherstellung von Verzeichnissen aus dem Backup</h6>

				<p>rdiff-backup verwendet folgende Syntax:</p>
<pre>
rdiff-backup -r from-when source-dir dest-dir
</pre>
				<p>from-when: von wann<br />
				source-dir: Quellverzeichnis<br />
				dest-dir: Zielverzeichnis</p>
				<p>Angenommen, das Verzeichnis /media/hda7/photos wurde irrt&#252;mlich gel&#246;scht, so kann es mit folgendem Befehl wiederhergestellt werden:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5/photos /media/hda5/photos
</pre>
				<p>Die Option "-r now" bedeutet eine Wiederherstellung des letzten Backups. Wenn nun periodisch (via crontab etwa) ein Backup erstellt und erst einige Tage nach der L&#246;schung bemerkt wurde, dass das Verzeichnis photos fehlt, muss ein &#228;lteres Backup zur Wiederherstellung herangezogen werden (damit nicht die Option "now"). Ein anderes Anwendungsgebiet w&#228;re die Wiederherstellung einer &#228;lteren Version einer gegebenen Datei.</p>

				<p>Zur Wiederherstellung eines drei Tage alten Backups wird verwendet:"-r 3D" ... aber, wie in der man-page steht, soll beachtet werden:</p>

				<p class="highlight-1">"3D" refers to the instant 72 hours before the present, and if there was no backup made at that time, rdiff-backup restores the state recorded for the previous backup. For instance, in the above case, if "3D" is used, and there are only backups from 2 days and 4 days ago, the directory would be restored as it was 4 days ago (so you have to think about it before you restore).</p>
				<p>Sinngem&#228;&#223;e &#220;bersetzung:</p>
				<p><em>"3D" beziehts sich auf genau 72 Stunden vor der Jetztzeit, und wenn zu diesem Zeitpunkt kein Backup angelegt wurde, wird das letzte Backup davor zur Wiederherstellung herangezogen. Wenn zum Beispiel im obigen Fall "3D" verwendet wird und nur Backups vorhanden sind, welche 2 Tage und 4 Tage alt sind, w&#252;rde das 4 Tage alte Verzeichnis wiederhergestellt werden (eine Wiederherstellung ben&#246;tigt also eine genaue Planung vor der Durchf&#252;hrung).</em></p>

				<p>Folgender Befehl listet Datum und Zeitpunkt der letzten Backups von hda5:</p>
<pre>
# rdiff-backup -l /media/hdb1/rdiff-backups/192.168.0.1/hda5
</pre>
			<h5>Wiederherstellung von Partitionen</h5>

				<p>Es k&#246;nnen auch ganze Partitonen (Mountpunkte) wiederhergestellt werden, denn schlie&#223;lich ist ein Mountpunkt auch nur ein Verzeichnis.</p>

				<p class="highlight-2">WARNUNG: Das Root-Verzeichnis darf nicht wiederhergestellt werden, wenn in dieses gebootet wurde! Mit einem einzigen Befehl gehen alle Dateien auf allen Partitionen inklusive aller Backups auf weiteren Festplatten verloren!! rdiff-backup f&#252;hrt exakt das durch, welchen Auftrag es bekommen hat ... Wenn das Backup der Root-Partition leere Mountpunkte hat und der Auftrag der Wiederherstellung ist, diese Mountpunkte ebenso zu rekreieren, wird alles in den gegebenen Mountpunkten gel&#246;scht, um nach Auftrag leere Mountpunkte zu erstellen.</p>

				<p>Um hda5 vom letzten Backup wiederherzustellen, gen&#252;gt folgender Befehl:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/hda5 /media/hda5
</pre>
			<h5>Wiederherstellung der Root-Partition</h5>

				<p>Die Wiederherstellung der Root-Partition ist keine einfache, triviale Aufgabe. Die Root-Partition darf nicht wiederhergestellt werden, w&#228;hrend sie eingebunden (gemountet) ist (siehe Warnung oben). Aber es ist durchaus sinnvoll, in der Lage zu sein, die Root-Partition wiederherstellen zu k&#246;nnen. Denn ein dist-upgrade oder ein kernel-upgrade kann auch mal misslingen, und es ist beruhigend zu wissen, dass das System so neu eingespielt werden kann, wie es vor den Problemen war. Der Zeitaufwand betr&#228;gt nur etwa 20 Minuten.</p>

				<p>Eine M&#246;glichkeit, die Root-Partition wieder herzustellen, ist, in eine weitere Linux-Partition zu booten, so eine auf der Festplatte vorhanden ist. Danach kann die gew&#252;nschte Partition wieder hergestellt werden, da sie nicht als Root-Partition eingebunden ist. Nach Wiederherstellung der Partition kann in sie gebootet werden, und sie wird exakt so aussehen wie zu dem Zeitpunkt, zu dem das Backup angelegt wurde ... genau so! Dies ist die bei weitem leichteste Methode.</p>

				<p>Eine weitere M&#246;glichkeit, die Root-Partition wieder herzustellen, ist, mit der sidux Live-CD zu booten und die Wiederherstellung mit diesem System durchzuf&#252;hren. rdiff-backup ist auf der sidux Live-CD enthalten. Falls die sidux Live-CD kein rdiff-backup enthalten w&#252;rde, kann in die Grub-Zeile (Bootoptionen, Cheatcodes) die Option "unionfs" eingegeben werden, wonach weitere Pakete auch im Live-CD-Modus installiert werden k&#246;nnen. Im gegebenen Fall sind die Befehle:</p>
<pre>
$ sudo su
# wget -O /etc/apt/sources.list http://sidux.com/files/misc/sources.list
# apt-get update
# apt-get install rdiff-backup
</pre>
				<h6>Und jetzt die Wiederherstellung:</h6>
<pre>
# mount /dev/hda1 /media/hda1
# mount /dev/hdb1 /media/hdb1
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Beachte: Bei Nutzung einer anderen Live-CD als sidux und im Falle, dass diese klik unterst&#252;tzt, kann rdiff-backup unter Verwendung von klik mit folgendem Befehl installiert werden:</p>
<pre>
$ sudo ~/.zAppRun ~/Desktop/rdiff-backup_0.13.4-5.cmg rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root /media/hda1
</pre>

				<p>Es ist empfohlen, dass die Wiederherstellung einer Root-Partition mit rdiff-backup getestet wird, um im Ernstfall nicht auf unerwartete Probleme zu sto&#223;en.</p>

			<h5>Sicherung weiterer PCs</h5>

				<p>Es k&#246;nnen Daten weiterer Computer auf dem lokalen PC gesichert werden, wenn der lokale PC sich mittels ssh zu den anderen Computern verbinden kann (und nat&#252;rlich Speicherplatz vorhanden ist). Der ssh-Server (sshd) muss am entfernten (remote) Computer laufen. Der andere Computer muss sich nicht im lokalen Netzwerk (LAN) befinden, er kann irgendwo in der weiten Welt stationiert sein.</p>

				<p>Angenommen, der entfernte (remote) Computer/PC hat folgende Spezifikationen:<br /></p>
				<p>1) Eine Festplatte (hda) mit 100 GB, die mit folgenden Mountpunkten in Verwendung ist:<br />
				2) hda1 ist die Root-Partition,<br />
				3) hda5 speichert tempor&#228;re Dateien, welche nicht gesichert werden sollen,<br />
				4) hda6 ist die Swap-Partition<br />
				5) die IP-Adresse ist 192.168.0.2</p>

				<p>Beachte: zwei Festplatten mit je 100 GB k&#246;nnen normalerweise nicht auf eine Festplatte mit 200 GB gesichert werden, wenn rdiff-backup verwendet wird, das der Platz fr&#252;r inkrementelle Backups fehler w&#252;rde. Da jedoch hda5 des entfernten (remote) PCs nicht gesichert werden soll und - auch wenn man sich nicht darauf verlassen soll - Partitionen in der Regel nicht zu 100 Prozent voll sind, kann man damit spekulieren, dass genug Speicherplatz f&#252;r das Backup vorhanden ist. Es soll aber ber&#252;cksichtigt werden, dass jedes Backup mehr Speicherplatz in Anspruch nimmt, da inkrementelle Dateien zugef&#252;gt werden.</p>

				<p>rdiff-backup kann beauftragt werden, nur Backups zu behalten, die nicht &#228;lter als einen Monat sind (siehe unten). Dies nimmt selbstverst&#228;ndlich weniger Speicherplatz in Anspruch, als wenn Daten &#252;ber Jahre hinweg gesichert werden. Im letzteren Fall muss selbstverst&#228;ndlich der Speicherplatz vorhanden sein, um Jahre von Daten inkrementell sichern zu k&#246;nnen.</p>

				<p>Als erstes muss rdiff-backup am entfernten (remote) PC installiert werden (jeder Computer, dessen Daten gesichert werden sollen, muss - wie auch der Backup-Server - rdiff-backup installiert haben).</p>

				<p>Um den entfernten (remote) PC am lokalen PC zu sichern, wird am lokalen PC (192.168.0.1) gestartet <span class="highlight-4">(beachte den doppelten Doppelpunkt ::) </span>:</p>
<pre>
# mkdir /media/hdb1/rdiff-backups/192.168.0.2/root
# rdiff-backup --exclude '/tmp/*' --exclude '/proc/*' --exclude '/sys/*' --exclude '/media/*/*' 192.168.0.2::/ /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>
				<p>Um nun ein Verzeichnis auf dem entfernten (remote) PC wiederherzustellen, wird der Wiederherstellungsprozess entweder am lokalen oder am entfernten (remote) PC in Gang gesetzt.</p>

				<p>So wird das Verzeichnis /usr/local/games auf dem entfernten (remote) PC wiederhergestellt, indem der Prozess am entfernten (remote) PC initiiert wird:</p>
<pre>
# rdiff-backup -r now 192.168.0.1::/media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games /usr/local/games
</pre>
				<p>So wird das Verzeichnis /usr/local/games auf dem entfernten (remote) PC wiederhergestellt, indem der Prozess am lokalen PC initiiert wird:</p>
<pre>
# rdiff-backup -r now /media/hdb1/rdiff-backups/192.168.0.1/root/usr/local/games 192.168.0.2::/usr/local/games
</pre>
				<p>Die gleiche Syntax wird verwendet, wenn die Root-Partition von einer Live-CD wiederhergestellt wird (wenn der entfernte (remote) PC durch eine Live-CD gebootet wurde ... siehe oben).</p>

			<h5>Automatisierung von Backups:</h5>

				<p>Wenn Backups von anderen PCs auf dem eigenen lokalen gespeichert werden, sollte zun&#228;chst ein passwortfreier ssh-Login unter Verwendung von ssh-Schl&#252;sseln (ssh-keys) eingerichtet werden. <span class="highlight-2">Beachte, dies bedeutet passwortfreie ssh-Logins als root. Dies kann beschr&#228;nkt werden, dass nur Befehle von rdiff-backup ausgef&#252;hrt werden, aber diese Vorgehensweise ist au&#223;erhalb des Rahmens dieser Anleitung, siehe daher: <a href="samba-de.htm#ssh-s">SSH Configuration</a> </span>.  Wir setzten absolute Vertrauensw&#252;rdigkeit voraus und zeigen die einfachste M&#246;glichkeit, wie ein passwortfreier ssh-Login angelegt werden kann.</p>

				<p>Vom lokalen PC ist der Befehl:</p>
<pre>
# [ -f /root/.ssh/id_rsa ] || ssh-keygen -t rsa -f /root/.ssh/id_rsa
</pre>
				<p>F&#252;r leere Passw&#246;rter wird zweimal die Entertaste gedr&#252;ckt. Danach:</p>
<pre>
# cat /root/.ssh/id_rsa.pub | ssh 192.168.0.2 'mkdir -p /root/.ssh;\
> cat - >>/root/.ssh/authorized_keys2'
</pre>
				<p>Das Root-Passwort wird angefragt.</p>

				<p>Jetzt kann eine ssh-Verbindung als root zum entfernten (remote) PC aufgebaut werden, ohne ein Passwort eintippen zu m&#252;ssen, womit rdiff-backup nun automatisiert werden kann.</p>

				<p>Als n&#228;chstes wird ein Bash-Script geschrieben, welches alle rdiff-backup-Befehle enth&#228;lt. Dieses Bash-Script kann folgenderma&#223;en aussehen:</p>


<pre>
#!/bin/bash
RDIFF=/usr/bin/rdiff-backup
echo
echo "=======Backing up 192.168.0.1 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*'\
 --exclude '/sys/*' --exclude '/media/*/*'\
 / /media/hdb1/rdiff-backups/192.168.0.1/root
echo "(and purge increments older than 1 month)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.1/root
echo
echo "=======Backing up 192.168.0.1 mount hda5======="
${RDIFF} --ssh-no-compression --exclude /media/hda5/myjunk /media/hda5\
 /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M\
 --force /media/hdb1/rdiff-backups/192.168.0.1/hda5
echo
echo "=======Backing up 192.168.0.2 root======="
${RDIFF} --ssh-no-compression --exclude '/tmp/*' --exclude '/proc/*'\
 --exclude '/sys/*' --exclude '/media/*/*' --exclude '/mnt/*/*'\
 192.168.0.2::/ /media/hdb1/rdiff-backups/192.168.0.2/root
echo "(and purge increments older than 1 months)"
${RDIFF} --remove-older-than 1M
 --force /media/hdb1/rdiff-backups/192.168.0.2/root
</pre>


				<p>Wir nennen das Bash-Script "myrdiff-backups.bash" und speichern es unter /usr/local/bin auf unserem lokalen PC, der als Backup-Server dient, und machen es ausf&#252;hrbar (executable). Zum Testen wird das Script nun ausgef&#252;hrt, um sicherzugehen, dass es funktioniert.</p>

				<p>Zu guter Letzt lassen wir cron unser Bash-Script jeden Abend um 20 Uhr ausf&#252;hren. Um dies der crontab von root zu &#252;bertragen, muss folgendes gemacht werden:</p>
<pre>
# crontab -e
</pre>
				<p>Nun folgende Zeile einf&#252;gen:</p>
<pre>
0 20 * * * /usr/local/bin/myrdiff-backups.bash
</pre>

			<div id="rev">Page last revised 05/05/2007 0800 UTC</div>
</div>
</div>
</body>
</html>
